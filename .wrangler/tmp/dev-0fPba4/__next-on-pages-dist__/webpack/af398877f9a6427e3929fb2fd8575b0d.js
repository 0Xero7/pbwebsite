var Gn={},Tf=(Ge,Xt,Is)=>(Gn.__chunk_4822=(tr,qt,De)=>{"use strict";De.d(qt,{db:()=>ie,tO:()=>ne});var re=De(919),fe=De(5283),He=De(1085),it=De(2611);let St={apiKey:"AIzaSyDBG_SOIvFjExIfZd_91AjFESGaqwRESLM",authDomain:"pbwebsite-d70a3.firebaseapp.com",projectId:"pbwebsite-d70a3",storageBucket:"pbwebsite-d70a3.appspot.com",messagingSenderId:"975915344098",appId:"1:975915344098:web:2c5a0e634950afd86afebb",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},ze=(0,re.ZF)(St);(0,fe.v0)(ze);let ie=(0,He.ad)(ze);new fe.hJ;let ne=(0,it.cF)(ze)},Gn.__chunk_2611=(tr,qt,De)=>{De.d(qt,{oq:()=>J,Jt:()=>we,cF:()=>Be,iH:()=>je,KV:()=>Se});var re,fe,He=De(2338),it=De(1511),St=De(9122);let ze="firebasestorage.googleapis.com",ie="storageBucket";class ne extends it.ZR{constructor(S,$,U=0){super(he(S),`Firebase Storage: ${$} (${he(S)})`),this.status_=U,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ne.prototype)}get status(){return this.status_}set status(S){this.status_=S}_codeEquals(S){return he(S)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(S){this.customData.serverResponse=S,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function he(P){return"storage/"+P}function Ce(){return new ne(re.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Oe(P){return new ne(re.INVALID_ARGUMENT,P)}function Re(){return new ne(re.APP_DELETED,"The Firebase app was deleted.")}function Ee(P,S){return new ne(re.INVALID_FORMAT,"String does not match format '"+P+"': "+S)}function ft(P){throw new ne(re.INTERNAL_ERROR,"Internal error: "+P)}(function(P){P.UNKNOWN="unknown",P.OBJECT_NOT_FOUND="object-not-found",P.BUCKET_NOT_FOUND="bucket-not-found",P.PROJECT_NOT_FOUND="project-not-found",P.QUOTA_EXCEEDED="quota-exceeded",P.UNAUTHENTICATED="unauthenticated",P.UNAUTHORIZED="unauthorized",P.UNAUTHORIZED_APP="unauthorized-app",P.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",P.INVALID_CHECKSUM="invalid-checksum",P.CANCELED="canceled",P.INVALID_EVENT_NAME="invalid-event-name",P.INVALID_URL="invalid-url",P.INVALID_DEFAULT_BUCKET="invalid-default-bucket",P.NO_DEFAULT_BUCKET="no-default-bucket",P.CANNOT_SLICE_BLOB="cannot-slice-blob",P.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",P.NO_DOWNLOAD_URL="no-download-url",P.INVALID_ARGUMENT="invalid-argument",P.INVALID_ARGUMENT_COUNT="invalid-argument-count",P.APP_DELETED="app-deleted",P.INVALID_ROOT_OPERATION="invalid-root-operation",P.INVALID_FORMAT="invalid-format",P.INTERNAL_ERROR="internal-error",P.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(re||(re={}));class ue{constructor(S,$){this.bucket=S,this.path_=$}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let S=encodeURIComponent;return"/b/"+S(this.bucket)+"/o/"+S(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(S,$){let U;try{U=ue.makeFromUrl(S,$)}catch{return new ue(S,"")}if(U.path==="")return U;throw new ne(re.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+S+"'.")}static makeFromUrl(S,$){let U=null,X="([A-Za-z0-9.\\-_]+)",de=RegExp("^gs://"+X+"(/(.*))?$","i");function Ie(be){be.path_=decodeURIComponent(be.path)}let pe=$.replace(/[.]/g,"\\."),Ae=[{regex:de,indices:{bucket:1,path:3},postModify:function(be){be.path.charAt(be.path.length-1)==="/"&&(be.path_=be.path_.slice(0,-1))}},{regex:RegExp(`^https?://${pe}/v[A-Za-z0-9_]+/b/${X}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:Ie},{regex:RegExp(`^https?://${$===ze?"(?:storage.googleapis.com|storage.cloud.google.com)":$}/${X}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:Ie}];for(let be=0;be<Ae.length;be++){let T=Ae[be],st=T.regex.exec(S);if(st){let Le=st[T.indices.bucket],ht=st[T.indices.path];ht||(ht=""),U=new ue(Le,ht),T.postModify(U);break}}if(U==null)throw new ne(re.INVALID_URL,"Invalid URL '"+S+"'.");return U}}class Je{constructor(S){this.promise_=Promise.reject(S)}getPromise(){return this.promise_}cancel(S=!1){}}function pn(P){return typeof P=="string"||P instanceof String}function pt(P){return Fe()&&P instanceof Blob}function Fe(){return typeof Blob<"u"}function mn(P,S,$,U){if(U<S)throw Oe(`Invalid value for '${P}'. Expected ${S} or greater.`);if(U>$)throw Oe(`Invalid value for '${P}'. Expected ${$} or less.`)}function zt(P,S,$){let U=S;return $==null&&(U=`https://${S}`),`${$}://${U}/v0${P}`}function an(P){let S=encodeURIComponent,$="?";for(let U in P)P.hasOwnProperty(U)&&($=$+(S(U)+"=")+S(P[U])+"&");return $.slice(0,-1)}(function(P){P[P.NO_ERROR=0]="NO_ERROR",P[P.NETWORK_ERROR=1]="NETWORK_ERROR",P[P.ABORT=2]="ABORT"})(fe||(fe={}));class gt{constructor(S,$,U,X,de,Ie,pe,Ae,be,T,st,Le=!0){this.url_=S,this.method_=$,this.headers_=U,this.body_=X,this.successCodes_=de,this.additionalRetryCodes_=Ie,this.callback_=pe,this.errorCallback_=Ae,this.timeout_=be,this.progressCallback_=T,this.connectionFactory_=st,this.retry=Le,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((ht,It)=>{this.resolve_=ht,this.reject_=It,this.start_()})}start_(){let S=($,U)=>{let X=this.resolve_,de=this.reject_,Ie=U.connection;if(U.wasSuccessCode)try{let pe=this.callback_(Ie,Ie.getResponse());pe!==void 0?X(pe):X()}catch(pe){de(pe)}else if(Ie!==null){let pe=Ce();pe.serverResponse=Ie.getErrorText(),de(this.errorCallback_?this.errorCallback_(Ie,pe):pe)}else de(U.canceled?this.appDelete_?Re():new ne(re.CANCELED,"User canceled the upload/download."):new ne(re.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?S(!1,new We(!1,null,!0)):this.backoffId_=function($,U,X){let de=1,Ie=null,pe=null,Ae=!1,be=0,T=!1;function st(...Ct){T||(T=!0,U.apply(null,Ct))}function Le(Ct){Ie=setTimeout(()=>{Ie=null,$(It,be===2)},Ct)}function ht(){pe&&clearTimeout(pe)}function It(Ct,...Zt){let on;if(T){ht();return}if(Ct||be===2||Ae){ht(),st.call(null,Ct,...Zt);return}de<64&&(de*=2),be===1?(be=2,on=0):on=(de+Math.random())*1e3,Le(on)}let Ot=!1;function Xe(Ct){!Ot&&(Ot=!0,ht(),!T&&(Ie!==null?(Ct||(be=2),clearTimeout(Ie),Le(0)):Ct||(be=1)))}return Le(0),pe=setTimeout(()=>{Ae=!0,Xe(!0)},X),Xe}(($,U)=>{if(U){$(!1,new We(!1,null,!0));return}let X=this.connectionFactory_();this.pendingConnection_=X;let de=Ie=>{let pe=Ie.loaded,Ae=Ie.lengthComputable?Ie.total:-1;this.progressCallback_!==null&&this.progressCallback_(pe,Ae)};this.progressCallback_!==null&&X.addUploadProgressListener(de),X.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&X.removeUploadProgressListener(de),this.pendingConnection_=null;let Ie=X.getErrorCode()===fe.NO_ERROR,pe=X.getStatus();if(!Ie||function(Ae,be){let T=Ae>=500&&Ae<600,st=[408,429].indexOf(Ae)!==-1,Le=be.indexOf(Ae)!==-1;return T||st||Le}(pe,this.additionalRetryCodes_)&&this.retry){$(!1,new We(!1,null,X.getErrorCode()===fe.ABORT));return}$(!0,new We(this.successCodes_.indexOf(pe)!==-1,X))})},S,this.timeout_)}getPromise(){return this.promise_}cancel(S){this.canceled_=!0,this.appDelete_=S||!1,this.backoffId_!==null&&(0,this.backoffId_)(!1),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class We{constructor(S,$,U){this.wasSuccessCode=S,this.connection=$,this.canceled=!!U}}function ot(...P){let S=typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0;if(S!==void 0){let $=new S;for(let U=0;U<P.length;U++)$.append(P[U]);return $.getBlob()}if(Fe())return new Blob(P);throw new ne(re.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let xe={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yt{constructor(S,$){this.data=S,this.contentType=$||null}}function xt(P){let S=[];for(let $=0;$<P.length;$++){let U=P.charCodeAt($);U<=127?S.push(U):U<=2047?S.push(192|U>>6,128|63&U):(64512&U)==55296?$<P.length-1&&(64512&P.charCodeAt($+1))==56320?(U=65536|(1023&U)<<10|1023&P.charCodeAt(++$),S.push(240|U>>18,128|U>>12&63,128|U>>6&63,128|63&U)):S.push(239,191,189):(64512&U)==56320?S.push(239,191,189):S.push(224|U>>12,128|U>>6&63,128|63&U)}return new Uint8Array(S)}function $t(P,S){let $;switch(P){case xe.BASE64:{let X=S.indexOf("-")!==-1,de=S.indexOf("_")!==-1;if(X||de)throw Ee(P,"Invalid character '"+(X?"-":"_")+"' found: is it base64url encoded?");break}case xe.BASE64URL:{let X=S.indexOf("+")!==-1,de=S.indexOf("/")!==-1;if(X||de)throw Ee(P,"Invalid character '"+(X?"+":"/")+"' found: is it base64 encoded?");S=S.replace(/-/g,"+").replace(/_/g,"/")}}try{$=function(X){if(typeof atob>"u")throw new ne(re.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(X)}(S)}catch(X){throw X.message.includes("polyfill")?X:Ee(P,"Invalid character found")}let U=new Uint8Array($.length);for(let X=0;X<$.length;X++)U[X]=$.charCodeAt(X);return U}class H{constructor(S){this.base64=!1,this.contentType=null;let $=S.match(/^data:([^,]+)?,/);if($===null)throw Ee(xe.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let U=$[1]||null;U!=null&&(this.base64=function(X,de){return X.length>=de.length&&X.substring(X.length-de.length)===de}(U,";base64"),this.contentType=this.base64?U.substring(0,U.length-7):U),this.rest=S.substring(S.indexOf(",")+1)}}class Ve{constructor(S,$){let U=0,X="";pt(S)?(this.data_=S,U=S.size,X=S.type):S instanceof ArrayBuffer?($?this.data_=new Uint8Array(S):(this.data_=new Uint8Array(S.byteLength),this.data_.set(new Uint8Array(S))),U=this.data_.length):S instanceof Uint8Array&&($?this.data_=S:(this.data_=new Uint8Array(S.length),this.data_.set(S)),U=S.length),this.size_=U,this.type_=X}size(){return this.size_}type(){return this.type_}slice(S,$){if(!pt(this.data_))return new Ve(new Uint8Array(this.data_.buffer,S,$-S),!0);{var U;let X=(U=this.data_).webkitSlice?U.webkitSlice(S,$):U.mozSlice?U.mozSlice(S,$):U.slice?U.slice(S,$):null;return X===null?null:new Ve(X)}}static getBlob(...S){if(Fe()){let $=S.map(U=>U instanceof Ve?U.data_:U);return new Ve(ot.apply(null,$))}{let $=S.map(Ie=>pn(Ie)?function(pe,Ae){switch(pe){case xe.RAW:return new yt(xt(Ae));case xe.BASE64:case xe.BASE64URL:return new yt($t(pe,Ae));case xe.DATA_URL:return new yt(function(be){let T=new H(be);return T.base64?$t(xe.BASE64,T.rest):function(st){let Le;try{Le=decodeURIComponent(st)}catch{throw Ee(xe.DATA_URL,"Malformed data URL.")}return xt(Le)}(T.rest)}(Ae),new H(Ae).contentType)}throw Ce()}(xe.RAW,Ie).data:Ie.data_),U=0;$.forEach(Ie=>{U+=Ie.byteLength});let X=new Uint8Array(U),de=0;return $.forEach(Ie=>{for(let pe=0;pe<Ie.length;pe++)X[de++]=Ie[pe]}),new Ve(X,!0)}}uploadData(){return this.data_}}function Yt(P){var S;let $;try{$=JSON.parse(P)}catch{return null}return typeof(S=$)!="object"||Array.isArray(S)?null:$}function Dt(P){let S=P.lastIndexOf("/",P.length-2);return S===-1?P:P.slice(S+1)}function K(P,S){return S}class M{constructor(S,$,U,X){this.server=S,this.local=$||S,this.writable=!!U,this.xform=X||K}}let ee=null;function Rt(){if(ee)return ee;let P=[];P.push(new M("bucket")),P.push(new M("generation")),P.push(new M("metageneration")),P.push(new M("name","fullPath",!0));let S=new M("name");S.xform=function(U,X){return!pn(X)||X.length<2?X:Dt(X)},P.push(S);let $=new M("size");return $.xform=function(U,X){return X!==void 0?Number(X):X},P.push($),P.push(new M("timeCreated")),P.push(new M("updated")),P.push(new M("md5Hash",null,!0)),P.push(new M("cacheControl",null,!0)),P.push(new M("contentDisposition",null,!0)),P.push(new M("contentEncoding",null,!0)),P.push(new M("contentLanguage",null,!0)),P.push(new M("contentType",null,!0)),P.push(new M("metadata","customMetadata",!0)),ee=P}function V(P,S,$){let U=Yt(S);return U===null?null:function(X,de,Ie){let pe={};pe.type="file";let Ae=Ie.length;for(let be=0;be<Ae;be++){let T=Ie[be];pe[T.local]=T.xform(pe,de[T.server])}return Object.defineProperty(pe,"ref",{get:function(){let be=new ue(pe.bucket,pe.fullPath);return X._makeStorageReference(be)}}),pe}(P,U,$)}class q{constructor(S,$,U,X){this.url=S,this.method=$,this.handler=U,this.timeout=X,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Y(P){if(!P)throw Ce()}function me(P){return function(S,$){var U,X;let de;return S.getStatus()===401?de=S.getErrorText().includes("Firebase App Check token is invalid")?new ne(re.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new ne(re.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):S.getStatus()===402?(U=P.bucket,de=new ne(re.QUOTA_EXCEEDED,"Quota for bucket '"+U+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):S.getStatus()===403?(X=P.path,de=new ne(re.UNAUTHORIZED,"User does not have permission to access '"+X+"'.")):de=$,de.status=S.getStatus(),de.serverResponse=$.serverResponse,de}}function ce(P){let S=me(P);return function($,U){let X=S($,U);if($.getStatus()===404){var de;de=P.path,X=new ne(re.OBJECT_NOT_FOUND,"Object '"+de+"' does not exist.")}return X.serverResponse=U.serverResponse,X}}let Pe={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};class Qe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=fe.NO_ERROR,this.sendPromise_=new Promise(S=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=fe.ABORT,S()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=fe.NETWORK_ERROR,S()}),this.xhr_.addEventListener("load",()=>{S()})})}send(S,$,U,X){if(this.sent_)throw ft("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open($,S,!0),X!==void 0)for(let de in X)X.hasOwnProperty(de)&&this.xhr_.setRequestHeader(de,X[de].toString());return U!==void 0?this.xhr_.send(U):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ft("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ft("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ft("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ft("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(S){return this.xhr_.getResponseHeader(S)}addUploadProgressListener(S){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",S)}removeUploadProgressListener(S){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",S)}}class vt extends Qe{initXhr(){this.xhr_.responseType="text"}}function wt(){return new vt}class ve{constructor(S,$){this._service=S,$ instanceof ue?this._location=$:this._location=ue.makeFromUrl($,S.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(S,$){return new ve(S,$)}get root(){let S=new ue(this._location.bucket,"");return this._newRef(this._service,S)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Dt(this._location.path)}get storage(){return this._service}get parent(){let S=function(U){if(U.length===0)return null;let X=U.lastIndexOf("/");return X===-1?"":U.slice(0,X)}(this._location.path);if(S===null)return null;let $=new ue(this._location.bucket,S);return new ve(this._service,$)}_throwIfRoot(S){if(this._location.path==="")throw new ne(re.INVALID_ROOT_OPERATION,"The operation '"+S+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function bt(P,S){let $=S?.[ie];return $==null?null:ue.makeFromBucketSpec($,P)}class W{constructor(S,$,U,X,de){this.app=S,this._authProvider=$,this._appCheckProvider=U,this._url=X,this._firebaseVersion=de,this._bucket=null,this._host=ze,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,X!=null?this._bucket=ue.makeFromBucketSpec(X,this._host):this._bucket=bt(this._host,this.app.options)}get host(){return this._host}set host(S){this._host=S,this._url!=null?this._bucket=ue.makeFromBucketSpec(this._url,S):this._bucket=bt(S,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(S){mn("time",0,Number.POSITIVE_INFINITY,S),this._maxUploadRetryTime=S}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(S){mn("time",0,Number.POSITIVE_INFINITY,S),this._maxOperationRetryTime=S}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let S=this._authProvider.getImmediate({optional:!0});if(S){let $=await S.getToken();if($!==null)return $.accessToken}return null}async _getAppCheckToken(){let S=this._appCheckProvider.getImmediate({optional:!0});return S?(await S.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(S=>S.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(S){return new ve(this,S)}_makeRequest(S,$,U,X,de=!0){if(this._deleted)return new Je(Re());{let Ie=function(pe,Ae,be,T,st,Le,ht=!0){let It=an(pe.urlParams),Ot=pe.url+It,Xe=Object.assign({},pe.headers);return Ae&&(Xe["X-Firebase-GMPID"]=Ae),be!==null&&be.length>0&&(Xe.Authorization="Firebase "+be),Xe["X-Firebase-Storage-Version"]="webjs/"+(Le??"AppManager"),T!==null&&(Xe["X-Firebase-AppCheck"]=T),new gt(Ot,pe.method,Xe,pe.body,pe.successCodes,pe.additionalRetryCodes,pe.handler,pe.errorHandler,pe.timeout,pe.progressCallback,st,ht)}(S,this._appId,U,X,$,this._firebaseVersion,de);return this._requests.add(Ie),Ie.getPromise().then(()=>this._requests.delete(Ie),()=>this._requests.delete(Ie)),Ie}}async makeRequestWithTokens(S,$){let[U,X]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(S,$,U,X).getPromise()}}let R="@firebase/storage",Z="0.12.6",te="storage";function Se(P,S,$){return function(U,X,de){U._throwIfRoot("uploadBytes");let Ie=function(pe,Ae,be,T,st){var Le,ht;let It=Ae.bucketOnlyServerUrl(),Ot={"X-Goog-Upload-Protocol":"multipart"},Xe=function(){let Fn="";for(let Pt=0;Pt<2;Pt++)Fn+=Math.random().toString().slice(2);return Fn}();Ot["Content-Type"]="multipart/related; boundary="+Xe;let Ct=function(Fn,Pt,bn){let nt=Object.assign({},bn);return nt.fullPath=Fn.path,nt.size=Pt.size(),!nt.contentType&&(nt.contentType=Pt&&Pt.type()||"application/octet-stream"),nt}(Ae,T,st),Zt="--"+Xe+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+function(Fn,Pt){let bn={},nt=Pt.length;for(let kt=0;kt<nt;kt++){let gn=Pt[kt];gn.writable&&(bn[gn.server]=Fn[gn.local])}return JSON.stringify(bn)}(Ct,be)+`\r
--`+Xe+`\r
Content-Type: `+Ct.contentType+`\r
\r
`,on=Ve.getBlob(Zt,T,`\r
--`+Xe+"--");if(on===null)throw new ne(re.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");let nr={name:Ct.fullPath},Kr=zt(It,pe.host,pe._protocol),Gr=pe.maxUploadRetryTime,ct=new q(Kr,"POST",(Le=pe,ht=be,function(Fn,Pt){let bn=V(Le,Pt,ht);return Y(bn!==null),bn}),Gr);return ct.urlParams=nr,ct.headers=Ot,ct.body=on.uploadData(),ct.errorHandler=me(Ae),ct}(U.storage,U._location,Rt(),new Ve(X,!0),de);return U.storage.makeRequestWithTokens(Ie,wt).then(pe=>({metadata:pe,ref:U}))}(P=(0,it.m9)(P),S,$)}function we(P){return function(S){S._throwIfRoot("getDownloadURL");let $=function(U,X,de){let Ie=new q(zt(X.fullServerUrl(),U.host,U._protocol),"GET",function(pe,Ae){let be=V(U,Ae,de);return Y(be!==null),function(T,st,Le,ht){let It=Yt(st);if(It===null||!pn(It.downloadTokens))return null;let Ot=It.downloadTokens;if(Ot.length===0)return null;let Xe=encodeURIComponent;return Ot.split(",").map(Ct=>{let Zt=T.bucket,on=T.fullPath;return zt("/b/"+Xe(Zt)+"/o/"+Xe(on),Le,ht)+an({alt:"media",token:Ct})})[0]}(be,Ae,U.host,U._protocol)},U.maxOperationRetryTime);return Ie.errorHandler=ce(X),Ie}(S.storage,S._location,Rt());return S.storage.makeRequestWithTokens($,wt).then(U=>{if(U===null)throw new ne(re.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return U})}(P=(0,it.m9)(P))}function J(P){return function(S){S._throwIfRoot("deleteObject");let $=function(U,X){let de=new q(zt(X.fullServerUrl(),U.host,U._protocol),"DELETE",function(Ie,pe){},U.maxOperationRetryTime);return de.successCodes=[200,204],de.errorHandler=ce(X),de}(S.storage,S._location);return S.storage.makeRequestWithTokens($,wt)}(P=(0,it.m9)(P))}function je(P,S){return function($,U){if(!(U&&/^[A-Za-z]+:\/\//.test(U)))return function X(de,Ie){if(de instanceof W){if(de._bucket==null)throw new ne(re.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ie+"' property when initializing the app?");let pe=new ve(de,de._bucket);return Ie!=null?X(pe,Ie):pe}return Ie!==void 0?function(pe,Ae){let be=function(st,Le){let ht=Le.split("/").filter(It=>It.length>0).join("/");return st.length===0?ht:st+"/"+ht}(pe._location.path,Ae),T=new ue(pe._location.bucket,be);return new ve(pe.storage,T)}(de,Ie):de}($,U);if($ instanceof W)return new ve($,U);throw Oe("To use ref(service, url), the first argument must be a Storage instance.")}(P=(0,it.m9)(P),S)}function Be(P=(0,He.Mq)(),S){P=(0,it.m9)(P);let $=(0,He.qX)(P,te).getImmediate({identifier:S}),U=(0,it.P0)("storage");return U&&function(X,de,Ie,pe={}){(function(Ae,be,T,st={}){Ae.host=`${be}:${T}`,Ae._protocol="http";let{mockUserToken:Le}=st;Le&&(Ae._overrideAuthToken=typeof Le=="string"?Le:(0,it.Sg)(Le,Ae.app.options.projectId))})(X,de,Ie,pe)}($,...U),$}(0,He.Xd)(new St.wA(te,function(P,{instanceIdentifier:S}){return new W(P.getProvider("app").getImmediate(),P.getProvider("auth-internal"),P.getProvider("app-check-internal"),S,He.Jn)},"PUBLIC").setMultipleInstances(!0)),(0,He.KN)(R,Z,""),(0,He.KN)(R,Z,"esm2017")},Gn.__chunk_1085=(tr,qt,De)=>{De.d(qt,{ET:()=>Jd,hJ:()=>Pd,oe:()=>Qd,JU:()=>Wu,QT:()=>Gd,PL:()=>Hd,ad:()=>Md,IO:()=>jd,r7:()=>Wd,ar:()=>zd});var re,fe,He,it,St,ze,ie,ne,he,Ce,Oe,Re,Ee,ft,ue,Je=De(2338),pn=De(9122),pt=De(3369),Fe=De(1511),mn=typeof Xt<"u"?Xt:typeof window<"u"?window:typeof Is<"u"?Is:typeof Ge<"u"?Ge:{},zt={};(function(){function r(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function e(A,I,_){_||(_=0);var C=Array(16);if(typeof I=="string")for(var D=0;16>D;++D)C[D]=I.charCodeAt(_++)|I.charCodeAt(_++)<<8|I.charCodeAt(_++)<<16|I.charCodeAt(_++)<<24;else for(D=0;16>D;++D)C[D]=I[_++]|I[_++]<<8|I[_++]<<16|I[_++]<<24;I=A.g[0],_=A.g[1],D=A.g[2];var L=A.g[3],E=I+(L^_&(D^L))+C[0]+3614090360&4294967295;E=L+(D^(I=_+(E<<7&4294967295|E>>>25))&(_^D))+C[1]+3905402710&4294967295,E=D+(_^(L=I+(E<<12&4294967295|E>>>20))&(I^_))+C[2]+606105819&4294967295,E=_+(I^(D=L+(E<<17&4294967295|E>>>15))&(L^I))+C[3]+3250441966&4294967295,E=I+(L^(_=D+(E<<22&4294967295|E>>>10))&(D^L))+C[4]+4118548399&4294967295,E=L+(D^(I=_+(E<<7&4294967295|E>>>25))&(_^D))+C[5]+1200080426&4294967295,E=D+(_^(L=I+(E<<12&4294967295|E>>>20))&(I^_))+C[6]+2821735955&4294967295,E=_+(I^(D=L+(E<<17&4294967295|E>>>15))&(L^I))+C[7]+4249261313&4294967295,E=I+(L^(_=D+(E<<22&4294967295|E>>>10))&(D^L))+C[8]+1770035416&4294967295,E=L+(D^(I=_+(E<<7&4294967295|E>>>25))&(_^D))+C[9]+2336552879&4294967295,E=D+(_^(L=I+(E<<12&4294967295|E>>>20))&(I^_))+C[10]+4294925233&4294967295,E=_+(I^(D=L+(E<<17&4294967295|E>>>15))&(L^I))+C[11]+2304563134&4294967295,E=I+(L^(_=D+(E<<22&4294967295|E>>>10))&(D^L))+C[12]+1804603682&4294967295,E=L+(D^(I=_+(E<<7&4294967295|E>>>25))&(_^D))+C[13]+4254626195&4294967295,E=D+(_^(L=I+(E<<12&4294967295|E>>>20))&(I^_))+C[14]+2792965006&4294967295,E=_+(I^(D=L+(E<<17&4294967295|E>>>15))&(L^I))+C[15]+1236535329&4294967295,_=D+(E<<22&4294967295|E>>>10),E=I+(D^L&(_^D))+C[1]+4129170786&4294967295,I=_+(E<<5&4294967295|E>>>27),E=L+(_^D&(I^_))+C[6]+3225465664&4294967295,L=I+(E<<9&4294967295|E>>>23),E=D+(I^_&(L^I))+C[11]+643717713&4294967295,D=L+(E<<14&4294967295|E>>>18),E=_+(L^I&(D^L))+C[0]+3921069994&4294967295,_=D+(E<<20&4294967295|E>>>12),E=I+(D^L&(_^D))+C[5]+3593408605&4294967295,I=_+(E<<5&4294967295|E>>>27),E=L+(_^D&(I^_))+C[10]+38016083&4294967295,L=I+(E<<9&4294967295|E>>>23),E=D+(I^_&(L^I))+C[15]+3634488961&4294967295,D=L+(E<<14&4294967295|E>>>18),E=_+(L^I&(D^L))+C[4]+3889429448&4294967295,_=D+(E<<20&4294967295|E>>>12),E=I+(D^L&(_^D))+C[9]+568446438&4294967295,I=_+(E<<5&4294967295|E>>>27),E=L+(_^D&(I^_))+C[14]+3275163606&4294967295,L=I+(E<<9&4294967295|E>>>23),E=D+(I^_&(L^I))+C[3]+4107603335&4294967295,D=L+(E<<14&4294967295|E>>>18),E=_+(L^I&(D^L))+C[8]+1163531501&4294967295,_=D+(E<<20&4294967295|E>>>12),E=I+(D^L&(_^D))+C[13]+2850285829&4294967295,I=_+(E<<5&4294967295|E>>>27),E=L+(_^D&(I^_))+C[2]+4243563512&4294967295,L=I+(E<<9&4294967295|E>>>23),E=D+(I^_&(L^I))+C[7]+1735328473&4294967295,D=L+(E<<14&4294967295|E>>>18),E=_+(L^I&(D^L))+C[12]+2368359562&4294967295,E=I+((_=D+(E<<20&4294967295|E>>>12))^D^L)+C[5]+4294588738&4294967295,E=L+((I=_+(E<<4&4294967295|E>>>28))^_^D)+C[8]+2272392833&4294967295,E=D+((L=I+(E<<11&4294967295|E>>>21))^I^_)+C[11]+1839030562&4294967295,E=_+((D=L+(E<<16&4294967295|E>>>16))^L^I)+C[14]+4259657740&4294967295,E=I+((_=D+(E<<23&4294967295|E>>>9))^D^L)+C[1]+2763975236&4294967295,E=L+((I=_+(E<<4&4294967295|E>>>28))^_^D)+C[4]+1272893353&4294967295,E=D+((L=I+(E<<11&4294967295|E>>>21))^I^_)+C[7]+4139469664&4294967295,E=_+((D=L+(E<<16&4294967295|E>>>16))^L^I)+C[10]+3200236656&4294967295,E=I+((_=D+(E<<23&4294967295|E>>>9))^D^L)+C[13]+681279174&4294967295,E=L+((I=_+(E<<4&4294967295|E>>>28))^_^D)+C[0]+3936430074&4294967295,E=D+((L=I+(E<<11&4294967295|E>>>21))^I^_)+C[3]+3572445317&4294967295,E=_+((D=L+(E<<16&4294967295|E>>>16))^L^I)+C[6]+76029189&4294967295,E=I+((_=D+(E<<23&4294967295|E>>>9))^D^L)+C[9]+3654602809&4294967295,E=L+((I=_+(E<<4&4294967295|E>>>28))^_^D)+C[12]+3873151461&4294967295,E=D+((L=I+(E<<11&4294967295|E>>>21))^I^_)+C[15]+530742520&4294967295,E=_+((D=L+(E<<16&4294967295|E>>>16))^L^I)+C[2]+3299628645&4294967295,_=D+(E<<23&4294967295|E>>>9),E=I+(D^(_|~L))+C[0]+4096336452&4294967295,I=_+(E<<6&4294967295|E>>>26),E=L+(_^(I|~D))+C[7]+1126891415&4294967295,L=I+(E<<10&4294967295|E>>>22),E=D+(I^(L|~_))+C[14]+2878612391&4294967295,D=L+(E<<15&4294967295|E>>>17),E=_+(L^(D|~I))+C[5]+4237533241&4294967295,_=D+(E<<21&4294967295|E>>>11),E=I+(D^(_|~L))+C[12]+1700485571&4294967295,I=_+(E<<6&4294967295|E>>>26),E=L+(_^(I|~D))+C[3]+2399980690&4294967295,L=I+(E<<10&4294967295|E>>>22),E=D+(I^(L|~_))+C[10]+4293915773&4294967295,D=L+(E<<15&4294967295|E>>>17),E=_+(L^(D|~I))+C[1]+2240044497&4294967295,_=D+(E<<21&4294967295|E>>>11),E=I+(D^(_|~L))+C[8]+1873313359&4294967295,I=_+(E<<6&4294967295|E>>>26),E=L+(_^(I|~D))+C[15]+4264355552&4294967295,L=I+(E<<10&4294967295|E>>>22),E=D+(I^(L|~_))+C[6]+2734768916&4294967295,D=L+(E<<15&4294967295|E>>>17),E=_+(L^(D|~I))+C[13]+1309151649&4294967295,_=D+(E<<21&4294967295|E>>>11),E=I+(D^(_|~L))+C[4]+4149444226&4294967295,I=_+(E<<6&4294967295|E>>>26),E=L+(_^(I|~D))+C[11]+3174756917&4294967295,L=I+(E<<10&4294967295|E>>>22),E=D+(I^(L|~_))+C[2]+718787259&4294967295,D=L+(E<<15&4294967295|E>>>17),E=_+(L^(D|~I))+C[9]+3951481745&4294967295,A.g[0]=A.g[0]+I&4294967295,A.g[1]=A.g[1]+(D+(E<<21&4294967295|E>>>11))&4294967295,A.g[2]=A.g[2]+D&4294967295,A.g[3]=A.g[3]+L&4294967295}function t(A,I){this.h=I;for(var _=[],C=!0,D=A.length-1;0<=D;D--){var L=0|A[D];C&&L==I||(_[D]=L,C=!1)}this.g=_}(function(A,I){function _(){}_.prototype=I.prototype,A.D=I.prototype,A.prototype=new _,A.prototype.constructor=A,A.C=function(C,D,L){for(var E=Array(arguments.length-2),Nt=2;Nt<arguments.length;Nt++)E[Nt-2]=arguments[Nt];return I.prototype[D].apply(C,E)}})(r,function(){this.blockSize=-1}),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},r.prototype.u=function(A,I){I===void 0&&(I=A.length);for(var _=I-this.blockSize,C=this.B,D=this.h,L=0;L<I;){if(D==0)for(;L<=_;)e(this,A,L),L+=this.blockSize;if(typeof A=="string"){for(;L<I;)if(C[D++]=A.charCodeAt(L++),D==this.blockSize){e(this,C),D=0;break}}else for(;L<I;)if(C[D++]=A[L++],D==this.blockSize){e(this,C),D=0;break}}this.h=D,this.o+=I},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var I=1;I<A.length-8;++I)A[I]=0;var _=8*this.o;for(I=A.length-8;I<A.length;++I)A[I]=255&_,_/=256;for(this.u(A),A=Array(16),I=_=0;4>I;++I)for(var C=0;32>C;C+=8)A[_++]=this.g[I]>>>C&255;return A};var n,i={};function s(A){var I;return-128<=A&&128>A?(I=function(_){return new t([0|_],0>_?-1:0)},Object.prototype.hasOwnProperty.call(i,A)?i[A]:i[A]=I(A)):new t([0|A],0>A?-1:0)}function l(A){if(isNaN(A)||!isFinite(A))return u;if(0>A)return N(l(-A));for(var I=[],_=1,C=0;A>=_;C++)I[C]=A/_|0,_*=4294967296;return new t(I,0)}var u=s(0),c=s(1),g=s(16777216);function v(A){if(A.h!=0)return!1;for(var I=0;I<A.g.length;I++)if(A.g[I]!=0)return!1;return!0}function k(A){return A.h==-1}function N(A){for(var I=A.g.length,_=[],C=0;C<I;C++)_[C]=~A.g[C];return new t(_,~A.h).add(c)}function O(A,I){return A.add(N(I))}function Q(A,I){for(;(65535&A[I])!=A[I];)A[I+1]+=A[I]>>>16,A[I]&=65535,I++}function se(A,I){this.g=A,this.h=I}function ae(A,I){if(v(I))throw Error("division by zero");if(v(A))return new se(u,u);if(k(A))return I=ae(N(A),I),new se(N(I.g),N(I.h));if(k(I))return I=ae(A,N(I)),new se(N(I.g),I.h);if(30<A.g.length){if(k(A)||k(I))throw Error("slowDivide_ only works with positive integers.");for(var _=c,C=I;0>=C.l(A);)_=_e(_),C=_e(C);var D=ge(_,1),L=ge(C,1);for(C=ge(C,2),_=ge(_,2);!v(C);){var E=L.add(C);0>=E.l(A)&&(D=D.add(_),L=E),C=ge(C,1),_=ge(_,1)}return I=O(A,D.j(I)),new se(D,I)}for(D=u;0<=A.l(I);){for(C=48>=(C=Math.ceil(Math.log(_=Math.max(1,Math.floor(A.m()/I.m())))/Math.LN2))?1:Math.pow(2,C-48),E=(L=l(_)).j(I);k(E)||0<E.l(A);)_-=C,E=(L=l(_)).j(I);v(L)&&(L=c),D=D.add(L),A=O(A,E)}return new se(D,A)}function _e(A){for(var I=A.g.length+1,_=[],C=0;C<I;C++)_[C]=A.i(C)<<1|A.i(C-1)>>>31;return new t(_,A.h)}function ge(A,I){var _=I>>5;I%=32;for(var C=A.g.length-_,D=[],L=0;L<C;L++)D[L]=0<I?A.i(L+_)>>>I|A.i(L+_+1)<<32-I:A.i(L+_);return new t(D,A.h)}(n=t.prototype).m=function(){if(k(this))return-N(this).m();for(var A=0,I=1,_=0;_<this.g.length;_++){var C=this.i(_);A+=(0<=C?C:4294967296+C)*I,I*=4294967296}return A},n.toString=function(A){if(2>(A=A||10)||36<A)throw Error("radix out of range: "+A);if(v(this))return"0";if(k(this))return"-"+N(this).toString(A);for(var I=l(Math.pow(A,6)),_=this,C="";;){var D=ae(_,I).g,L=((0<(_=O(_,D.j(I))).g.length?_.g[0]:_.h)>>>0).toString(A);if(v(_=D))return L+C;for(;6>L.length;)L="0"+L;C=L+C}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h},n.l=function(A){return k(A=O(this,A))?-1:v(A)?0:1},n.abs=function(){return k(this)?N(this):this},n.add=function(A){for(var I=Math.max(this.g.length,A.g.length),_=[],C=0,D=0;D<=I;D++){var L=C+(65535&this.i(D))+(65535&A.i(D)),E=(L>>>16)+(this.i(D)>>>16)+(A.i(D)>>>16);C=E>>>16,L&=65535,E&=65535,_[D]=E<<16|L}return new t(_,-2147483648&_[_.length-1]?-1:0)},n.j=function(A){if(v(this)||v(A))return u;if(k(this))return k(A)?N(this).j(N(A)):N(N(this).j(A));if(k(A))return N(this.j(N(A)));if(0>this.l(g)&&0>A.l(g))return l(this.m()*A.m());for(var I=this.g.length+A.g.length,_=[],C=0;C<2*I;C++)_[C]=0;for(C=0;C<this.g.length;C++)for(var D=0;D<A.g.length;D++){var L=this.i(C)>>>16,E=65535&this.i(C),Nt=A.i(D)>>>16,bi=65535&A.i(D);_[2*C+2*D]+=E*bi,Q(_,2*C+2*D),_[2*C+2*D+1]+=L*bi,Q(_,2*C+2*D+1),_[2*C+2*D+1]+=E*Nt,Q(_,2*C+2*D+1),_[2*C+2*D+2]+=L*Nt,Q(_,2*C+2*D+2)}for(C=0;C<I;C++)_[C]=_[2*C+1]<<16|_[2*C];for(C=I;C<2*I;C++)_[C]=0;return new t(_,0)},n.A=function(A){return ae(this,A).h},n.and=function(A){for(var I=Math.max(this.g.length,A.g.length),_=[],C=0;C<I;C++)_[C]=this.i(C)&A.i(C);return new t(_,this.h&A.h)},n.or=function(A){for(var I=Math.max(this.g.length,A.g.length),_=[],C=0;C<I;C++)_[C]=this.i(C)|A.i(C);return new t(_,this.h|A.h)},n.xor=function(A){for(var I=Math.max(this.g.length,A.g.length),_=[],C=0;C<I;C++)_[C]=this.i(C)^A.i(C);return new t(_,this.h^A.h)},r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,fe=zt.Md5=r,t.prototype.add=t.prototype.add,t.prototype.multiply=t.prototype.j,t.prototype.modulo=t.prototype.A,t.prototype.compare=t.prototype.l,t.prototype.toNumber=t.prototype.m,t.prototype.toString=t.prototype.toString,t.prototype.getBits=t.prototype.i,t.fromNumber=l,t.fromString=function A(I,_){if(I.length==0)throw Error("number format error: empty string");if(2>(_=_||10)||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return N(A(I.substring(1),_));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=l(Math.pow(_,8)),D=u,L=0;L<I.length;L+=8){var E=Math.min(8,I.length-L),Nt=parseInt(I.substring(L,L+E),_);8>E?(E=l(Math.pow(_,E)),D=D.j(E).add(l(Nt))):D=(D=D.j(C)).add(l(Nt))}return D},re=zt.Integer=t}).apply(mn!==void 0?mn:typeof Ge<"u"?Ge:typeof window<"u"?window:{});var an=typeof Xt<"u"?Xt:typeof window<"u"?window:typeof Is<"u"?Is:typeof Ge<"u"?Ge:{},gt={};(function(){var r,e,t,n=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,d,m){return o==Array.prototype||o==Object.prototype||(o[d]=m.value),o},i=function(o){o=[typeof Xt=="object"&&Xt,o,typeof window=="object"&&window,typeof Ge=="object"&&Ge,typeof an=="object"&&an];for(var d=0;d<o.length;++d){var m=o[d];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}(this);(function(o,d){if(d)e:{var m=i;o=o.split(".");for(var w=0;w<o.length-1;w++){var F=o[w];if(!(F in m))break e;m=m[F]}(d=d(w=m[o=o[o.length-1]]))!=w&&d!=null&&n(m,o,{configurable:!0,writable:!0,value:d})}})("Array.prototype.values",function(o){return o||function(){var d,m,w,F,B;return d=this,m=function(z,oe){return oe},d instanceof String&&(d+=""),w=0,F=!1,(B={next:function(){if(!F&&w<d.length){var z=w++;return{value:m(z,d[z]),done:!1}}return F=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return B},B}});var s=s||{},l=this||Ge;function u(o){var d=typeof o;return(d=d!="object"?d:o?Array.isArray(o)?"array":d:"null")=="array"||d=="object"&&typeof o.length=="number"}function c(o){var d=typeof o;return d=="object"&&o!=null||d=="function"}function g(o,d,m){return o.call.apply(o.bind,arguments)}function v(o,d,m){if(!o)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var F=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(F,w),o.apply(d,F)}}return function(){return o.apply(d,arguments)}}function k(o,d,m){return(k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:v).apply(null,arguments)}function N(o,d){var m=Array.prototype.slice.call(arguments,1);return function(){var w=m.slice();return w.push.apply(w,arguments),o.apply(this,w)}}function O(o,d){function m(){}m.prototype=d.prototype,o.aa=d.prototype,o.prototype=new m,o.prototype.constructor=o,o.Qb=function(w,F,B){for(var z=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)z[oe-2]=arguments[oe];return d.prototype[F].apply(w,z)}}function Q(o){let d=o.length;if(0<d){let m=Array(d);for(let w=0;w<d;w++)m[w]=o[w];return m}return[]}function se(o,d){for(let m=1;m<arguments.length;m++){let w=arguments[m];if(u(w)){let F=o.length||0,B=w.length||0;o.length=F+B;for(let z=0;z<B;z++)o[F+z]=w[z]}else o.push(w)}}class ae{constructor(d,m){this.i=d,this.j=m,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function _e(o){return/^[\s\xa0]*$/.test(o)}function ge(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function A(o){return A[" "](o),o}A[" "]=function(){};var I=ge().indexOf("Gecko")!=-1&&!(ge().toLowerCase().indexOf("webkit")!=-1&&ge().indexOf("Edge")==-1)&&!(ge().indexOf("Trident")!=-1||ge().indexOf("MSIE")!=-1)&&ge().indexOf("Edge")==-1;function _(o,d,m){for(let w in o)d.call(m,o[w],w,o)}function C(o){let d={};for(let m in o)d[m]=o[m];return d}let D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(o,d){let m,w;for(let F=1;F<arguments.length;F++){for(m in w=arguments[F])o[m]=w[m];for(let B=0;B<D.length;B++)m=D[B],Object.prototype.hasOwnProperty.call(w,m)&&(o[m]=w[m])}}class E{constructor(){this.h=this.g=null}add(d,m){let w=Nt.get();w.set(d,m),this.h?this.h.next=w:this.g=w,this.h=w}}var Nt=new ae(()=>new bi,o=>o.reset());class bi{constructor(){this.next=this.g=this.h=null}set(d,m){this.h=d,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let ns,rs=!1,vr=new E,yh=()=>{let o=l.Promise.resolve(void 0);ns=()=>{o.then(Xd)}};var Xd=()=>{let o;for(var d;o=null,vr.g&&(o=vr.g,vr.g=vr.g.next,vr.g||(vr.h=null),o.next=null),d=o;){try{d.h.call(d.g)}catch(m){(function(w){l.setTimeout(()=>{throw w},0)})(m)}Nt.j(d),100>Nt.h&&(Nt.h++,d.next=Nt.g,Nt.g=d)}rs=!1};function wr(){this.s=this.s,this.C=this.C}function Ht(o,d){this.type=o,this.g=this.target=d,this.defaultPrevented=!1}wr.prototype.s=!1,wr.prototype.ma=function(){this.s||(this.s=!0,this.N())},wr.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ht.prototype.h=function(){this.defaultPrevented=!0};var Yd=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,d=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let m=()=>{};l.addEventListener("test",m,d),l.removeEventListener("test",m,d)}catch{}return o}();function is(o,d){if(Ht.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var m=this.type=o.type,w=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=d,d=o.relatedTarget){if(I){e:{try{A(d.nodeName);var F=!0;break e}catch{}F=!1}F||(d=null)}}else m=="mouseover"?d=o.fromElement:m=="mouseout"&&(d=o.toElement);this.relatedTarget=d,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Zd[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&is.aa.h.call(this)}}O(is,Ht);var Zd={2:"touch",3:"pen",4:"mouse"};is.prototype.h=function(){is.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ss="closure_listenable_"+(1e6*Math.random()|0),ef=0;function tf(o,d,m,w,F){this.listener=o,this.proxy=null,this.src=d,this.type=m,this.capture=!!w,this.ha=F,this.key=++ef,this.da=this.fa=!1}function fa(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function pa(o){this.src=o,this.g={},this.h=0}function Lo(o,d){var m=d.type;if(m in o.g){var w,F=o.g[m],B=Array.prototype.indexOf.call(F,d,void 0);(w=0<=B)&&Array.prototype.splice.call(F,B,1),w&&(fa(d),o.g[m].length==0&&(delete o.g[m],o.h--))}}function Mo(o,d,m,w){for(var F=0;F<o.length;++F){var B=o[F];if(!B.da&&B.listener==d&&!!m==B.capture&&B.ha==w)return F}return-1}pa.prototype.add=function(o,d,m,w,F){var B=o.toString();(o=this.g[B])||(o=this.g[B]=[],this.h++);var z=Mo(o,d,w,F);return-1<z?(d=o[z],m||(d.fa=!1)):((d=new tf(d,this.src,B,!!w,F)).fa=m,o.push(d)),d};var Uo="closure_lm_"+(1e6*Math.random()|0),Fo={};function vh(o,d,m,w,F,B){if(!d)throw Error("Invalid event type");var z=c(F)?!!F.capture:!!F,oe=Bo(o);if(oe||(o[Uo]=oe=new pa(o)),(m=oe.add(d,m,w,z,B)).proxy)return m;if(w=function ye(Ue){return nf.call(ye.src,ye.listener,Ue)},m.proxy=w,w.src=o,w.listener=m,o.addEventListener)Yd||(F=z),F===void 0&&(F=!1),o.addEventListener(d.toString(),w,F);else if(o.attachEvent)o.attachEvent(wh(d.toString()),w);else if(o.addListener&&o.removeListener)o.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Vo(o){if(typeof o!="number"&&o&&!o.da){var d=o.src;if(d&&d[ss])Lo(d.i,o);else{var m=o.type,w=o.proxy;d.removeEventListener?d.removeEventListener(m,w,o.capture):d.detachEvent?d.detachEvent(wh(m),w):d.addListener&&d.removeListener&&d.removeListener(w),(m=Bo(d))?(Lo(m,o),m.h==0&&(m.src=null,d[Uo]=null)):fa(o)}}}function wh(o){return o in Fo?Fo[o]:Fo[o]="on"+o}function nf(o,d){if(o.da)o=!0;else{d=new is(d,this);var m=o.listener,w=o.ha||o.src;o.fa&&Vo(o),o=m.call(w,d)}return o}function Bo(o){return(o=o[Uo])instanceof pa?o:null}var qo="__closure_events_fn_"+(1e9*Math.random()>>>0);function jo(o){return typeof o=="function"?o:(o[qo]||(o[qo]=function(d){return o.handleEvent(d)}),o[qo])}function Wt(){wr.call(this),this.i=new pa(this),this.M=this,this.F=null}function rn(o,d){var m,w=o.F;if(w)for(m=[];w;w=w.F)m.push(w);if(o=o.M,w=d.type||d,typeof d=="string")d=new Ht(d,o);else if(d instanceof Ht)d.target=d.target||o;else{var F=d;L(d=new Ht(w,o),F)}if(F=!0,m)for(var B=m.length-1;0<=B;B--){var z=d.g=m[B];F=ma(z,w,!0,d)&&F}if(F=ma(z=d.g=o,w,!0,d)&&F,F=ma(z,w,!1,d)&&F,m)for(B=0;B<m.length;B++)F=ma(z=d.g=m[B],w,!1,d)&&F}function ma(o,d,m,w){if(!(d=o.i.g[String(d)]))return!0;d=d.concat();for(var F=!0,B=0;B<d.length;++B){var z=d[B];if(z&&!z.da&&z.capture==m){var oe=z.listener,ye=z.ha||z.src;z.fa&&Lo(o.i,z),F=oe.call(ye,w)!==!1&&F}}return F&&!w.defaultPrevented}function Ih(o,d,m){if(typeof o=="function")m&&(o=k(o,m));else if(o&&typeof o.handleEvent=="function")o=k(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:l.setTimeout(o,d||0)}O(Wt,wr),Wt.prototype[ss]=!0,Wt.prototype.removeEventListener=function(o,d,m,w){(function F(B,z,oe,ye,Ue){if(Array.isArray(z))for(var qe=0;qe<z.length;qe++)F(B,z[qe],oe,ye,Ue);else ye=c(ye)?!!ye.capture:!!ye,oe=jo(oe),B&&B[ss]?(B=B.i,(z=String(z).toString())in B.g&&-1<(oe=Mo(qe=B.g[z],oe,ye,Ue))&&(fa(qe[oe]),Array.prototype.splice.call(qe,oe,1),qe.length==0&&(delete B.g[z],B.h--))):B&&(B=Bo(B))&&(z=B.g[z.toString()],B=-1,z&&(B=Mo(z,oe,ye,Ue)),(oe=-1<B?z[B]:null)&&Vo(oe))})(this,o,d,m,w)},Wt.prototype.N=function(){if(Wt.aa.N.call(this),this.i){var o,d=this.i;for(o in d.g){for(var m=d.g[o],w=0;w<m.length;w++)fa(m[w]);delete d.g[o],d.h--}}this.F=null},Wt.prototype.K=function(o,d,m,w){return this.i.add(String(o),d,!1,m,w)},Wt.prototype.L=function(o,d,m,w){return this.i.add(String(o),d,!0,m,w)};class rf extends wr{constructor(d,m){super(),this.m=d,this.l=m,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:function m(w){w.g=Ih(()=>{w.g=null,w.i&&(w.i=!1,m(w))},w.l);let F=w.h;w.h=null,w.m.apply(null,F)}(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function as(o){wr.call(this),this.h=o,this.g={}}O(as,wr);var _h=[];function bh(o){_(o.g,function(d,m){this.g.hasOwnProperty(m)&&Vo(d)},o),o.g={}}as.prototype.N=function(){as.aa.N.call(this),bh(this)},as.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zo=l.JSON.stringify,sf=l.JSON.parse,af=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function $o(){}function Eh(o){return o.h||(o.h=o.i())}function Th(){}$o.prototype.h=null;var os={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ko(){Ht.call(this,"d")}function Go(){Ht.call(this,"c")}O(Ko,Ht),O(Go,Ht);var qr={},Sh=null;function ga(){return Sh=Sh||new Wt}function Ch(o){Ht.call(this,qr.La,o)}function ls(o){let d=ga();rn(d,new Ch(d))}function kh(o,d){Ht.call(this,qr.STAT_EVENT,o),this.stat=d}function sn(o){let d=ga();rn(d,new kh(d,o))}function Ah(o,d){Ht.call(this,qr.Ma,o),this.size=d}function us(o,d){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},d)}function hs(){this.g=!0}function Ei(o,d,m,w){o.info(function(){return"XMLHTTP TEXT ("+d+"): "+function(F,B){if(!F.g)return B;if(!B)return null;try{var z=JSON.parse(B);if(z){for(F=0;F<z.length;F++)if(Array.isArray(z[F])){var oe=z[F];if(!(2>oe.length)){var ye=oe[1];if(Array.isArray(ye)&&!(1>ye.length)){var Ue=ye[0];if(Ue!="noop"&&Ue!="stop"&&Ue!="close")for(var qe=1;qe<ye.length;qe++)ye[qe]=""}}}}return zo(z)}catch{return B}}(o,m)+(w?" "+w:"")})}qr.La="serverreachability",O(Ch,Ht),qr.STAT_EVENT="statevent",O(kh,Ht),qr.Ma="timingevent",O(Ah,Ht),hs.prototype.xa=function(){this.g=!1},hs.prototype.info=function(){};var ya={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Nh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function va(){}function Ir(o,d,m,w){this.j=o,this.i=d,this.l=m,this.R=w||1,this.U=new as(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xh}function xh(){this.i=null,this.g="",this.h=!1}O(va,$o),va.prototype.g=function(){return new XMLHttpRequest},va.prototype.i=function(){return{}},e=new va;var Dh={},Ho={};function Wo(o,d,m){o.L=1,o.v=ba(Zn(d)),o.m=m,o.P=!0,Rh(o,null)}function Rh(o,d){o.F=Date.now(),wa(o),o.A=Zn(o.v);var m=o.A,w=o.R;Array.isArray(w)||(w=[String(w)]),Gh(m.i,"t",w),o.C=0,m=o.j.J,o.h=new xh,o.g=hc(o.j,m?d:null,!o.m),0<o.O&&(o.M=new rf(k(o.Y,o,o.g),o.O)),d=o.U,m=o.g,w=o.ca;var F="readystatechange";Array.isArray(F)||(F&&(_h[0]=F.toString()),F=_h);for(var B=0;B<F.length;B++){var z=function oe(ye,Ue,qe,rt,Bt){if(rt&&rt.once)return function Qt(tt,Ke,ut,Jt,Nn){if(Array.isArray(Ke)){for(var Ci=0;Ci<Ke.length;Ci++)Qt(tt,Ke[Ci],ut,Jt,Nn);return null}return ut=jo(ut),tt&&tt[ss]?tt.L(Ke,ut,c(Jt)?!!Jt.capture:!!Jt,Nn):vh(tt,Ke,ut,!0,Jt,Nn)}(ye,Ue,qe,rt,Bt);if(Array.isArray(Ue)){for(var et=0;et<Ue.length;et++)oe(ye,Ue[et],qe,rt,Bt);return null}return qe=jo(qe),ye&&ye[ss]?ye.K(Ue,qe,c(rt)?!!rt.capture:!!rt,Bt):vh(ye,Ue,qe,!1,rt,Bt)}(m,F[B],w||d.handleEvent,!1,d.h||d);if(!z)break;d.g[z.key]=z}d=o.H?C(o.H):{},o.m?(o.u||(o.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,d)):(o.u="GET",o.g.ea(o.A,o.u,null,d)),ls(),function(oe,ye,Ue,qe,rt,Bt){oe.info(function(){if(oe.g)if(Bt)for(var et="",Qt=Bt.split("&"),tt=0;tt<Qt.length;tt++){var Ke=Qt[tt].split("=");if(1<Ke.length){var ut=Ke[0];Ke=Ke[1];var Jt=ut.split("_");et=2<=Jt.length&&Jt[1]=="type"?et+(ut+"=")+Ke+"&":et+(ut+"=redacted&")}}else et=null;else et=Bt;return"XMLHTTP REQ ("+qe+") [attempt "+rt+"]: "+ye+`
`+Ue+`
`+et})}(o.i,o.u,o.A,o.l,o.R,o.m)}function Oh(o){return!!o.g&&o.u=="GET"&&o.L!=2&&o.j.Ca}function wa(o){o.S=Date.now()+o.I,Ph(o,o.I)}function Ph(o,d){if(o.B!=null)throw Error("WatchDog timer not null");o.B=us(k(o.ba,o),d)}function Qo(o){o.B&&(l.clearTimeout(o.B),o.B=null)}function cs(o){o.j.G==0||o.J||ac(o.j,o)}function jr(o){Qo(o);var d=o.M;d&&typeof d.ma=="function"&&d.ma(),o.M=null,bh(o.U),o.g&&(d=o.g,o.g=null,d.abort(),d.ma())}function Jo(o,d){try{var m=o.j;if(m.G!=0&&(m.g==o||Xo(m.h,o))){if(!o.K&&Xo(m.h,o)&&m.G==3){try{var w=m.Da.g.parse(d)}catch{w=null}if(Array.isArray(w)&&w.length==3){var F=w;if(F[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<o.F)ka(m),Sa(m);else break e;tl(m),sn(18)}}else m.za=F[1],0<m.za-m.T&&37500>F[2]&&m.F&&m.v==0&&!m.C&&(m.C=us(k(m.Za,m),6e3));if(1>=Uh(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else $r(m,11)}else if((o.K||m.g==o)&&ka(m),!_e(d))for(F=m.Da.g.parse(d),d=0;d<F.length;d++){let oe=F[d];if(m.T=oe[0],oe=oe[1],m.G==2)if(oe[0]=="c"){m.K=oe[1],m.ia=oe[2];let ye=oe[3];ye!=null&&(m.la=ye,m.j.info("VER="+m.la));let Ue=oe[4];Ue!=null&&(m.Aa=Ue,m.j.info("SVER="+m.Aa));let qe=oe[5];qe!=null&&typeof qe=="number"&&0<qe&&(w=1.5*qe,m.L=w,m.j.info("backChannelRequestTimeoutMs_="+w)),w=m;let rt=o.g;if(rt){let Bt=rt.g?rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bt){var B=w.h;B.g||Bt.indexOf("spdy")==-1&&Bt.indexOf("quic")==-1&&Bt.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Yo(B,B.h),B.h=null))}if(w.D){let et=rt.g?rt.g.getResponseHeader("X-HTTP-Session-Id"):null;et&&(w.ya=et,dt(w.I,w.D,et))}}if(m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-o.F,m.j.info("Handshake RTT: "+m.R+"ms")),(w=m).qa=uc(w,w.J?w.ia:null,w.W),o.K){Fh(w.h,o);var z=w.L;z&&(o.I=z),o.B&&(Qo(o),wa(o)),w.g=o}else ic(w);0<m.i.length&&Ca(m)}else oe[0]!="stop"&&oe[0]!="close"||$r(m,7);else m.G==3&&(oe[0]=="stop"||oe[0]=="close"?oe[0]=="stop"?$r(m,7):el(m):oe[0]!="noop"&&m.l&&m.l.ta(oe),m.v=0)}}ls(4)}catch{}}Ir.prototype.ca=function(o){o=o.target;let d=this.M;d&&er(o)==3?d.j():this.Y(o)},Ir.prototype.Y=function(o){try{if(o==this.g)e:{let rt=er(this.g);var d=this.g.Ba();let Bt=this.g.Z();if(!(3>rt)&&(rt!=3||this.g&&(this.h.h||this.g.oa()||Zh(this.g)))){this.J||rt!=4||d==7||(d==8||0>=Bt?ls(3):ls(2)),Qo(this);var m=this.g.Z();this.X=m;t:if(Oh(this)){var w=Zh(this.g);o="";var F=w.length,B=er(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){jr(this),cs(this);var z="";break t}this.h.i=new l.TextDecoder}for(d=0;d<F;d++)this.h.h=!0,o+=this.h.i.decode(w[d],{stream:!(B&&d==F-1)});w.length=0,this.h.g+=o,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=m==200,function(et,Qt,tt,Ke,ut,Jt,Nn){et.info(function(){return"XMLHTTP RESP ("+Ke+") [ attempt "+ut+"]: "+Qt+`
`+tt+`
`+Jt+" "+Nn})}(this.i,this.u,this.A,this.l,this.R,rt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var oe,ye=this.g;if((oe=ye.g?ye.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_e(oe)){var Ue=oe;break t}}Ue=null}if(m=Ue)Ei(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Jo(this,m);else{this.o=!1,this.s=3,sn(12),jr(this),cs(this);break e}}if(this.P){let et;for(m=!0;!this.J&&this.C<z.length;)if((et=function(Qt,tt){var Ke=Qt.C,ut=tt.indexOf(`
`,Ke);return ut==-1?Ho:isNaN(Ke=Number(tt.substring(Ke,ut)))?Dh:(ut+=1)+Ke>tt.length?Ho:(tt=tt.slice(ut,ut+Ke),Qt.C=ut+Ke,tt)}(this,z))==Ho){rt==4&&(this.s=4,sn(14),m=!1),Ei(this.i,this.l,null,"[Incomplete Response]");break}else if(et==Dh){this.s=4,sn(15),Ei(this.i,this.l,z,"[Invalid Chunk]"),m=!1;break}else Ei(this.i,this.l,et,null),Jo(this,et);if(Oh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rt!=4||z.length!=0||this.h.h||(this.s=1,sn(16),m=!1),this.o=this.o&&m,m){if(0<z.length&&!this.W){this.W=!0;var qe=this.j;qe.g==this&&qe.ba&&!qe.M&&(qe.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),nl(qe),qe.M=!0,sn(11))}}else Ei(this.i,this.l,z,"[Invalid Chunked Response]"),jr(this),cs(this)}else Ei(this.i,this.l,z,null),Jo(this,z);rt==4&&jr(this),this.o&&!this.J&&(rt==4?ac(this.j,this):(this.o=!1,wa(this)))}else(function(et){let Qt={};et=(et.g&&2<=er(et)&&et.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ke=0;Ke<et.length;Ke++){if(_e(et[Ke]))continue;var tt=function(Nn){var Ci=1;Nn=Nn.split(":");let rl=[];for(;0<Ci&&Nn.length;)rl.push(Nn.shift()),Ci--;return Nn.length&&rl.push(Nn.join(":")),rl}(et[Ke]);let ut=tt[0];if(typeof(tt=tt[1])!="string")continue;tt=tt.trim();let Jt=Qt[ut]||[];Qt[ut]=Jt,Jt.push(tt)}(function(Ke,ut){for(let Jt in Ke)ut.call(void 0,Ke[Jt],Jt,Ke)})(Qt,function(Ke){return Ke.join(", ")})})(this.g),m==400&&0<z.indexOf("Unknown SID")?(this.s=3,sn(12)):(this.s=0,sn(13)),jr(this),cs(this)}}}catch{}finally{}},Ir.prototype.cancel=function(){this.J=!0,jr(this)},Ir.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(function(d,m){d.info(function(){return"TIMEOUT: "+m})}(this.i,this.A),this.L!=2&&(ls(),sn(17)),jr(this),this.s=2,cs(this)):Ph(this,this.S-o)};var of=class{constructor(o,d){this.g=o,this.map=d}};function Lh(o){this.l=o||10,o=l.PerformanceNavigationTiming?0<(o=l.performance.getEntriesByType("navigation")).length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2"):!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mh(o){return!!o.h||!!o.g&&o.g.size>=o.j}function Uh(o){return o.h?1:o.g?o.g.size:0}function Xo(o,d){return o.h?o.h==d:!!o.g&&o.g.has(d)}function Yo(o,d){o.g?o.g.add(d):o.h=d}function Fh(o,d){o.h&&o.h==d?o.h=null:o.g&&o.g.has(d)&&o.g.delete(d)}function Vh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let d=o.i;for(let m of o.g.values())d=d.concat(m.D);return d}return Q(o.i)}function Bh(o,d){if(o.forEach&&typeof o.forEach=="function")o.forEach(d,void 0);else if(u(o)||typeof o=="string")Array.prototype.forEach.call(o,d,void 0);else for(var m=function(z){if(z.na&&typeof z.na=="function")return z.na();if(!z.V||typeof z.V!="function"){if(typeof Map<"u"&&z instanceof Map)return Array.from(z.keys());if(!(typeof Set<"u"&&z instanceof Set)){if(u(z)||typeof z=="string"){var oe=[];z=z.length;for(var ye=0;ye<z;ye++)oe.push(ye);return oe}for(let Ue in oe=[],ye=0,z)oe[ye++]=Ue;return oe}}}(o),w=function(z){if(z.V&&typeof z.V=="function")return z.V();if(typeof Map<"u"&&z instanceof Map||typeof Set<"u"&&z instanceof Set)return Array.from(z.values());if(typeof z=="string")return z.split("");if(u(z)){for(var oe=[],ye=z.length,Ue=0;Ue<ye;Ue++)oe.push(z[Ue]);return oe}for(Ue in oe=[],ye=0,z)oe[ye++]=z[Ue];return oe}(o),F=w.length,B=0;B<F;B++)d.call(void 0,w[B],m&&m[B],o)}Lh.prototype.cancel=function(){if(this.i=Vh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};var qh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zr(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof zr){this.h=o.h,Ia(this,o.j),this.o=o.o,this.g=o.g,_a(this,o.s),this.l=o.l;var d=o.i,m=new ps;m.i=d.i,d.g&&(m.g=new Map(d.g),m.h=d.h),jh(this,m),this.m=o.m}else o&&(d=String(o).match(qh))?(this.h=!1,Ia(this,d[1]||"",!0),this.o=ds(d[2]||""),this.g=ds(d[3]||"",!0),_a(this,d[4]),this.l=ds(d[5]||"",!0),jh(this,d[6]||"",!0),this.m=ds(d[7]||"")):(this.h=!1,this.i=new ps(null,this.h))}function Zn(o){return new zr(o)}function Ia(o,d,m){o.j=m?ds(d,!0):d,o.j&&(o.j=o.j.replace(/:$/,""))}function _a(o,d){if(d){if(isNaN(d=Number(d))||0>d)throw Error("Bad port number "+d);o.s=d}else o.s=null}function jh(o,d,m){var w,F;d instanceof ps?(o.i=d,w=o.i,(F=o.h)&&!w.j&&(_r(w),w.i=null,w.g.forEach(function(B,z){var oe=z.toLowerCase();z!=oe&&($h(this,z),Gh(this,oe,B))},w)),w.j=F):(m||(d=fs(d,cf)),o.i=new ps(d,o.h))}function dt(o,d,m){o.i.set(d,m)}function ba(o){return dt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ds(o,d){return o?d?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function fs(o,d,m){return typeof o=="string"?(o=encodeURI(o).replace(d,lf),m&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function lf(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}zr.prototype.toString=function(){var o=[],d=this.j;d&&o.push(fs(d,zh,!0),":");var m=this.g;return(m||d=="file")&&(o.push("//"),(d=this.o)&&o.push(fs(d,zh,!0),"@"),o.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),(m=this.s)!=null&&o.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&o.push("/"),o.push(fs(m,m.charAt(0)=="/"?hf:uf,!0))),(m=this.i.toString())&&o.push("?",m),(m=this.m)&&o.push("#",fs(m,df)),o.join("")};var zh=/[#\/\?@]/g,uf=/[#\?:]/g,hf=/[#\?]/g,cf=/[#\?@]/g,df=/#/g;function ps(o,d){this.h=this.g=null,this.i=o||null,this.j=!!d}function _r(o){o.g||(o.g=new Map,o.h=0,o.i&&function(d,m){if(d){d=d.split("&");for(var w=0;w<d.length;w++){var F=d[w].indexOf("="),B=null;if(0<=F){var z=d[w].substring(0,F);B=d[w].substring(F+1)}else z=d[w];m(z,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}(o.i,function(d,m){o.add(decodeURIComponent(d.replace(/\+/g," ")),m)}))}function $h(o,d){_r(o),d=Ti(o,d),o.g.has(d)&&(o.i=null,o.h-=o.g.get(d).length,o.g.delete(d))}function Kh(o,d){return _r(o),d=Ti(o,d),o.g.has(d)}function Gh(o,d,m){$h(o,d),0<m.length&&(o.i=null,o.g.set(Ti(o,d),Q(m)),o.h+=m.length)}function Ti(o,d){return d=String(d),o.j&&(d=d.toLowerCase()),d}function br(o,d,m,w,F){try{F&&(F.onload=null,F.onerror=null,F.onabort=null,F.ontimeout=null),w(m)}catch{}}function ff(){this.g=new af}function ms(o){this.l=o.Ub||null,this.j=o.eb||!1}function Ea(o,d){Wt.call(this),this.D=o,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Hh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function gs(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ys(o)}function ys(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Wh(o){let d="";return _(o,function(m,w){d+=w+":"+m+`\r
`}),d}function Zo(o,d,m){e:{for(w in m){var w=!1;break e}w=!0}w||(m=Wh(m),typeof o=="string"?m!=null&&encodeURIComponent(String(m)):dt(o,d,m))}function Tt(o){Wt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=ps.prototype).add=function(o,d){_r(this),this.i=null,o=Ti(this,o);var m=this.g.get(o);return m||this.g.set(o,m=[]),m.push(d),this.h+=1,this},t.forEach=function(o,d){_r(this),this.g.forEach(function(m,w){m.forEach(function(F){o.call(d,F,w,this)},this)},this)},t.na=function(){_r(this);let o=Array.from(this.g.values()),d=Array.from(this.g.keys()),m=[];for(let w=0;w<d.length;w++){let F=o[w];for(let B=0;B<F.length;B++)m.push(d[w])}return m},t.V=function(o){_r(this);let d=[];if(typeof o=="string")Kh(this,o)&&(d=d.concat(this.g.get(Ti(this,o))));else{o=Array.from(this.g.values());for(let m=0;m<o.length;m++)d=d.concat(o[m])}return d},t.set=function(o,d){return _r(this),this.i=null,Kh(this,o=Ti(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[d]),this.h+=1,this},t.get=function(o,d){return o&&0<(o=this.V(o)).length?String(o[0]):d},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],d=Array.from(this.g.keys());for(var m=0;m<d.length;m++){var w=d[m];let B=encodeURIComponent(String(w)),z=this.V(w);for(w=0;w<z.length;w++){var F=B;z[w]!==""&&(F+="="+encodeURIComponent(String(z[w]))),o.push(F)}}return this.i=o.join("&")},O(ms,$o),ms.prototype.g=function(){return new Ea(this.l,this.j)},ms.prototype.i=(r={},function(){return r}),O(Ea,Wt),(t=Ea.prototype).open=function(o,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=d,this.readyState=1,ys(this)},t.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(d.body=o),(this.D||l).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gs(this)),this.readyState=0},t.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ys(this)),this.g&&(this.readyState=3,ys(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(l.ReadableStream!==void 0&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var d=o.value?o.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!o.done}))&&(this.response=this.responseText+=d)}o.done?gs(this):ys(this),this.readyState==3&&Hh(this)}},t.Ra=function(o){this.g&&(this.response=this.responseText=o,gs(this))},t.Qa=function(o){this.g&&(this.response=o,gs(this))},t.ga=function(){this.g&&gs(this)},t.setRequestHeader=function(o,d){this.u.append(o,d)},t.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],d=this.h.entries();for(var m=d.next();!m.done;)o.push((m=m.value)[0]+": "+m[1]),m=d.next();return o.join(`\r
`)},Object.defineProperty(Ea.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}}),O(Tt,Wt);var pf=/^https?$/i,mf=["POST","PUT"];function Qh(o,d){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=d,o.m=5,Jh(o),Ta(o)}function Jh(o){o.A||(o.A=!0,rn(o,"complete"),rn(o,"error"))}function Xh(o){if(o.h&&s!==void 0&&(!o.v[1]||er(o)!=4||o.Z()!=2)){if(o.u&&er(o)==4)Ih(o.Ea,0,o);else if(rn(o,"readystatechange"),er(o)==4){o.h=!1;try{let z=o.Z();switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d,m,w=!0;break;default:w=!1}if(!(d=w)){if(m=z===0){var F=String(o.D).match(qh)[1]||null;!F&&l.self&&l.self.location&&(F=l.self.location.protocol.slice(0,-1)),m=!pf.test(F?F.toLowerCase():"")}d=m}if(d)rn(o,"complete"),rn(o,"success");else{o.m=6;try{var B=2<er(o)?o.g.statusText:""}catch{B=""}o.l=B+" ["+o.Z()+"]",Jh(o)}}finally{Ta(o)}}}}function Ta(o,d){if(o.g){Yh(o);let m=o.g,w=o.v[0]?()=>{}:null;o.g=null,o.v=null,d||rn(o,"ready");try{m.onreadystatechange=w}catch{}}}function Yh(o){o.I&&(l.clearTimeout(o.I),o.I=null)}function er(o){return o.g?o.g.readyState:0}function Zh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function vs(o,d,m){return m&&m.internalChannelParams&&m.internalChannelParams[o]||d}function ec(o){this.Aa=0,this.i=[],this.j=new hs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vs("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vs("baseRetryDelayMs",5e3,o),this.cb=vs("retryDelaySeedMs",1e4,o),this.Wa=vs("forwardChannelMaxRetries",2,o),this.wa=vs("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Lh(o&&o.concurrentRequestLimit),this.Da=new ff,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function el(o){if(tc(o),o.G==3){var d=o.U++,m=Zn(o.I);if(dt(m,"SID",o.K),dt(m,"RID",d),dt(m,"TYPE","terminate"),ws(o,m),(d=new Ir(o,o.j,d)).L=2,d.v=ba(Zn(m)),m=!1,l.navigator&&l.navigator.sendBeacon)try{m=l.navigator.sendBeacon(d.v.toString(),"")}catch{}!m&&l.Image&&(new Image().src=d.v,m=!0),m||(d.g=hc(d.j,null),d.g.ea(d.v)),d.F=Date.now(),wa(d)}lc(o)}function Sa(o){o.g&&(nl(o),o.g.cancel(),o.g=null)}function tc(o){Sa(o),o.u&&(l.clearTimeout(o.u),o.u=null),ka(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function Ca(o){if(!Mh(o.h)&&!o.s){o.s=!0;var d=o.Ga;ns||yh(),rs||(ns(),rs=!0),vr.add(d,o),o.B=0}}function nc(o,d){var m;m=d?d.l:o.U++;let w=Zn(o.I);dt(w,"SID",o.K),dt(w,"RID",m),dt(w,"AID",o.T),ws(o,w),o.m&&o.o&&Zo(w,o.m,o.o),m=new Ir(o,o.j,m,o.B+1),o.m===null&&(m.H=o.o),d&&(o.i=d.D.concat(o.i)),d=rc(o,m,1e3),m.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Yo(o.h,m),Wo(m,w,d)}function ws(o,d){o.H&&_(o.H,function(m,w){dt(d,w,m)}),o.l&&Bh({},function(m,w){dt(d,w,m)})}function rc(o,d,m){m=Math.min(o.i.length,m);var w=o.l?k(o.l.Na,o.l,o):null;e:{var F=o.i;let B=-1;for(;;){let z=["count="+m];B==-1?0<m?(B=F[0].g,z.push("ofs="+B)):B=0:z.push("ofs="+B);let oe=!0;for(let ye=0;ye<m;ye++){let Ue=F[ye].g,qe=F[ye].map;if(0>(Ue-=B))B=Math.max(0,F[ye].g-100),oe=!1;else try{(function(rt,Bt,et){let Qt=et||"";try{Bh(rt,function(tt,Ke){let ut=tt;c(tt)&&(ut=zo(tt)),Bt.push(Qt+Ke+"="+encodeURIComponent(ut))})}catch(tt){throw Bt.push(Qt+"type="+encodeURIComponent("_badmap")),tt}})(qe,z,"req"+Ue+"_")}catch{w&&w(qe)}}if(oe){w=z.join("&");break e}}}return o=o.i.splice(0,m),d.D=o,w}function ic(o){if(!o.g&&!o.u){o.Y=1;var d=o.Fa;ns||yh(),rs||(ns(),rs=!0),vr.add(d,o),o.v=0}}function tl(o){return!o.g&&!o.u&&!(3<=o.v)&&(o.Y++,o.u=us(k(o.Fa,o),oc(o,o.v)),o.v++,!0)}function nl(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function sc(o){o.g=new Ir(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var d=Zn(o.qa);dt(d,"RID","rpc"),dt(d,"SID",o.K),dt(d,"AID",o.T),dt(d,"CI",o.F?"0":"1"),!o.F&&o.ja&&dt(d,"TO",o.ja),dt(d,"TYPE","xmlhttp"),ws(o,d),o.m&&o.o&&Zo(d,o.m,o.o),o.L&&(o.g.I=o.L);var m=o.g;o=o.ia,m.L=1,m.v=ba(Zn(d)),m.m=null,m.P=!0,Rh(m,o)}function ka(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function ac(o,d){var m=null;if(o.g==d){ka(o),nl(o),o.g=null;var w=2}else{if(!Xo(o.h,d))return;m=d.D,Fh(o.h,d),w=1}if(o.G!=0){if(d.o)if(w==1){m=d.m?d.m.length:0,d=Date.now()-d.F;var F,B=o.B;rn(w=ga(),new Ah(w,m)),Ca(o)}else ic(o);else if((B=d.s)==3||B==0&&0<d.X||!(w==1&&(F=d,!(Uh(o.h)>=o.h.j-(o.s?1:0))&&(o.s?(o.i=F.D.concat(o.i),!0):o.G!=1&&o.G!=2&&!(o.B>=(o.Va?0:o.Wa))&&(o.s=us(k(o.Ga,o,F),oc(o,o.B)),o.B++,!0)))||w==2&&tl(o)))switch(m&&0<m.length&&((d=o.h).i=d.i.concat(m)),B){case 1:$r(o,5);break;case 4:$r(o,10);break;case 3:$r(o,6);break;default:$r(o,2)}}}function oc(o,d){let m=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(m*=2),m*d}function $r(o,d){if(o.j.info("Error code "+d),d==2){var m=k(o.fb,o),w=o.Xa;let F=!w;w=new zr(w||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ia(w,"https"),ba(w),F?function(B,z){let oe=new hs;if(l.Image){let ye=new Image;ye.onload=N(br,oe,"TestLoadImage: loaded",!0,z,ye),ye.onerror=N(br,oe,"TestLoadImage: error",!1,z,ye),ye.onabort=N(br,oe,"TestLoadImage: abort",!1,z,ye),ye.ontimeout=N(br,oe,"TestLoadImage: timeout",!1,z,ye),l.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=B}else z(!1)}(w.toString(),m):function(B,z){let oe=new hs,ye=new AbortController,Ue=setTimeout(()=>{ye.abort(),br(oe,"TestPingServer: timeout",!1,z)},1e4);fetch(B,{signal:ye.signal}).then(qe=>{clearTimeout(Ue),qe.ok?br(oe,"TestPingServer: ok",!0,z):br(oe,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Ue),br(oe,"TestPingServer: error",!1,z)})}(w.toString(),m)}else sn(2);o.G=0,o.l&&o.l.sa(d),lc(o),tc(o)}function lc(o){if(o.G=0,o.ka=[],o.l){let d=Vh(o.h);(d.length!=0||o.i.length!=0)&&(se(o.ka,d),se(o.ka,o.i),o.h.i.length=0,Q(o.i),o.i.length=0),o.l.ra()}}function uc(o,d,m){var w=m instanceof zr?Zn(m):new zr(m);if(w.g!="")d&&(w.g=d+"."+w.g),_a(w,w.s);else{var F=l.location;w=F.protocol,d=d?d+"."+F.hostname:F.hostname,F=+F.port;var B=new zr(null);w&&Ia(B,w),d&&(B.g=d),F&&_a(B,F),m&&(B.l=m),w=B}return m=o.D,d=o.ya,m&&d&&dt(w,m,d),dt(w,"VER",o.la),ws(o,w),w}function hc(o,d,m){if(d&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(d=new Tt(o.Ca&&!o.pa?new ms({eb:m}):o.pa)).Ha(o.J),d}function cc(){}function Aa(){}function _n(o,d){Wt.call(this),this.g=new ec(d),this.l=o,this.h=d&&d.messageUrlParams||null,o=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(o?o["X-WebChannel-Content-Type"]=d.messageContentType:o={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(o?o["X-WebChannel-Client-Profile"]=d.va:o={"X-WebChannel-Client-Profile":d.va}),this.g.S=o,(o=d&&d.Sb)&&!_e(o)&&(this.g.m=o),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!_e(d)&&(this.g.D=d,(o=this.h)!==null&&d in o&&d in(o=this.h)&&delete o[d]),this.j=new Si(this)}function dc(o){Ko.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var d=o.__sm__;if(d){e:{for(let m in d){o=m;break e}o=void 0}(this.i=o)&&(o=this.i,d=d!==null&&o in d?d[o]:void 0),this.data=d}else this.data=o}function fc(){Go.call(this),this.status=1}function Si(o){this.g=o}(t=Tt.prototype).Ha=function(o){this.J=o},t.ea=function(o,d,m,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);d=d?d.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():e.g(),this.v=this.o?Eh(this.o):Eh(e),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(d,String(o),!0),this.B=!1}catch(B){Qh(this,B);return}if(o=m||"",m=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var F in w)m.set(F,w[F]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(let B of w.keys())m.set(B,w.get(B));else throw Error("Unknown input type for opt_headers: "+String(w));for(let[B,z]of(w=Array.from(m.keys()).find(oe=>oe.toLowerCase()=="content-type"),F=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(mf,d,void 0))||w||F||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),m))this.g.setRequestHeader(B,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yh(this),this.u=!0,this.g.send(o),this.u=!1}catch(B){Qh(this,B)}},t.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,rn(this,"complete"),rn(this,"abort"),Ta(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ta(this,!0)),Tt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Xh(this):this.bb())},t.bb=function(){Xh(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<er(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(o){if(this.g){var d=this.g.responseText;return o&&d.indexOf(o)==0&&(d=d.substring(o.length)),sf(d)}},t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)},(t=ec.prototype).la=8,t.G=1,t.connect=function(o,d,m,w){sn(0),this.W=o,this.H=d||{},m&&w!==void 0&&(this.H.OSID=m,this.H.OAID=w),this.F=this.X,this.I=uc(this,null,this.W),Ca(this)},t.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let F=new Ir(this,this.j,o),B=this.o;if(this.S&&(B?L(B=C(B),this.S):B=this.S),this.m!==null||this.O||(F.H=B,B=null),this.P)e:{for(var d=0,m=0;m<this.i.length;m++){t:{var w=this.i[m];if("__data__"in w.map&&typeof(w=w.map.__data__)=="string"){w=w.length;break t}w=void 0}if(w===void 0)break;if(4096<(d+=w)){d=m;break e}if(d===4096||m===this.i.length-1){d=m+1;break e}}d=1e3}else d=1e3;d=rc(this,F,d),dt(m=Zn(this.I),"RID",o),dt(m,"CVER",22),this.D&&dt(m,"X-HTTP-Session-Id",this.D),ws(this,m),B&&(this.O?d="headers="+encodeURIComponent(String(Wh(B)))+"&"+d:this.m&&Zo(m,this.m,B)),Yo(this.h,F),this.Ua&&dt(m,"TYPE","init"),this.P?(dt(m,"$req",d),dt(m,"SID","null"),F.T=!0,Wo(F,m,null)):Wo(F,m,d),this.G=2}}else this.G==3&&(o?nc(this,o):this.i.length==0||Mh(this.h)||nc(this))},t.Fa=function(){if(this.u=null,sc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=us(k(this.ab,this),o)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,sn(10),Sa(this),sc(this))},t.Za=function(){this.C!=null&&(this.C=null,Sa(this),tl(this),sn(19))},t.fb=function(o){o?(this.j.info("Successfully pinged google.com"),sn(2)):(this.j.info("Failed to ping google.com"),sn(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=cc.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Aa.prototype.g=function(o,d){return new _n(o,d)},O(_n,Wt),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){el(this.g)},_n.prototype.o=function(o){var d=this.g;if(typeof o=="string"){var m={};m.__data__=o,o=m}else this.u&&((m={}).__data__=zo(o),o=m);d.i.push(new of(d.Ya++,o)),d.G==3&&Ca(d)},_n.prototype.N=function(){this.g.l=null,delete this.j,el(this.g),delete this.g,_n.aa.N.call(this)},O(dc,Ko),O(fc,Go),O(Si,cc),Si.prototype.ua=function(){rn(this.g,"a")},Si.prototype.ta=function(o){rn(this.g,new dc(o))},Si.prototype.sa=function(o){rn(this.g,new fc)},Si.prototype.ra=function(){rn(this.g,"b")},Aa.prototype.createWebChannel=Aa.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,Oe=gt.createWebChannelTransport=function(){return new Aa},Ce=gt.getStatEventTarget=function(){return ga()},he=gt.Event=qr,ne=gt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ya.NO_ERROR=0,ya.TIMEOUT=8,ya.HTTP_ERROR=6,ie=gt.ErrorCode=ya,Nh.COMPLETE="complete",ze=gt.EventType=Nh,Th.EventType=os,os.OPEN="a",os.CLOSE="b",os.ERROR="c",os.MESSAGE="d",Wt.prototype.listen=Wt.prototype.K,St=gt.WebChannel=Th,it=gt.FetchXmlHttpFactory=ms,Tt.prototype.listenOnce=Tt.prototype.L,Tt.prototype.getLastError=Tt.prototype.Ka,Tt.prototype.getLastErrorCode=Tt.prototype.Ba,Tt.prototype.getStatus=Tt.prototype.Z,Tt.prototype.getResponseJson=Tt.prototype.Oa,Tt.prototype.getResponseText=Tt.prototype.oa,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Ha,He=gt.XhrIo=Tt}).apply(an!==void 0?an:typeof Ge<"u"?Ge:typeof window<"u"?window:{});var We=De(6195).Buffer;let ot="@firebase/firestore";class xe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xe.UNAUTHENTICATED=new xe(null),xe.GOOGLE_CREDENTIALS=new xe("google-credentials-uid"),xe.FIRST_PARTY=new xe("first-party-uid"),xe.MOCK_USER=new xe("mock-user");let yt="10.12.5",xt=new pt.Yd("@firebase/firestore");function $t(){return xt.logLevel}function H(r,...e){if(xt.logLevel<=pt.in.DEBUG){let t=e.map(Dt);xt.debug(`Firestore (${yt}): ${r}`,...t)}}function Ve(r,...e){if(xt.logLevel<=pt.in.ERROR){let t=e.map(Dt);xt.error(`Firestore (${yt}): ${r}`,...t)}}function Yt(r,...e){if(xt.logLevel<=pt.in.WARN){let t=e.map(Dt);xt.warn(`Firestore (${yt}): ${r}`,...t)}}function Dt(r){if(typeof r=="string")return r;try{return JSON.stringify(r)}catch{return r}}function K(r="Unexpected state"){let e=`FIRESTORE (${yt}) INTERNAL ASSERTION FAILED: `+r;throw Ve(e),Error(e)}let M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ee extends Fe.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class V{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class q{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xe.UNAUTHENTICATED))}shutdown(){}}class Y{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class me{constructor(e){this.t=e,this.currentUser=xe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new Rt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Rt,e.enqueueRetryable(()=>i(this.currentUser))};let l=()=>{let c=s;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},u=c=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),l()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Rt)}},0),l()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(typeof n.accessToken=="string"||K(),new V(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return e===null||typeof e=="string"||K(),new xe(e)}}class ce{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=xe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Pe{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ce(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(xe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Qe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vt{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=s=>{s.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let l=s.token!==this.R;return this.R=s.token,H("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(typeof t.token=="string"||K(),this.R=t.token,new Qe(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class wt{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=function(s){let l=typeof Ge<"u"&&(Ge.crypto||Ge.msCrypto),u=new Uint8Array(40);if(l&&typeof l.getRandomValues=="function")l.getRandomValues(u);else for(let c=0;c<40;c++)u[c]=Math.floor(256*Math.random());return u}(0);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function ve(r,e){return r<e?-1:r>e?1:0}function bt(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}class W{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ee(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800||e>=253402300800)throw new ee(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return W.fromMillis(Date.now())}static fromDate(e){return W.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3);return new W(t,Math.floor(1e6*(e-1e3*t)))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class R{constructor(e){this.timestamp=e}static fromTimestamp(e){return new R(e)}static min(){return new R(new W(0,0))}static max(){return new R(new W(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Z{constructor(e,t,n){t===void 0?t=0:t>e.length&&K(),n===void 0?n=e.length-t:n>e.length-t&&K(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Z.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof Z?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),l=t.get(i);if(s<l)return-1;if(s>l)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class te extends Z{construct(e,t,n){return new te(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new ee(M.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new te(t)}static emptyPath(){return new te([])}}let Se=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class we extends Z{construct(e,t,n){return new we(e,t,n)}static isValidIdentifier(e){return Se.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),we.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new we(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new ee(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},l=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new ee(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ee(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?l=!l:u!=="."||l?n+=u:s(),i++}if(s(),l)throw new ee(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new we(t)}static emptyPath(){return new we([])}}class J{constructor(e){this.path=e}static fromPath(e){return new J(te.fromString(e))}static fromName(e){return new J(te.fromString(e).popFirst(5))}static empty(){return new J(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new te(e.slice()))}}class je{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Be(r){return r.fields.find(e=>e.kind===2)}function P(r){return r.fields.filter(e=>e.kind!==2)}je.UNKNOWN_ID=-1;class S{constructor(e,t){this.fieldPath=e,this.kind=t}}class ${constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new $(0,de.min())}}function U(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1;return new de(R.fromTimestamp(n===1e9?new W(t+1,0):new W(t,n)),J.empty(),e)}function X(r){return new de(r.readTime,r.key,-1)}class de{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new de(R.min(),J.empty(),-1)}static max(){return new de(R.max(),J.empty(),-1)}}function Ie(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0||(t=J.comparator(r.documentKey,e.documentKey))!==0?t:ve(r.largestBatchId,e.largestBatchId)}let pe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ae{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function be(r){if(r.code!==M.FAILED_PRECONDITION||r.message!==pe)throw r;H("LocalStore","Unexpectedly lost primary lease")}class T{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new T((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof T?t:T.resolve(t)}catch(t){return T.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):T.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):T.reject(t)}static resolve(e){return new T((t,n)=>{t(e)})}static reject(e){return new T((t,n)=>{n(e)})}static waitFor(e){return new T((t,n)=>{let i=0,s=0,l=!1;e.forEach(u=>{++i,u.next(()=>{++s,l&&s===i&&t()},c=>n(c))}),l=!0,s===i&&t()})}static or(e){let t=T.resolve(!1);for(let n of e)t=t.next(i=>i?T.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new T((n,i)=>{let s=e.length,l=Array(s),u=0;for(let c=0;c<s;c++){let g=c;t(e[g]).next(v=>{l[g]=v,++u===s&&n(l)},v=>i(v))}})}static doWhile(e,t){return new T((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}}class st{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Rt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ot(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=nr(n.target.error);this.V.reject(new Ot(e,i))}}static open(e,t,n,i){try{return new st(t,e.transaction(i,n))}catch(s){throw new Ot(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(H("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){return new Ct(this.transaction.objectStore(e))}}class Le{constructor(e,t,n){this.name=e,this.version=t,this.p=n,Le.S((0,Fe.z$)())===12.2&&Ve("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return H("SimpleDb","Removing database:",e),Zt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,Fe.hl)())return!1;if(Le.C())return!0;let e=(0,Fe.z$)(),t=Le.S(e),n=ht(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}async M(e){return this.db||(H("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{t(s.target.result)},i.onblocked=()=>{n(new Ot(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let l=s.target.error;l.name==="VersionError"?n(new ee(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):l.name==="InvalidStateError"?n(new ee(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+l)):n(new Ot(e,l))},i.onupgradeneeded=s=>{H("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let l=s.target.result;this.p.O(l,i.transaction,s.oldVersion,this.version).next(()=>{H("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,i){let s=t==="readonly",l=0;for(;;){++l;try{this.db=await this.M(e);let u=st.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(g=>(u.g(),g)).catch(g=>(u.abort(g),T.reject(g))).toPromise();return c.catch(()=>{}),await u.m,c}catch(u){let c=u.name!=="FirebaseError"&&l<3;if(H("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ht(r){let e=r.match(/Android ([\d.]+)/i);return Number(e?e[1].split(".").slice(0,2).join("."):"-1")}class It{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Zt(this.B.delete())}}class Ot extends ee{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Xe(r){return r.name==="IndexedDbTransactionError"}class Ct{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(H("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(H("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Zt(n)}add(e){return H("SimpleDb","ADD",this.store.name,e,e),Zt(this.store.add(e))}get(e){return Zt(this.store.get(e)).next(t=>(t===void 0&&(t=null),H("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return H("SimpleDb","DELETE",this.store.name,e),Zt(this.store.delete(e))}count(){return H("SimpleDb","COUNT",this.store.name),Zt(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new T((l,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{l(c.target.result)}})}{let s=this.cursor(n),l=[];return this.W(s,(u,c)=>{l.push(c)}).next(()=>l)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new T((i,s)=>{n.onerror=l=>{s(l.target.error)},n.onsuccess=l=>{i(l.target.result)}})}j(e,t){H("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,l,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new T((n,i)=>{t.onerror=s=>{i(nr(s.target.error))},t.onsuccess=s=>{let l=s.target.result;l?e(l.primaryKey,l.value).next(u=>{u?l.continue():n()}):n()}})}W(e,t){let n=[];return new T((i,s)=>{e.onerror=l=>{s(l.target.error)},e.onsuccess=l=>{let u=l.target.result;if(!u)return void i();let c=new It(u),g=t(u.primaryKey,u.value,c);if(g instanceof T){let v=g.catch(k=>(c.done(),T.reject(k)));n.push(v)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>T.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Zt(r){return new T((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{t(nr(n.target.error))}})}let on=!1;function nr(r){let e=Le.S((0,Fe.z$)());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new ee("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return on||(on=!0,setTimeout(()=>{throw n},0)),n}}return r}class Kr{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){H("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{H("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Xe(t)?H("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await be(t)}await this.X(6e4)})}}class Gr{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){let n=new Set,i=t,s=!0;return T.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(l=>{if(l!==null&&!n.has(l))return H("IndexBackfiller",`Processing collection: ${l}`),this.ne(e,l,i).next(u=>{i-=u,n.add(l)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let l=s.changes;return this.localStore.indexManager.updateIndexEntries(e,l).next(()=>this.re(i,s)).next(u=>(H("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>l.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let l=X(s);Ie(l,n)>0&&(n=l)}),new de(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ct{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}function Fn(r){return r==null}function Pt(r){return r===0&&1/r==-1/0}function bn(r){return typeof r=="number"&&Number.isInteger(r)&&!Pt(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function nt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e+=""),e=function(n,i){let s=i,l=n.length;for(let u=0;u<l;u++){let c=n.charAt(u);switch(c){case"\0":s+="";break;case"":s+="";break;default:s+=c}}return s}(r.get(t),e);return e+""}function kt(r){let e=r.length;if(e>=2||K(),e===2)return r.charAt(0)===""&&r.charAt(1)===""||K(),te.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let l=r.indexOf("",s);switch((l<0||l>t)&&K(),r.charAt(l+1)){case"":let u,c=r.substring(s,l);i.length===0?u=c:(i+=c,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,l)+"\0";break;case"":i+=r.substring(s,l+1);break;default:K()}s=l+2}return new te(n)}ct.oe=-1;let gn=["userId","batchId"],Hn={},Na=["prefixPath","collectionGroup","readTime","documentId"],xa=["prefixPath","collectionGroup","documentId"],Da=["collectionGroup","readTime","prefixPath","documentId"],Ra=["canonicalId","targetId"],Oa=["targetId","path"],rr=["path","targetId"],ki=["collectionId","parent"],Er=["indexId","uid"],_s=["uid","sequenceNumber"],Tr=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Vn=["indexId","uid","orderedDocumentKey"],xn=["userId","collectionPath","documentId"],Bn=["userId","collectionPath","largestBatchId"],qn=["userId","collectionGroup","largestBatchId"],Dn=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],bs=[...Dn,"documentOverlays"],ir=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Hr=[...ir,"indexConfiguration","indexState","indexEntries"],Pa=[...Hr,"globals"];class Ai extends Ae{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Et(r,e){return Le.F(r._e,e)}function Sr(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function En(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Wr(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class at{constructor(e,t){this.comparator=e,this.root=t||At.EMPTY}insert(e,t){return new at(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,At.BLACK,null,null))}remove(e){return new at(this.comparator,this.root.remove(e,this.comparator).copy(null,null,At.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Tn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Tn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Tn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Tn(this.root,e,this.comparator,!0)}}class Tn{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class At{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??At.RED,this.left=i??At.EMPTY,this.right=s??At.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new At(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return(i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return At.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return At.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,At.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,At.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw K();let e=this.left.check();if(e!==this.right.check())throw K();return e+(this.isRed()?0:1)}}At.EMPTY=null,At.RED=!0,At.BLACK=!1,At.EMPTY=new class{constructor(){this.size=0}get key(){throw K()}get value(){throw K()}get color(){throw K()}get left(){throw K()}get right(){throw K()}copy(r,e,t,n,i){return this}insert(r,e,t){return new At(r,e)}remove(r,e){return this}isEmpty(){return!0}inorderTraversal(r){return!1}reverseTraversal(r){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ye{constructor(e){this.comparator=e,this.data=new at(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cr(this.data.getIterator())}getIteratorFrom(e){return new Cr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ye)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new Ye(this.comparator);return t.data=e,t}}class Cr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Wn(r){return r.hasNext()?r.getNext():void 0}class jt{constructor(e){this.fields=e,e.sort(we.comparator)}static empty(){return new jt([])}unionWith(e){let t=new Ye(we.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new jt(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bt(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Qr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class lt{constructor(e){this.binaryString=e}static fromBase64String(e){return new lt(function(t){try{return atob(t)}catch(n){throw typeof DOMException<"u"&&n instanceof DOMException?new Qr("Invalid base64 string: "+n):n}}(e))}static fromUint8Array(e){return new lt(function(t){let n="";for(let i=0;i<t.length;++i)n+=String.fromCharCode(t[i]);return n}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}lt.EMPTY_BYTE_STRING=new lt("");let Ni=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rn(r){if(r||K(),typeof r=="string"){let e=0,t=Ni.exec(r);if(t||K(),t[1]){let n=t[1];e=Number(n=(n+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(r).getTime()/1e3),nanos:e}}return{seconds:$e(r.seconds),nanos:$e(r.nanos)}}function $e(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Sn(r){return typeof r=="string"?lt.fromBase64String(r):lt.fromUint8Array(r)}function Jr(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function kr(r){let e=r.mapValue.fields.__previous_value__;return Jr(e)?kr(e):e}function jn(r){let e=Rn(r.mapValue.fields.__local_write_time__.timestampValue);return new W(e.seconds,e.nanos)}class Es{constructor(e,t,n,i,s,l,u,c,g){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=g}}class yn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new yn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof yn&&e.projectId===this.projectId&&e.database===this.database}}let vn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},sr={nullValue:"NULL_VALUE"};function On(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Jr(r)?4:Nr(r)?9007199254740991:10:K()}function Cn(r,e){if(r===e)return!0;let t=On(r);if(t!==On(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return jn(r).isEqual(jn(e));case 3:return function(n,i){if(typeof n.timestampValue=="string"&&typeof i.timestampValue=="string"&&n.timestampValue.length===i.timestampValue.length)return n.timestampValue===i.timestampValue;let s=Rn(n.timestampValue),l=Rn(i.timestampValue);return s.seconds===l.seconds&&s.nanos===l.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return Sn(r.bytesValue).isEqual(Sn(e.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return $e(r.geoPointValue.latitude)===$e(e.geoPointValue.latitude)&&$e(r.geoPointValue.longitude)===$e(e.geoPointValue.longitude);case 2:return function(n,i){if("integerValue"in n&&"integerValue"in i)return $e(n.integerValue)===$e(i.integerValue);if("doubleValue"in n&&"doubleValue"in i){let s=$e(n.doubleValue),l=$e(i.doubleValue);return s===l?Pt(s)===Pt(l):isNaN(s)&&isNaN(l)}return!1}(r,e);case 9:return bt(r.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:return function(n,i){let s=n.mapValue.fields||{},l=i.mapValue.fields||{};if(Sr(s)!==Sr(l))return!1;for(let u in s)if(s.hasOwnProperty(u)&&(l[u]===void 0||!Cn(s[u],l[u])))return!1;return!0}(r,e);default:return K()}}function ar(r,e){return(r.values||[]).find(t=>Cn(t,e))!==void 0}function Pn(r,e){if(r===e)return 0;let t=On(r),n=On(e);if(t!==n)return ve(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ve(r.booleanValue,e.booleanValue);case 2:return function(i,s){let l=$e(i.integerValue||i.doubleValue),u=$e(s.integerValue||s.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(r,e);case 3:return Ts(r.timestampValue,e.timestampValue);case 4:return Ts(jn(r),jn(e));case 5:return ve(r.stringValue,e.stringValue);case 6:return function(i,s){let l=Sn(i),u=Sn(s);return l.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(i,s){let l=i.split("/"),u=s.split("/");for(let c=0;c<l.length&&c<u.length;c++){let g=ve(l[c],u[c]);if(g!==0)return g}return ve(l.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,s){let l=ve($e(i.latitude),$e(s.latitude));return l!==0?l:ve($e(i.longitude),$e(s.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(i,s){let l=i.values||[],u=s.values||[];for(let c=0;c<l.length&&c<u.length;++c){let g=Pn(l[c],u[c]);if(g)return g}return ve(l.length,u.length)}(r.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===vn.mapValue&&s===vn.mapValue)return 0;if(i===vn.mapValue)return 1;if(s===vn.mapValue)return-1;let l=i.fields||{},u=Object.keys(l),c=s.fields||{},g=Object.keys(c);u.sort(),g.sort();for(let v=0;v<u.length&&v<g.length;++v){let k=ve(u[v],g[v]);if(k!==0)return k;let N=Pn(l[u[v]],c[g[v]]);if(N!==0)return N}return ve(u.length,g.length)}(r.mapValue,e.mapValue);default:throw K()}}function Ts(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ve(r,e);let t=Rn(r),n=Rn(e),i=ve(t.seconds,n.seconds);return i!==0?i:ve(t.nanos,n.nanos)}function en(r){var e,t;return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(n){let i=Rn(n);return`time(${i.seconds},${i.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Sn(r.bytesValue).toBase64():"referenceValue"in r?(e=r.referenceValue,J.fromName(e).toString()):"geoPointValue"in r?(t=r.geoPointValue,`geo(${t.latitude},${t.longitude})`):"arrayValue"in r?function(n){let i="[",s=!0;for(let l of n.values||[])s?s=!1:i+=",",i+=en(l);return i+"]"}(r.arrayValue):"mapValue"in r?function(n){let i=Object.keys(n.fields||{}).sort(),s="{",l=!0;for(let u of i)l?l=!1:s+=",",s+=`${u}:${en(n.fields[u])}`;return s+"}"}(r.mapValue):K()}function Ln(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function xi(r){return!!r&&"integerValue"in r}function Ar(r){return!!r&&"arrayValue"in r}function Ss(r){return!!r&&"nullValue"in r}function Di(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Xr(r){return!!r&&"mapValue"in r}function kn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return En(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=kn(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=kn(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Nr(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Cs(r,e){let t=Pn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function ks(r,e){let t=Pn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Mt{constructor(e){this.value=e}static empty(){return new Mt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!Xr(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=kn(t)}setAll(e){let t=we.emptyPath(),n={},i=[];e.forEach((l,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}l?n[u.lastSegment()]=kn(l):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());Xr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Xr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(En(t,(s,l)=>e[s]=l),n))delete e[i]}clone(){return new Mt(kn(this.value))}}class mt{constructor(e,t,n,i,s,l,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=l,this.documentState=u}static newInvalidDocument(e){return new mt(e,0,R.min(),R.min(),R.min(),Mt.empty(),0)}static newFoundDocument(e,t,n,i){return new mt(e,1,t,R.min(),n,i,0)}static newNoDocument(e,t){return new mt(e,2,t,R.min(),R.min(),Mt.empty(),0)}static newUnknownDocument(e,t){return new mt(e,3,t,R.min(),R.min(),Mt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(R.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Mt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Mt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=R.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zn{constructor(e,t){this.position=e,this.inclusive=t}}function As(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],l=r.position[i];if(n=s.field.isKeyField()?J.comparator(J.fromName(l.referenceValue),t.key):Pn(l,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Ns(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Cn(r.position[t],e.position[t]))return!1;return!0}class or{constructor(e,t="asc"){this.field=e,this.dir=t}}class Ri{}class Me extends Ri{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new La(e,t,n):t==="array-contains"?new Fa(e,n):t==="in"?new Mi(e,n):t==="not-in"?new Va(e,n):t==="array-contains-any"?new Ds(e,n):new Me(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Ma(e,n):new Ua(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Pn(t,this.value)):t!==null&&On(this.value)===On(t)&&this.matchesComparison(Pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return K()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ze extends Ri{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ze(e,t)}matches(e){return lr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function lr(r){return r.op==="and"}function Oi(r){return r.op==="or"}function Pi(r){return Li(r)&&lr(r)}function Li(r){for(let e of r.filters)if(e instanceof Ze)return!1;return!0}function Yr(r,e){let t=r.filters.concat(e);return Ze.create(t,r.op)}class La extends Me{constructor(e,t,n){super(e,t,n),this.key=J.fromName(n.referenceValue)}matches(e){let t=J.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ma extends Me{constructor(e,t){super(e,"in",t),this.keys=xs("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ua extends Me{constructor(e,t){super(e,"not-in",t),this.keys=xs("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xs(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>J.fromName(n.referenceValue))}class Fa extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ar(t)&&ar(t.arrayValue,this.value)}}class Mi extends Me{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ar(this.value.arrayValue,t)}}class Va extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(ar(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ar(this.value.arrayValue,t)}}class Ds extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ar(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>ar(this.value.arrayValue,n))}}class Ui{constructor(e,t=null,n=[],i=[],s=null,l=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=l,this.endAt=u,this.ue=null}}function Fi(r,e=null,t=[],n=[],i=null,s=null,l=null){return new Ui(r,e,t,n,i,s,l)}function $n(r){if(r.ue===null){let e=r.path.canonicalString();r.collectionGroup!==null&&(e+="|cg:"+r.collectionGroup),e+="|f:"+r.filters.map(t=>function n(i){if(i instanceof Me)return i.field.canonicalString()+i.op.toString()+en(i.value);if(Pi(i))return i.filters.map(s=>n(s)).join(",");{let s=i.filters.map(l=>n(l)).join(",");return`${i.op}(${s})`}}(t)).join(",")+"|ob:"+r.orderBy.map(t=>t.field.canonicalString()+t.dir).join(","),r.limit==null||(e+="|l:"+r.limit),r.startAt&&(e+="|lb:"+(r.startAt.inclusive?"b:":"a:")+r.startAt.position.map(t=>en(t)).join(",")),r.endAt&&(e+="|ub:"+(r.endAt.inclusive?"a:":"b:")+r.endAt.position.map(t=>en(t)).join(",")),r.ue=e}return r.ue}function Qn(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<r.orderBy.length;i++){var t,n;if(t=r.orderBy[i],n=e.orderBy[i],!(t.dir===n.dir&&t.field.isEqual(n.field)))return!1}if(r.filters.length!==e.filters.length)return!1;for(let i=0;i<r.filters.length;i++)if(!function s(l,u){return l instanceof Me?u instanceof Me&&l.op===u.op&&l.field.isEqual(u.field)&&Cn(l.value,u.value):l instanceof Ze?u instanceof Ze&&l.op===u.op&&l.filters.length===u.filters.length&&l.filters.reduce((c,g,v)=>c&&s(g,u.filters[v]),!0):void K()}(r.filters[i],e.filters[i]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Ns(r.startAt,e.startAt)&&Ns(r.endAt,e.endAt)}function Zr(r){return J.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ei(r,e){return r.filters.filter(t=>t instanceof Me&&t.field.isEqual(e))}function ur(r,e,t){let n=sr,i=!0;for(let l of ei(r,e)){let u=sr,c=!0;switch(l.op){case"<":case"<=":var s;u="nullValue"in(s=l.value)?sr:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?Ln(yn.empty(),J.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:K();break;case"==":case"in":case">=":u=l.value;break;case">":u=l.value,c=!1;break;case"!=":case"not-in":u=sr}0>Cs({value:n,inclusive:i},{value:u,inclusive:c})&&(n=u,i=c)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){let u=t.position[l];0>Cs({value:n,inclusive:i},{value:u,inclusive:t.inclusive})&&(n=u,i=t.inclusive);break}}return{value:n,inclusive:i}}function ti(r,e,t){let n=vn,i=!0;for(let l of ei(r,e)){let u=vn,c=!0;switch(l.op){case">=":case">":var s;u="nullValue"in(s=l.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?Ln(yn.empty(),J.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?vn:K(),c=!1;break;case"==":case"in":case"<=":u=l.value;break;case"<":u=l.value,c=!1;break;case"!=":case"not-in":u=vn}ks({value:n,inclusive:i},{value:u,inclusive:c})>0&&(n=u,i=c)}if(t!==null){for(let l=0;l<r.orderBy.length;++l)if(r.orderBy[l].field.isEqual(e)){let u=t.position[l];ks({value:n,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(n=u,i=t.inclusive);break}}return{value:n,inclusive:i}}class ln{constructor(e,t=null,n=[],i=[],s=null,l="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=l,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function xr(r){return new ln(r)}function Vi(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Bi(r){return r.collectionGroup!==null}function hr(r){if(r.ce===null){let e;r.ce=[];let t=new Set;for(let i of r.explicitOrderBy)r.ce.push(i),t.add(i.field.canonicalString());let n=r.explicitOrderBy.length>0?r.explicitOrderBy[r.explicitOrderBy.length-1].dir:"asc";(e=new Ye(we.comparator),r.filters.forEach(i=>{i.getFlattenedFilters().forEach(s=>{s.isInequality()&&(e=e.add(s.field))})}),e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||r.ce.push(new or(i,n))}),t.has(we.keyField().canonicalString())||r.ce.push(new or(we.keyField(),n))}return r.ce}function Kt(r){return r.le||(r.le=function(e,t){if(e.limitType==="F")return Fi(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(s=>{let l=s.dir==="desc"?"asc":"desc";return new or(s.field,l)});let n=e.endAt?new zn(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new zn(e.startAt.position,e.startAt.inclusive):null;return Fi(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(r,hr(r))),r.le}function qi(r,e){let t=r.filters.concat([e]);return new ln(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function ni(r,e,t){return new ln(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function p(r,e){return Qn(Kt(r),Kt(e))&&r.limitType===e.limitType}function a(r){return`${$n(Kt(r))}|lt:${r.limitType}`}function h(r){var e;let t;return`Query(target=${t=(e=Kt(r)).path.canonicalString(),e.collectionGroup!==null&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(n=>function i(s){return s instanceof Me?`${s.field.canonicalString()} ${s.op} ${en(s.value)}`:s instanceof Ze?s.op.toString()+" {"+s.getFilters().map(i).join(" ,")+"}":"Filter"}(n)).join(", ")}]`),e.limit==null||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(n=>`${n.field.canonicalString()} (${n.dir})`).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(n=>en(n)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(n=>en(n)).join(",")),`Target(${t})`}; limitType=${r.limitType})`}function f(r,e){return e.isFoundDocument()&&function(t,n){let i=n.key.path;return t.collectionGroup!==null?n.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):J.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(r,e)&&function(t,n){for(let i of hr(t))if(!i.field.isKeyField()&&n.data.field(i.field)===null)return!1;return!0}(r,e)&&function(t,n){for(let i of t.filters)if(!i.matches(n))return!1;return!0}(r,e)&&(!r.startAt||!!function(t,n,i){let s=As(t,n,i);return t.inclusive?s<=0:s<0}(r.startAt,hr(r),e))&&(!r.endAt||!!function(t,n,i){let s=As(t,n,i);return t.inclusive?s>=0:s>0}(r.endAt,hr(r),e))}function y(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function b(r){return(e,t)=>{let n=!1;for(let i of hr(r)){let s=function(l,u,c){let g=l.field.isKeyField()?J.comparator(u.key,c.key):function(v,k,N){let O=k.data.field(v),Q=N.data.field(v);return O!==null&&Q!==null?Pn(O,Q):K()}(l.field,u,c);switch(l.dir){case"asc":return g;case"desc":return-1*g;default:return K()}}(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}class x{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){En(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return Wr(this.inner)}size(){return this.innerSize}}let G=new at(J.comparator),j=new at(J.comparator);function le(...r){let e=j;for(let t of r)e=e.insert(t.key,t);return e}function Te(r){let e=j;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ne(){return new x(r=>r.toString(),(r,e)=>r.isEqual(e))}let un=new at(J.comparator),Mn=new Ye(J.comparator);function ke(...r){let e=Mn;for(let t of r)e=e.add(t);return e}let hn=new Ye(ve);function Ut(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pt(e)?"-0":e}}function _t(r){return{integerValue:""+r}}function wn(r,e){return bn(e)?_t(e):Ut(r,e)}class In{constructor(){this._=void 0}}function cn(r,e){return r instanceof cr?xi(e)||e&&"doubleValue"in e?e:{integerValue:0}:null}class Ft extends In{}class Lt extends In{constructor(e){super(),this.elements=e}}function Un(r,e){let t=sl(e);for(let n of r.elements)t.some(i=>Cn(i,n))||t.push(n);return{arrayValue:{values:t}}}class An extends In{constructor(e){super(),this.elements=e}}function ri(r,e){let t=sl(e);for(let n of r.elements)t=t.filter(i=>!Cn(i,n));return{arrayValue:{values:t}}}class cr extends In{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function il(r){return $e(r.integerValue||r.doubleValue)}function sl(r){return Ar(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class ji{constructor(e,t){this.field=e,this.transform=t}}class pc{constructor(e,t){this.version=e,this.transformResults=t}}class tn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new tn}static exists(e){return new tn(void 0,e)}static updateTime(e){return new tn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rs(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Os{}function al(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ps(r.key,tn.none()):new ii(r.key,r.data,tn.none());{let t=r.data,n=Mt.empty(),i=new Ye(we.comparator);for(let s of e.fields)if(!i.has(s)){let l=t.field(s);l===null&&s.length>1&&(s=s.popLast(),l=t.field(s)),l===null?n.delete(s):n.set(s,l),i=i.add(s)}return new Jn(r.key,n,new jt(i.toArray()),tn.none())}}function zi(r,e,t,n){return r instanceof ii?function(i,s,l,u){if(!Rs(i.precondition,s))return l;let c=i.value.clone(),g=hl(i.fieldTransforms,u,s);return c.setAll(g),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),null}(r,e,t,n):r instanceof Jn?function(i,s,l,u){if(!Rs(i.precondition,s))return l;let c=hl(i.fieldTransforms,u,s),g=s.data;return g.setAll(ll(i)),g.setAll(c),s.convertToFoundDocument(s.version,g).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(v=>v.field))}(r,e,t,n):Rs(r.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}function ol(r,e){var t,n;return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(t=r.fieldTransforms,n=e.fieldTransforms,!!(t===void 0&&n===void 0||!(!t||!n)&&bt(t,n,(i,s)=>{var l,u;return i.field.isEqual(s.field)&&(l=i.transform,u=s.transform,l instanceof Lt&&u instanceof Lt||l instanceof An&&u instanceof An?bt(l.elements,u.elements,Cn):l instanceof cr&&u instanceof cr?Cn(l.Pe,u.Pe):l instanceof Ft&&u instanceof Ft)})))&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ii extends Os{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Jn extends Os{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ll(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function ul(r,e,t){var n;let i=new Map;r.length===t.length||K();for(let s=0;s<t.length;s++){let l=r[s],u=l.transform,c=e.data.field(l.field);i.set(l.field,(n=t[s],u instanceof Lt?Un(u,c):u instanceof An?ri(u,c):n))}return i}function hl(r,e,t){let n=new Map;for(let i of r){let s=i.transform,l=t.data.field(i.field);n.set(i.field,s instanceof Ft?function(u,c){let g={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return c&&Jr(c)&&(c=kr(c)),c&&(g.fields.__previous_value__=c),{mapValue:g}}(e,l):s instanceof Lt?Un(s,l):s instanceof An?ri(s,l):function(u,c){let g=cn(u,c),v=il(g)+il(u.Pe);return xi(g)&&xi(u.Pe)?_t(v):Ut(u.serializer,v)}(s,l))}return n}class Ps extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cl extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ba{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){let l=this.mutations[s];if(l.key.isEqual(e.key)){var i;i=n[s],l instanceof ii?function(u,c,g){let v=u.value.clone(),k=ul(u.fieldTransforms,c,g.transformResults);v.setAll(k),c.convertToFoundDocument(g.version,v).setHasCommittedMutations()}(l,e,i):l instanceof Jn?function(u,c,g){if(!Rs(u.precondition,c))return void c.convertToUnknownDocument(g.version);let v=ul(u.fieldTransforms,c,g.transformResults),k=c.data;k.setAll(ll(u)),k.setAll(v),c.convertToFoundDocument(g.version,k).setHasCommittedMutations()}(l,e,i):function(u,c,g){c.convertToNoDocument(g.version).setHasCommittedMutations()}(0,e,i)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=zi(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=zi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Ne();return this.mutations.forEach(i=>{let s=e.get(i.key),l=s.overlayedDocument,u=this.applyToLocalView(l,s.mutatedFields),c=al(l,u=t.has(i.key)?null:u);c!==null&&n.set(i.key,c),l.isValidDocument()||l.convertToNoDocument(R.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ke())}isEqual(e){return this.batchId===e.batchId&&bt(this.mutations,e.mutations,(t,n)=>ol(t,n))&&bt(this.baseMutations,e.baseMutations,(t,n)=>ol(t,n))}}class qa{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){e.mutations.length===n.length||K();let i=un,s=e.mutations;for(let l=0;l<s.length;l++)i=i.insert(s[l].key,n[l].version);return new qa(e,t,n,i)}}class ja{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class mc{constructor(e,t){this.count=e,this.unchangedNames=t}}function dl(r){if(r===void 0)return Ve("GRPC error has no .code"),M.UNKNOWN;switch(r){case Re.OK:return M.OK;case Re.CANCELLED:return M.CANCELLED;case Re.UNKNOWN:return M.UNKNOWN;case Re.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Re.INTERNAL:return M.INTERNAL;case Re.UNAVAILABLE:return M.UNAVAILABLE;case Re.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Re.NOT_FOUND:return M.NOT_FOUND;case Re.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Re.ABORTED:return M.ABORTED;case Re.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Re.DATA_LOSS:return M.DATA_LOSS;default:return K()}}(Ee=Re||(Re={}))[Ee.OK=0]="OK",Ee[Ee.CANCELLED=1]="CANCELLED",Ee[Ee.UNKNOWN=2]="UNKNOWN",Ee[Ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ee[Ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ee[Ee.NOT_FOUND=5]="NOT_FOUND",Ee[Ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ee[Ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ee[Ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ee[Ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ee[Ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ee[Ee.ABORTED=10]="ABORTED",Ee[Ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ee[Ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ee[Ee.INTERNAL=13]="INTERNAL",Ee[Ee.UNAVAILABLE=14]="UNAVAILABLE",Ee[Ee.DATA_LOSS=15]="DATA_LOSS";let gc=new re([4294967295,4294967295],0);function fl(r){let e=new TextEncoder().encode(r),t=new fe;return t.update(e),new Uint8Array(t.digest())}function pl(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new re([t,n],0),new re([i,s],0)]}class za{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ls(`Invalid padding: ${t}`);if(n<0||e.length>0&&this.hashCount===0)throw new Ls(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ls(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=re.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(re.fromNumber(n)));return i.compare(gc)===1&&(i=new re([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let[t,n]=pl(fl(e));for(let i=0;i<this.hashCount;i++){let s=this.Ee(t,n,i);if(!this.de(s))return!1}return!0}static create(e,t,n){let i=new za(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(s=>i.insert(s)),i}insert(e){if(this.Ie===0)return;let[t,n]=pl(fl(e));for(let i=0;i<this.hashCount;i++){let s=this.Ee(t,n,i);this.Ae(s)}}Ae(e){this.bitmap[Math.floor(e/8)]|=1<<e%8}}class Ls extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $i{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,Ki.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $i(R.min(),i,new at(ve),G,ke())}}class Ki{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ki(n,t,ke(),ke(),ke())}}class Ms{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class ml{constructor(e,t){this.targetId=e,this.me=t}}class gl{constructor(e,t,n=lt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class yl{constructor(){this.fe=0,this.ge=wl(),this.pe=lt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ke(),t=ke(),n=ke();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:K()}}),new Ki(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=wl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,this.fe>=0||K()}Ne(){this.we=!0,this.ye=!0}}class yc{constructor(e){this.Le=e,this.Be=new Map,this.ke=G,this.qe=vl(),this.Qe=new at(ve)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:K()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Zr(s))if(n===0){let l=new J(s.path);this.Ue(t,l,mt.newNoDocument(l,R.min()))}else n===1||K();else{let l=this.Ye(t);if(l!==n){let u=this.Ze(e),c=u?this.Xe(u,e,l):1;c!==0&&(this.je(t),this.Qe=this.Qe.insert(t,c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){let t,n,i=e.me.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:s="",padding:l=0},hashCount:u=0}=i;try{t=Sn(s).toUint8Array()}catch(c){if(c instanceof Qr)return Yt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{n=new za(t,l,u)}catch(c){return Yt(c instanceof Ls?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return n.Ie===0?null:n}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let l=this.Le.tt(),u=`projects/${l.projectId}/databases/${l.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,l)=>{let u=this.Je(l);if(u){if(s.current&&Zr(u.target)){let c=new J(u.target.path);this.ke.get(c)!==null||this.it(l,c)||this.Ue(l,c,mt.newNoDocument(c,e))}s.be&&(t.set(l,s.Ce()),s.ve())}});let n=ke();this.qe.forEach((s,l)=>{let u=!0;l.forEachWhile(c=>{let g=this.Je(c);return!g||g.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,l)=>l.setReadTime(e));let i=new $i(e,t,this.Qe,this.ke,n);return this.ke=G,this.qe=vl(),this.Qe=new at(ve),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new yl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ye(ve),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||H("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new yl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vl(){return new at(J.comparator)}function wl(){return new at(J.comparator)}let vc={asc:"ASCENDING",desc:"DESCENDING"},wc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ic={and:"AND",or:"OR"};class _c{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $a(r,e){return r.useProto3Json||e==null?e:{value:e}}function si(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Il(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function nn(r){return r||K(),R.fromTimestamp(function(e){let t=Rn(e);return new W(t.seconds,t.nanos)}(r))}function Ka(r,e){return Ga(r,e).canonicalString()}function Ga(r,e){let t=new te(["projects",r.projectId,"databases",r.database]).child("documents");return e===void 0?t:t.child(e)}function _l(r){let e=te.fromString(r);return Nl(e)||K(),e}function Us(r,e){return Ka(r.databaseId,e.path)}function Dr(r,e){let t=_l(e);if(t.get(1)!==r.databaseId.projectId)throw new ee(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new ee(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new J(Tl(t))}function bl(r,e){return Ka(r.databaseId,e)}function El(r){let e=_l(r);return e.length===4?te.emptyPath():Tl(e)}function Ha(r){return new te(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Tl(r){return r.length>4&&r.get(4)==="documents"||K(),r.popFirst(5)}function Sl(r,e,t){return{name:Us(r,e),fields:t.value.mapValue.fields}}function bc(r,e,t){let n=Dr(r,e.name),i=nn(e.updateTime),s=e.createTime?nn(e.createTime):R.min(),l=new Mt({mapValue:{fields:e.fields}}),u=mt.newFoundDocument(n,i,s,l);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Fs(r,e){var t;let n;if(e instanceof ii)n={update:Sl(r,e.key,e.value)};else if(e instanceof Ps)n={delete:Us(r,e.key)};else if(e instanceof Jn)n={update:Sl(r,e.key,e.data),updateMask:function(i){let s=[];return i.fields.forEach(l=>s.push(l.canonicalString())),{fieldPaths:s}}(e.fieldMask)};else{if(!(e instanceof cl))return K();n={verify:Us(r,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(i=>function(s,l){let u=l.transform;if(u instanceof Ft)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Lt)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof An)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof cr)return{fieldPath:l.field.canonicalString(),increment:u.Pe};throw K()}(0,i))),e.precondition.isNone||(n.currentDocument=(t=e.precondition).updateTime!==void 0?{updateTime:si(r,t.updateTime.toTimestamp())}:t.exists!==void 0?{exists:t.exists}:K()),n}function Wa(r,e){var t;let n=e.currentDocument?(t=e.currentDocument).updateTime!==void 0?tn.updateTime(nn(t.updateTime)):t.exists!==void 0?tn.exists(t.exists):tn.none():tn.none(),i=e.updateTransforms?e.updateTransforms.map(s=>{let l;return l=null,"setToServerValue"in s?(s.setToServerValue==="REQUEST_TIME"||K(),l=new Ft):"appendMissingElements"in s?l=new Lt(s.appendMissingElements.values||[]):"removeAllFromArray"in s?l=new An(s.removeAllFromArray.values||[]):"increment"in s?l=new cr(r,s.increment):K(),new ji(we.fromServerFormat(s.fieldPath),l)}):[];if(e.update){e.update.name;let s=Dr(r,e.update.name),l=new Mt({mapValue:{fields:e.update.fields}});return e.updateMask?new Jn(s,l,new jt((e.updateMask.fieldPaths||[]).map(u=>we.fromServerFormat(u))),n,i):new ii(s,l,n,i)}return e.delete?new Ps(Dr(r,e.delete),n):e.verify?new cl(Dr(r,e.verify),n):K()}function Cl(r,e){return{documents:[bl(r,e.path)]}}function kl(r,e){var t,n;let i,s={structuredQuery:{}},l=e.path;e.collectionGroup!==null?(i=l,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=l.popLast(),s.structuredQuery.from=[{collectionId:l.lastSegment()}]),s.parent=bl(r,i);let u=function(v){if(v.length!==0)return function k(N){return N instanceof Me?function(O){if(O.op==="=="){if(Di(O.value))return{unaryFilter:{field:ai(O.field),op:"IS_NAN"}};if(Ss(O.value))return{unaryFilter:{field:ai(O.field),op:"IS_NULL"}}}else if(O.op==="!="){if(Di(O.value))return{unaryFilter:{field:ai(O.field),op:"IS_NOT_NAN"}};if(Ss(O.value))return{unaryFilter:{field:ai(O.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ai(O.field),op:wc[O.op],value:O.value}}}(N):N instanceof Ze?function(O){let Q=O.getFilters().map(se=>k(se));return Q.length===1?Q[0]:{compositeFilter:{op:Ic[O.op],filters:Q}}}(N):K()}(Ze.create(v,"and"))}(e.filters);u&&(s.structuredQuery.where=u);let c=function(v){if(v.length!==0)return v.map(k=>({field:ai(k.field),direction:vc[k.dir]}))}(e.orderBy);c&&(s.structuredQuery.orderBy=c);let g=$a(r,e.limit);return g!==null&&(s.structuredQuery.limit=g),e.startAt&&(s.structuredQuery.startAt={before:(t=e.startAt).inclusive,values:t.position}),e.endAt&&(s.structuredQuery.endAt={before:!(n=e.endAt).inclusive,values:n.position}),{_t:s,parent:i}}function Al(r){var e;let t,n=El(r.parent),i=r.structuredQuery,s=i.from?i.from.length:0,l=null;if(s>0){s===1||K();let N=i.from[0];N.allDescendants?l=N.collectionId:n=n.child(N.collectionId)}let u=[];i.where&&(u=function(N){let O=function Q(se){return se.unaryFilter!==void 0?function(ae){switch(ae.unaryFilter.op){case"IS_NAN":let _e=oi(ae.unaryFilter.field);return Me.create(_e,"==",{doubleValue:NaN});case"IS_NULL":let ge=oi(ae.unaryFilter.field);return Me.create(ge,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let A=oi(ae.unaryFilter.field);return Me.create(A,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let I=oi(ae.unaryFilter.field);return Me.create(I,"!=",{nullValue:"NULL_VALUE"});default:return K()}}(se):se.fieldFilter!==void 0?Me.create(oi(se.fieldFilter.field),function(ae){switch(ae){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return K()}}(se.fieldFilter.op),se.fieldFilter.value):se.compositeFilter!==void 0?Ze.create(se.compositeFilter.filters.map(ae=>Q(ae)),function(ae){switch(ae){case"AND":return"and";case"OR":return"or";default:return K()}}(se.compositeFilter.op)):K()}(N);return O instanceof Ze&&Pi(O)?O.getFilters():[O]}(i.where));let c=[];i.orderBy&&(c=i.orderBy.map(N=>new or(oi(N.field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))));let g=null;i.limit&&(g=(t=typeof(e=i.limit)=="object"?e.value:e)==null?null:t);let v=null;i.startAt&&(v=function(N){let O=!!N.before;return new zn(N.values||[],O)}(i.startAt));let k=null;return i.endAt&&(k=function(N){let O=!N.before;return new zn(N.values||[],O)}(i.endAt)),new ln(n,l,c,u,g,"F",v,k)}function ai(r){return{fieldPath:r.canonicalString()}}function oi(r){return we.fromServerFormat(r.fieldPath)}function Nl(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}class Xn{constructor(e,t,n,i,s=R.min(),l=R.min(),u=lt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Xn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class xl{constructor(e){this.ct=e}}function Dl(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Vs(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument()){var i;n.document={name:Us(i=r.ct,e.key),fields:e.data.value.mapValue.fields,updateTime:si(i,e.version.toTimestamp()),createTime:si(i,e.createTime.toTimestamp())}}else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Rr(e.version)};else{if(!e.isUnknownDocument())return K();n.unknownDocument={path:t.path.toArray(),version:Rr(e.version)}}return n}function Vs(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Rr(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Or(r){let e=new W(r.seconds,r.nanoseconds);return R.fromTimestamp(e)}function Pr(r,e){let t=(e.baseMutations||[]).map(s=>Wa(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let l=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];l.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Wa(r.ct,s)),i=W.fromMillis(e.localWriteTimeMs);return new Ba(e.batchId,i,t,n)}function Gi(r){var e;let t=Or(r.readTime),n=r.lastLimboFreeSnapshotVersion!==void 0?Or(r.lastLimboFreeSnapshotVersion):R.min();return new Xn(r.query.documents!==void 0?((e=r.query).documents.length===1||K(),Kt(xr(El(e.documents[0])))):Kt(Al(r.query)),r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,n,lt.fromBase64String(r.resumeToken))}function Rl(r,e){let t,n=Rr(e.snapshotVersion),i=Rr(e.lastLimboFreeSnapshotVersion);t=Zr(e.target)?Cl(r.ct,e.target):kl(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:$n(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:t}}function Ol(r){let e=Al({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?ni(e,e.limit,"L"):e}function Qa(r,e){return new ja(e.largestBatchId,Wa(r.ct,e.overlayMutation))}function Pl(r,e){let t=e.path.lastSegment();return[r,nt(e.path.popLast()),t]}function Ll(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Rr(n.readTime),documentKey:nt(n.documentKey.path),largestBatchId:n.largestBatchId}}class Ec{getBundleMetadata(e,t){return Ml(e).get(t).next(n=>{if(n)return{id:n.bundleId,createTime:Or(n.createTime),version:n.version}})}saveBundleMetadata(e,t){return Ml(e).put({bundleId:t.id,createTime:Rr(nn(t.createTime)),version:t.version})}getNamedQuery(e,t){return Ul(e).get(t).next(n=>{if(n)return{name:n.name,query:Ol(n.bundledQuery),readTime:Or(n.readTime)}})}saveNamedQuery(e,t){return Ul(e).put({name:t.name,readTime:Rr(nn(t.readTime)),bundledQuery:t.bundledQuery})}}function Ml(r){return Et(r,"bundles")}function Ul(r){return Et(r,"namedQueries")}class Bs{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Bs(e,t.uid||"")}getOverlay(e,t){return Hi(e).get(Pl(this.userId,t)).next(n=>n?Qa(this.serializer,n):null)}getOverlays(e,t){let n=Ne();return T.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,l)=>{let u=new ja(t,l);i.push(this.ht(e,u))}),T.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(l=>i.add(nt(l.getCollectionPath())));let s=[];return i.forEach(l=>{let u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,n+1],!1,!0);s.push(Hi(e).j("collectionPathOverlayIndex",u))}),T.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Ne(),s=nt(t),l=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Hi(e).U("collectionPathOverlayIndex",l).next(u=>{for(let c of u){let g=Qa(this.serializer,c);i.set(g.getKey(),g)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s,l=Ne(),u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hi(e).J({index:"collectionGroupOverlayIndex",range:u},(c,g,v)=>{let k=Qa(this.serializer,g);l.size()<i||k.largestBatchId===s?(l.set(k.getKey(),k),s=k.largestBatchId):v.done()}).next(()=>l)}ht(e,t){return Hi(e).put(function(n,i,s){let[l,u,c]=Pl(i,s.mutation.key);return{userId:i,collectionPath:u,documentId:c,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:Fs(n.ct,s.mutation)}}(this.serializer,this.userId,t))}}function Hi(r){return Et(r,"documentOverlays")}class Tc{Pt(e){return Et(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?lt.fromUint8Array(n):lt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Lr{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At($e(e.integerValue));else if("doubleValue"in e){let n=$e(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Pt(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=Rn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Sn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Nr(e)?this.dt(t,Number.MAX_SAFE_INTEGER):(this.wt(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.St(e.arrayValue,t),this.ft(t)):K()}Vt(e,t){this.dt(t,25),this.bt(e,t)}bt(e,t){t.Rt(e)}wt(e,t){let n=e.fields||{};for(let i of(this.dt(t,55),Object.keys(n)))this.Vt(i,t),this.Tt(n[i],t)}St(e,t){let n=e.values||[];for(let i of(this.dt(t,50),n))this.Tt(i,t)}yt(e,t){this.dt(t,37),J.fromName(e).path.forEach(n=>{this.dt(t,60),this.bt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function Fl(r){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let i=function(s){if(s===0)return 8;let l=0;return s>>4==0&&(l+=4,s<<=4),s>>6==0&&(l+=2,s<<=2),s>>7==0&&(l+=1),l}(255&e[n]);if(t+=i,i!==8)break}return t}(r))/8)}Lr.Dt=new Lr;class Sc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.vt(n.value),n=t.next();this.Ft()}Mt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.xt(n.value),n=t.next();this.Ot()}Nt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.vt(n);else if(n<2048)this.vt(960|n>>>6),this.vt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.vt(480|n>>>12),this.vt(128|63&n>>>6),this.vt(128|63&n);else{let i=t.codePointAt(0);this.vt(240|i>>>18),this.vt(128|63&i>>>12),this.vt(128|63&i>>>6),this.vt(128|63&i)}}this.Ft()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.xt(n);else if(n<2048)this.xt(960|n>>>6),this.xt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.xt(480|n>>>12),this.xt(128|63&n>>>6),this.xt(128|63&n);else{let i=t.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}Bt(e){let t=this.kt(e),n=Fl(t);this.qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Qt(e){let t=this.kt(e),n=Fl(t);this.qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Kt(){this.$t(255),this.$t(255)}Ut(){this.Wt(255),this.Wt(255)}reset(){this.position=0}seed(e){this.qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Gt(){return this.buffer.slice(0,this.position)}kt(e){let t=function(i){let s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}vt(e){let t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(t)}xt(e){let t=255&e;t===0?(this.Wt(0),this.Wt(255)):t===255?(this.Wt(255),this.Wt(0)):this.Wt(e)}Ft(){this.$t(0),this.$t(1)}Ot(){this.Wt(0),this.Wt(1)}$t(e){this.qt(1),this.buffer[this.position++]=e}Wt(e){this.qt(1),this.buffer[this.position++]=~e}qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Cc{constructor(e){this.zt=e}gt(e){this.zt.Ct(e)}Rt(e){this.zt.Nt(e)}At(e){this.zt.Bt(e)}Et(){this.zt.Kt()}}class kc{constructor(e){this.zt=e}gt(e){this.zt.Mt(e)}Rt(e){this.zt.Lt(e)}At(e){this.zt.Qt(e)}Et(){this.zt.Ut()}}class Wi{constructor(){this.zt=new Sc,this.jt=new Cc(this.zt),this.Ht=new kc(this.zt)}seed(e){this.zt.seed(e)}Jt(e){return e===0?this.jt:this.Ht}Gt(){return this.zt.Gt()}reset(){this.zt.reset()}}class Mr{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Yt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Mr(this.indexId,this.documentKey,this.arrayValue,n)}}function dr(r,e){let t=r.indexId-e.indexId;return t!==0||(t=Vl(r.arrayValue,e.arrayValue))!==0||(t=Vl(r.directionalValue,e.directionalValue))!==0?t:J.comparator(r.documentKey,e.documentKey)}function Vl(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}class Bl{constructor(e){for(let t of(this.Zt=new Ye((n,i)=>we.comparator(n.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Xt=e.orderBy,this.en=[],e.filters))t.isInequality()?this.Zt=this.Zt.add(t):this.en.push(t)}get tn(){return this.Zt.size>1}nn(e){if(e.collectionGroup===this.collectionId||K(),this.tn)return!1;let t=Be(e);if(t!==void 0&&!this.rn(t))return!1;let n=P(e),i=new Set,s=0,l=0;for(;s<n.length&&this.rn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Zt.size>0){let u=this.Zt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.sn(u,c)||!this.on(this.Xt[l++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(l>=this.Xt.length||!this.on(this.Xt[l++],u))return!1}return!0}_n(){if(this.tn)return null;let e=new Ye(we.comparator),t=[];for(let n of this.en)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new S(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new S(n.field,0))}for(let n of this.Xt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new S(n.field,n.dir==="asc"?0:1)));return new je(je.UNKNOWN_ID,this.collectionId,t,$.empty())}rn(e){for(let t of this.en)if(this.sn(t,e))return!0;return!1}sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}on(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function Ja(r){return r instanceof Me}function Xa(r){return r instanceof Ze&&Pi(r)}function ql(r){return Ja(r)||Xa(r)||function(e){if(e instanceof Ze&&Oi(e)){for(let t of e.getFilters())if(!Ja(t)&&!Xa(t))return!1;return!0}return!1}(r)}function Ya(r,e){return r instanceof Me||r instanceof Ze||K(),e instanceof Me||e instanceof Ze||K(),qs(r instanceof Me?e instanceof Me?Ze.create([r,e],"and"):jl(r,e):e instanceof Me?jl(e,r):function(t,n){if(t.filters.length>0&&n.filters.length>0||K(),lr(t)&&lr(n))return Yr(t,n.getFilters());let i=Oi(t)?t:n,s=Oi(t)?n:t,l=i.filters.map(u=>Ya(u,s));return Ze.create(l,"or")}(r,e))}function jl(r,e){if(lr(e))return Yr(e,r.getFilters());{let t=e.filters.map(n=>Ya(r,n));return Ze.create(t,"or")}}function qs(r){if(r instanceof Me||r instanceof Ze||K(),r instanceof Me)return r;let e=r.getFilters();if(e.length===1)return qs(e[0]);if(Li(r))return r;let t=e.map(i=>qs(i)),n=[];return t.forEach(i=>{i instanceof Me?n.push(i):i instanceof Ze&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:Ze.create(n,r.op)}class Ac{constructor(){this.an=new Za}addToCollectionParentIndex(e,t){return this.an.add(t),T.resolve()}getCollectionParents(e,t){return T.resolve(this.an.getEntries(t))}addFieldIndex(e,t){return T.resolve()}deleteFieldIndex(e,t){return T.resolve()}deleteAllFieldIndexes(e){return T.resolve()}createTargetIndexes(e,t){return T.resolve()}getDocumentsMatchingTarget(e,t){return T.resolve(null)}getIndexType(e,t){return T.resolve(0)}getFieldIndexes(e,t){return T.resolve([])}getNextCollectionGroupToUpdate(e){return T.resolve(null)}getMinOffset(e,t){return T.resolve(de.min())}getMinOffsetFromCollectionGroup(e,t){return T.resolve(de.min())}updateCollectionGroup(e,t,n){return T.resolve()}updateIndexEntries(e,t){return T.resolve()}}class Za{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ye(te.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ye(te.comparator)).toArray()}}let js=new Uint8Array(0);class Nc{constructor(e,t){this.databaseId=t,this.un=new Za,this.cn=new x(n=>$n(n),(n,i)=>Qn(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.un.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.un.add(t)});let s={collectionId:n,parent:nt(i)};return zl(e).put(s)}return T.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return zl(e).U(i).next(s=>{for(let l of s){if(l.collectionId!==t)break;n.push(kt(l.parent))}return n})}addFieldIndex(e,t){let n=Qi(e),i={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])};delete i.indexId;let s=n.add(i);if(t.indexState){let l=ui(e);return s.next(u=>{l.put(Ll(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=Qi(e),i=ui(e),s=li(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Qi(e),n=li(e),i=ui(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return T.forEach(this.ln(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Bl(n)._n();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=li(e),i=!0,s=new Map;return T.forEach(this.ln(t),l=>this.hn(e,l).next(u=>{i&&(i=!!u),s.set(l,u)})).next(()=>{if(i){let l=ke(),u=[];return T.forEach(s,(c,g)=>{H("IndexedDbIndexManager",`Using index id=${c.indexId}|cg=${c.collectionGroup}|f=${c.fields.map(ge=>`${ge.fieldPath}:${ge.kind}`).join(",")} to execute ${$n(t)}`);let v=function(ge,A){let I=Be(A);if(I===void 0)return null;for(let _ of ei(ge,I.fieldPath))switch(_.op){case"array-contains-any":return _.value.arrayValue.values||[];case"array-contains":return[_.value]}return null}(g,c),k=function(ge,A){let I=new Map;for(let _ of P(A))for(let C of ei(ge,_.fieldPath))switch(C.op){case"==":case"in":I.set(_.fieldPath.canonicalString(),C.value);break;case"not-in":case"!=":return I.set(_.fieldPath.canonicalString(),C.value),Array.from(I.values())}return null}(g,c),N=function(ge,A){let I=[],_=!0;for(let C of P(A)){let D=C.kind===0?ur(ge,C.fieldPath,ge.startAt):ti(ge,C.fieldPath,ge.startAt);I.push(D.value),_&&(_=D.inclusive)}return new zn(I,_)}(g,c),O=function(ge,A){let I=[],_=!0;for(let C of P(A)){let D=C.kind===0?ti(ge,C.fieldPath,ge.endAt):ur(ge,C.fieldPath,ge.endAt);I.push(D.value),_&&(_=D.inclusive)}return new zn(I,_)}(g,c),Q=this.Pn(c,g,N),se=this.Pn(c,g,O),ae=this.In(c,g,k),_e=this.Tn(c.indexId,v,Q,N.inclusive,se,O.inclusive,ae);return T.forEach(_e,ge=>n.G(ge,t.limit).next(A=>{A.forEach(I=>{let _=J.fromSegments(I.documentKey);l.has(_)||(l=l.add(_),u.push(_))})}))}).next(()=>u)}return T.resolve(null)})}ln(e){let t=this.cn.get(e);return t||(t=e.filters.length===0?[e]:function(n){if(n.getFilters().length===0)return[];let i=function s(l){if(l instanceof Me||l instanceof Ze||K(),l instanceof Me)return l;if(l.filters.length===1)return s(l.filters[0]);let u=l.filters.map(g=>s(g)),c=Ze.create(u,l.op);return ql(c=qs(c))?c:(c instanceof Ze||K(),lr(c)||K(),c.filters.length>1||K(),c.filters.reduce((g,v)=>Ya(g,v)))}(function s(l){var u,c;if(l instanceof Me||l instanceof Ze||K(),l instanceof Me){if(l instanceof Mi){let v=((c=(u=l.value.arrayValue)===null||u===void 0?void 0:u.values)===null||c===void 0?void 0:c.map(k=>Me.create(l.field,"==",k)))||[];return Ze.create(v,"or")}return l}let g=l.filters.map(v=>s(v));return Ze.create(g,l.op)}(n));return ql(i)||K(),Ja(i)||Xa(i)?[i]:i.getFilters()}(Ze.create(e.filters,"and")).map(n=>Fi(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.cn.set(e,t)),t}Tn(e,t,n,i,s,l,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),g=c/(t!=null?t.length:1),v=[];for(let k=0;k<c;++k){let N=t?this.En(t[k/g]):js,O=this.dn(e,N,n[k%g],i),Q=this.An(e,N,s[k%g],l),se=u.map(ae=>this.dn(e,N,ae,!0));v.push(...this.createRange(O,Q,se))}return v}dn(e,t,n,i){let s=new Mr(e,J.empty(),t,n);return i?s:s.Yt()}An(e,t,n,i){let s=new Mr(e,J.empty(),t,n);return i?s.Yt():s}hn(e,t){let n=new Bl(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let l=null;for(let u of s)n.nn(u)&&(!l||u.fields.length>l.fields.length)&&(l=u);return l})}getIndexType(e,t){let n=2,i=this.ln(t);return T.forEach(i,s=>this.hn(e,s).next(l=>{l?n!==0&&l.fields.length<function(u){let c=new Ye(we.comparator),g=!1;for(let v of u.filters)for(let k of v.getFlattenedFilters())k.field.isKeyField()||(k.op==="array-contains"||k.op==="array-contains-any"?g=!0:c=c.add(k.field));for(let v of u.orderBy)v.field.isKeyField()||(c=c.add(v.field));return c.size+(g?1:0)}(s)&&(n=1):n=0})).next(()=>t.limit!==null&&i.length>1&&n===2?1:n)}Rn(e,t){let n=new Wi;for(let i of P(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let l=n.Jt(i.kind);Lr.Dt.It(s,l)}return n.Gt()}En(e){let t=new Wi;return Lr.Dt.It(e,t.Jt(0)),t.Gt()}Vn(e,t){let n=new Wi;return Lr.Dt.It(Ln(this.databaseId,t),n.Jt(function(i){let s=P(i);return s.length===0?0:s[s.length-1].kind}(e))),n.Gt()}In(e,t,n){if(n===null)return[];let i=[];i.push(new Wi);let s=0;for(let l of P(e)){let u=n[s++];for(let c of i)if(this.mn(t,l.fieldPath)&&Ar(u))i=this.fn(i,l,u);else{let g=c.Jt(l.kind);Lr.Dt.It(u,g)}}return this.gn(i)}Pn(e,t,n){return this.In(e,t,n.position)}gn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Gt();return t}fn(e,t,n){let i=[...e],s=[];for(let l of n.arrayValue.values||[])for(let u of i){let c=new Wi;c.seed(u.Gt()),Lr.Dt.It(l,c.Jt(t.kind)),s.push(c)}return s}mn(e,t){return!!e.filters.find(n=>n instanceof Me&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Qi(e),i=ui(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let l=[];return T.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{l.push(function(g,v){let k=v?new $(v.sequenceNumber,new de(Or(v.readTime),new J(kt(v.documentKey)),v.largestBatchId)):$.empty(),N=g.fields.map(([O,Q])=>new S(we.fromServerFormat(O),Q));return new je(g.indexId,g.collectionGroup,N,k)}(u,c))})).next(()=>l)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ve(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=Qi(e),s=ui(e);return this.pn(e).next(l=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>T.forEach(u,c=>s.put(Ll(c.indexId,this.uid,l,n)))))}updateIndexEntries(e,t){let n=new Map;return T.forEach(t,(i,s)=>{let l=n.get(i.collectionGroup);return(l?T.resolve(l):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),T.forEach(u,c=>this.yn(e,i,c).next(g=>{let v=this.wn(s,c);return g.isEqual(v)?T.resolve():this.Sn(e,s,c,g,v)}))))})}bn(e,t,n,i){return li(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Vn(n,t.key),documentKey:t.key.path.toArray()})}Dn(e,t,n,i){return li(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Vn(n,t.key),t.key.path.toArray()])}yn(e,t,n){let i=li(e),s=new Ye(dr);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Vn(n,t)])},(l,u)=>{s=s.add(new Mr(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}wn(e,t){let n=new Ye(dr),i=this.Rn(t,e);if(i==null)return n;let s=Be(t);if(s!=null){let l=e.data.field(s.fieldPath);if(Ar(l))for(let u of l.arrayValue.values||[])n=n.add(new Mr(t.indexId,e.key,this.En(u),i))}else n=n.add(new Mr(t.indexId,e.key,js,i));return n}Sn(e,t,n,i,s){H("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let l=[];return function(u,c,g,v,k){let N=u.getIterator(),O=c.getIterator(),Q=Wn(N),se=Wn(O);for(;Q||se;){let ae=!1,_e=!1;if(Q&&se){let ge=g(Q,se);ge<0?_e=!0:ge>0&&(ae=!0)}else Q!=null?_e=!0:ae=!0;ae?(v(se),se=Wn(O)):_e?(k(Q),Q=Wn(N)):(Q=Wn(N),se=Wn(O))}}(i,s,dr,u=>{l.push(this.bn(e,t,n,u))},u=>{l.push(this.Dn(e,t,n,u))}),T.waitFor(l)}pn(e){let t=1;return ui(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((l,u)=>dr(l,u)).filter((l,u,c)=>!u||dr(l,c[u-1])!==0);let i=[];for(let l of(i.push(e),n)){let u=dr(l,e),c=dr(l,t);if(u===0)i[0]=e.Yt();else if(u>0&&c<0)i.push(l),i.push(l.Yt());else if(c>0)break}i.push(t);let s=[];for(let l=0;l<i.length;l+=2){if(this.Cn(i[l],i[l+1]))return[];let u=[i[l].indexId,this.uid,i[l].arrayValue,i[l].directionalValue,js,[]],c=[i[l+1].indexId,this.uid,i[l+1].arrayValue,i[l+1].directionalValue,js,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(e,t){return dr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($l)}getMinOffset(e,t){return T.mapArray(this.ln(t),n=>this.hn(e,n).next(i=>i||K())).next($l)}}function zl(r){return Et(r,"collectionParents")}function li(r){return Et(r,"indexEntries")}function Qi(r){return Et(r,"indexConfiguration")}function ui(r){return Et(r,"indexState")}function $l(r){r.length!==0||K();let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;0>Ie(i,e)&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new de(e.readTime,e.documentKey,t)}let Kl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class dn{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new dn(e,dn.DEFAULT_COLLECTION_PERCENTILE,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Gl(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],l=IDBKeyRange.only(t.batchId),u=0,c=n.J({range:l},(N,O,Q)=>(u++,Q.delete()));s.push(c.next(()=>{u===1||K()}));let g=[];for(let N of t.mutations){var v,k;let O=(v=N.key.path,k=t.batchId,[e,nt(v),k]);s.push(i.delete(O)),g.push(N.key)}return T.waitFor(s).next(()=>g)}function zs(r){let e;if(!r)return 0;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw K();e=r.noDocument}return JSON.stringify(e).length}dn.DEFAULT_COLLECTION_PERCENTILE=10,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dn.DEFAULT=new dn(41943040,dn.DEFAULT_COLLECTION_PERCENTILE,dn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dn.DISABLED=new dn(-1,0,0);class $s{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.vn={}}static lt(e,t,n,i){return e.uid!==""||K(),new $s(e.isAuthenticated()?e.uid:"",t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fr(e).J({index:"userMutationsIndex",range:n},(i,s,l)=>{t=!1,l.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=hi(e),l=fr(e);return l.add({}).next(u=>{typeof u=="number"||K();let c=new Ba(u,t,n,i),g=function(N,O,Q){let se=Q.baseMutations.map(_e=>Fs(N.ct,_e)),ae=Q.mutations.map(_e=>Fs(N.ct,_e));return{userId:O,batchId:Q.batchId,localWriteTimeMs:Q.localWriteTime.toMillis(),baseMutations:se,mutations:ae}}(this.serializer,this.userId,c),v=[],k=new Ye((N,O)=>ve(N.canonicalString(),O.canonicalString()));for(let N of i){let O=[this.userId,nt(N.key.path),u];k=k.add(N.key.path.popLast()),v.push(l.put(g)),v.push(s.put(O,Hn))}return k.forEach(N=>{v.push(this.indexManager.addToCollectionParentIndex(e,N))}),e.addOnCommittedListener(()=>{this.vn[u]=c.keys()}),T.waitFor(v).next(()=>c)})}lookupMutationBatch(e,t){return fr(e).get(t).next(n=>n?(n.userId===this.userId||K(),Pr(this.serializer,n)):null)}Fn(e,t){return this.vn[t]?T.resolve(this.vn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.vn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return fr(e).J({index:"userMutationsIndex",range:i},(l,u,c)=>{u.userId===this.userId&&(u.batchId>=n||K(),s=Pr(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return fr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,l)=>{n=s.batchId,l.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fr(e).U("userMutationsIndex",t).next(n=>n.map(i=>Pr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,nt(t.path)],i=IDBKeyRange.lowerBound(n),s=[];return hi(e).J({range:i},(l,u,c)=>{let[g,v,k]=l,N=kt(v);if(g===this.userId&&t.path.isEqual(N))return fr(e).get(k).next(O=>{if(!O)throw K();O.userId===this.userId||K(),s.push(Pr(this.serializer,O))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ye(ve),i=[];return t.forEach(s=>{let l=[this.userId,nt(s.path)],u=IDBKeyRange.lowerBound(l),c=hi(e).J({range:u},(g,v,k)=>{let[N,O,Q]=g,se=kt(O);N===this.userId&&s.path.isEqual(se)?n=n.add(Q):k.done()});i.push(c)}),T.waitFor(i).next(()=>this.Mn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=[this.userId,nt(n)],l=IDBKeyRange.lowerBound(s),u=new Ye(ve);return hi(e).J({range:l},(c,g,v)=>{let[k,N,O]=c,Q=kt(N);k===this.userId&&n.isPrefixOf(Q)?Q.length===i&&(u=u.add(O)):v.done()}).next(()=>this.Mn(e,u))}Mn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(fr(e).get(s).next(l=>{if(l===null)throw K();l.userId===this.userId||K(),n.push(Pr(this.serializer,l))}))}),T.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Gl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.xn(t.batchId)}),T.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}xn(e){delete this.vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return T.resolve();let n=IDBKeyRange.lowerBound([this.userId]),i=[];return hi(e).J({range:n},(s,l,u)=>{if(s[0]===this.userId){let c=kt(s[1]);i.push(c)}else u.done()}).next(()=>{i.length===0||K()})})}containsKey(e,t){return Hl(e,this.userId,t)}On(e){return Wl(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Hl(r,e,t){let n=[e,nt(t.path)],i=n[1],s=IDBKeyRange.lowerBound(n),l=!1;return hi(r).J({range:s,H:!0},(u,c,g)=>{let[v,k,N]=u;v===e&&k===i&&(l=!0),g.done()}).next(()=>l)}function fr(r){return Et(r,"mutations")}function hi(r){return Et(r,"documentMutations")}function Wl(r){return Et(r,"mutationQueues")}class Ur{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static Ln(){return new Ur(0)}static Bn(){return new Ur(-1)}}class xc{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.kn(e).next(t=>{let n=new Ur(t.highestTargetId);return t.highestTargetId=n.next(),this.qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.kn(e).next(t=>R.fromTimestamp(new W(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.kn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.kn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.qn(e,i)))}addTargetData(e,t){return this.Qn(e,t).next(()=>this.kn(e).next(n=>(n.targetCount+=1,this.Kn(t,n),this.qn(e,n))))}updateTargetData(e,t){return this.Qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ci(e).delete(t.targetId)).next(()=>this.kn(e)).next(n=>(n.targetCount>0||K(),n.targetCount-=1,this.qn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return ci(e).J((l,u)=>{let c=Gi(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>T.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ci(e).J((n,i)=>{t(Gi(i))})}kn(e){return Ql(e).get("targetGlobalKey").next(t=>(t!==null||K(),t))}qn(e,t){return Ql(e).put("targetGlobalKey",t)}Qn(e,t){return ci(e).put(Rl(this.serializer,t))}Kn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.kn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=$n(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return ci(e).J({range:i,index:"queryTargetsIndex"},(l,u,c)=>{let g=Gi(u);Qn(t,g.target)&&(s=g,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=pr(e);return t.forEach(l=>{let u=nt(l.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,l))}),T.waitFor(i)}removeMatchingKeys(e,t,n){let i=pr(e);return T.forEach(t,s=>{let l=nt(s.path);return T.waitFor([i.delete([n,l]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=pr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=pr(e),s=ke();return i.J({range:n,H:!0},(l,u,c)=>{let g=new J(kt(l[1]));s=s.add(g)}).next(()=>s)}containsKey(e,t){let n=nt(t.path),i=IDBKeyRange.bound([n],[n+"\0"],!1,!0),s=0;return pr(e).J({index:"documentTargetsIndex",H:!0,range:i},([l,u],c,g)=>{l!==0&&(s++,g.done())}).next(()=>s>0)}ot(e,t){return ci(e).get(t).next(n=>n?Gi(n):null)}}function ci(r){return Et(r,"targets")}function Ql(r){return Et(r,"targetGlobal")}function pr(r){return Et(r,"targetDocuments")}function Jl([r,e],[t,n]){let i=ve(r,t);return i===0?ve(e,n):i}class Dc{constructor(e){this.$n=e,this.buffer=new Ye(Jl),this.Un=0}Wn(){return++this.Un}Gn(e){let t=[e,this.Wn()];if(this.buffer.size<this.$n)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();0>Jl(t,n)&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Rc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.zn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.jn(6e4)}stop(){this.zn&&(this.zn.cancel(),this.zn=null)}get started(){return this.zn!==null}jn(e){H("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.zn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.zn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xe(t)?H("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await be(t)}await this.jn(3e5)})}}class Xl{constructor(e,t){this.Hn=e,this.params=t}calculateTargetCount(e,t){return this.Hn.Jn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return T.resolve(ct.oe);let n=new Dc(t);return this.Hn.forEachTarget(e,i=>n.Gn(i.sequenceNumber)).next(()=>this.Hn.Yn(e,i=>n.Gn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Hn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Hn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(H("LruGarbageCollector","Garbage collection skipped; disabled"),T.resolve(Kl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Kl):this.Zn(e,t))}getCacheSize(e){return this.Hn.getCacheSize(e)}Zn(e,t){let n,i,s,l,u,c,g,v=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(k=>(k>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${k}`),i=this.params.maximumSequenceNumbersToCollect):i=k,l=Date.now(),this.nthSequenceNumber(e,i))).next(k=>(n=k,u=Date.now(),this.removeTargets(e,n,t))).next(k=>(s=k,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(k=>(g=Date.now(),$t()<=pt.in.DEBUG&&H("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-v}ms
	Determined least recently used ${i} in `+(u-l)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${k} documents in `+(g-c)+`ms
Total Duration: ${g-v}ms`),T.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:k})))}}class Oc{constructor(e,t){this.db=e,this.garbageCollector=new Xl(this,t)}Jn(e){let t=this.Xn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Xn(e){let t=0;return this.Yn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Yn(e,t){return this.er(e,(n,i)=>t(i))}addReference(e,t,n){return Ks(e,n)}removeReference(e,t,n){return Ks(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ks(e,t)}tr(e,t){let n;return n=!1,Wl(e).Y(i=>Hl(e,i,t).next(s=>(s&&(n=!0),T.resolve(!s)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.er(e,(l,u)=>{if(u<=t){let c=this.tr(e,l).next(g=>{if(!g)return s++,n.getEntry(e,l).next(()=>(n.removeEntry(l,R.min()),pr(e).delete([0,nt(l.path)])))});i.push(c)}}).next(()=>T.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ks(e,t)}er(e,t){let n=pr(e),i,s=ct.oe;return n.J({index:"documentTargetsIndex"},([l,u],{path:c,sequenceNumber:g})=>{l===0?(s!==ct.oe&&t(new J(kt(i)),s),s=g,i=c):s=ct.oe}).next(()=>{s!==ct.oe&&t(new J(kt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ks(r,e){var t;return pr(r).put((t=r.currentSequenceNumber,{targetId:0,path:nt(e.path),sequenceNumber:t}))}class Yl{constructor(){this.changes=new x(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?T.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zl{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Fr(e).put(n)}removeEntry(e,t,n){return Fr(e).delete(function(i,s){let l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Vs(s),l[l.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.nr(e,n)))}getEntry(e,t){let n=mt.newInvalidDocument(t);return Fr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ji(t))},(i,s)=>{n=this.rr(t,s)}).next(()=>n)}ir(e,t){let n={size:0,document:mt.newInvalidDocument(t)};return Fr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ji(t))},(i,s)=>{n={document:this.rr(t,s),size:zs(s)}}).next(()=>n)}getEntries(e,t){let n=G;return this.sr(e,t,(i,s)=>{let l=this.rr(i,s);n=n.insert(i,l)}).next(()=>n)}_r(e,t){let n=G,i=new at(J.comparator);return this.sr(e,t,(s,l)=>{let u=this.rr(s,l);n=n.insert(s,u),i=i.insert(s,zs(l))}).next(()=>({documents:n,ar:i}))}sr(e,t,n){if(t.isEmpty())return T.resolve();let i=new Ye(nu);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Ji(i.first()),Ji(i.last())),l=i.getIterator(),u=l.getNext();return Fr(e).J({index:"documentKeyIndex",range:s},(c,g,v)=>{let k=J.fromSegments([...g.prefixPath,g.collectionGroup,g.documentId]);for(;u&&0>nu(u,k);)n(u,null),u=l.getNext();u&&u.isEqual(k)&&(n(u,g),u=l.hasNext()?l.getNext():null),u?v.$(Ji(u)):v.done()}).next(()=>{for(;u;)n(u,null),u=l.hasNext()?l.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let l=t.path,u=[l.popLast().toArray(),l.lastSegment(),Vs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[l.popLast().toArray(),l.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fr(e).U(IDBKeyRange.bound(u,c,!0)).next(g=>{s?.incrementDocumentReadCount(g.length);let v=G;for(let k of g){let N=this.rr(J.fromSegments(k.prefixPath.concat(k.collectionGroup,k.documentId)),k);N.isFoundDocument()&&(f(t,N)||i.has(N.key))&&(v=v.insert(N.key,N))}return v})}getAllFromCollectionGroup(e,t,n,i){let s=G,l=tu(t,n),u=tu(t,de.max());return Fr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(l,u,!0)},(c,g,v)=>{let k=this.rr(J.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);(s=s.insert(k.key,k)).size===i&&v.done()}).next(()=>s)}newChangeBuffer(e){return new Pc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return eu(e).get("remoteDocumentGlobalKey").next(t=>(t||K(),t))}nr(e,t){return eu(e).put("remoteDocumentGlobalKey",t)}rr(e,t){if(t){let n=function(i,s){let l;if(s.document)l=bc(i.ct,s.document,!!s.hasCommittedMutations);else if(s.noDocument){let u=J.fromSegments(s.noDocument.path),c=Or(s.noDocument.readTime);l=mt.newNoDocument(u,c),s.hasCommittedMutations&&l.setHasCommittedMutations()}else{if(!s.unknownDocument)return K();{let u=J.fromSegments(s.unknownDocument.path),c=Or(s.unknownDocument.version);l=mt.newUnknownDocument(u,c)}}return s.readTime&&l.setReadTime(function(u){let c=new W(u[0],u[1]);return R.fromTimestamp(c)}(s.readTime)),l}(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(R.min())))return n}return mt.newInvalidDocument(e)}}class Pc extends Yl{constructor(e,t){super(),this.ur=e,this.trackRemovals=t,this.cr=new x(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new Ye((s,l)=>ve(s.canonicalString(),l.canonicalString()));return this.changes.forEach((s,l)=>{let u=this.cr.get(s);if(t.push(this.ur.removeEntry(e,s,u.readTime)),l.isValidDocument()){let c=Dl(this.ur.serializer,l);i=i.add(s.path.popLast());let g=zs(c);n+=g-u.size,t.push(this.ur.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=Dl(this.ur.serializer,l.convertToNoDocument(R.min()));t.push(this.ur.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ur.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ur.updateMetadata(e,n)),T.waitFor(t)}getFromCache(e,t){return this.ur.ir(e,t).next(n=>(this.cr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ur._r(e,t).next(({documents:n,ar:i})=>(i.forEach((s,l)=>{this.cr.set(s,{size:l,readTime:n.get(s).readTime})}),n))}}function eu(r){return Et(r,"remoteDocumentGlobal")}function Fr(r){return Et(r,"remoteDocumentsV14")}function Ji(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function tu(r,e){let t=e.documentKey.path.toArray();return[r,Vs(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function nu(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=ve(t[s],n[s]))return i;return(i=ve(t.length,n.length))||(i=ve(t[t.length-2],n[n.length-2]))||ve(t[t.length-1],n[n.length-1])}class Lc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ru{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&zi(n.mutation,i,jt.empty(),W.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ke()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ke()){let i=Ne();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let l=le();return s.forEach((u,c)=>{l=l.insert(u,c.overlayedDocument)}),l}))}getOverlayedDocuments(e,t){let n=Ne();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ke()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((l,u)=>{t.set(l,u)})})}computeViews(e,t,n,i){let s=G,l=Ne(),u=Ne();return t.forEach((c,g)=>{let v=n.get(g.key);i.has(g.key)&&(v===void 0||v.mutation instanceof Jn)?s=s.insert(g.key,g):v!==void 0?(l.set(g.key,v.mutation.getFieldMask()),zi(v.mutation,g,v.mutation.getFieldMask(),W.now())):l.set(g.key,jt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((g,v)=>l.set(g,v)),t.forEach((g,v)=>{var k;return u.set(g,new Lc(v,(k=l.get(g))!==null&&k!==void 0?k:null))}),u))}recalculateAndSaveOverlays(e,t){let n=Ne(),i=new at((l,u)=>l-u),s=ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(l=>{for(let u of l)u.keys().forEach(c=>{let g=t.get(c);if(g===null)return;let v=n.get(c)||jt.empty();v=u.applyToLocalView(g,v),n.set(c,v);let k=(i.get(u.batchId)||ke()).add(c);i=i.insert(u.batchId,k)})}).next(()=>{let l=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),g=c.key,v=c.value,k=Ne();v.forEach(N=>{if(!s.has(N)){let O=al(t.get(N),n.get(N));O!==null&&k.set(N,O),s=s.add(N)}}),l.push(this.documentOverlayCache.saveOverlays(e,g,k))}return T.waitFor(l)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return J.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0?this.getDocumentsMatchingDocumentQuery(e,t.path):Bi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let l=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):T.resolve(Ne()),u=-1,c=s;return l.next(g=>T.forEach(g,(v,k)=>(u<k.largestBatchId&&(u=k.largestBatchId),s.get(v)?T.resolve():this.remoteDocumentCache.getEntry(e,v).next(N=>{c=c.insert(v,N)}))).next(()=>this.populateOverlays(e,g,s)).next(()=>this.computeViews(e,c,g,ke())).next(v=>({batchId:u,changes:Te(v)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new J(t)).next(n=>{let i=le();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,l=le();return this.indexManager.getCollectionParents(e,s).next(u=>T.forEach(u,c=>{let g=new ln(c.child(s),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,g,n,i).next(v=>{v.forEach((k,N)=>{l=l.insert(k,N)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(l=>(s=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(l=>{s.forEach((c,g)=>{let v=g.getKey();l.get(v)===null&&(l=l.insert(v,mt.newInvalidDocument(v)))});let u=le();return l.forEach((c,g)=>{let v=s.get(c);v!==void 0&&zi(v.mutation,g,jt.empty(),W.now()),f(t,g)&&(u=u.insert(c,g))}),u})}}class Mc{constructor(e){this.serializer=e,this.lr=new Map,this.hr=new Map}getBundleMetadata(e,t){return T.resolve(this.lr.get(t))}saveBundleMetadata(e,t){return this.lr.set(t.id,{id:t.id,version:t.version,createTime:nn(t.createTime)}),T.resolve()}getNamedQuery(e,t){return T.resolve(this.hr.get(t))}saveNamedQuery(e,t){return this.hr.set(t.name,{name:t.name,query:Ol(t.bundledQuery),readTime:nn(t.readTime)}),T.resolve()}}class Uc{constructor(){this.overlays=new at(J.comparator),this.Pr=new Map}getOverlay(e,t){return T.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Ne();return T.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),T.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Pr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Pr.delete(n)),T.resolve()}getOverlaysForCollection(e,t,n){let i=Ne(),s=t.length+1,l=new J(t.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){let c=u.getNext().value,g=c.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return T.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new at((g,v)=>g-v),l=this.overlays.getIterator();for(;l.hasNext();){let g=l.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>n){let v=s.get(g.largestBatchId);v===null&&(v=Ne(),s=s.insert(g.largestBatchId,v)),v.set(g.getKey(),g)}}let u=Ne(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((g,v)=>u.set(g,v)),!(u.size()>=i)););return T.resolve(u)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let l=this.Pr.get(i.largestBatchId).delete(n.key);this.Pr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new ja(t,n));let s=this.Pr.get(t);s===void 0&&(s=ke(),this.Pr.set(t,s)),this.Pr.set(t,s.add(n.key))}}class Fc{constructor(){this.sessionToken=lt.EMPTY_BYTE_STRING}getSessionToken(e){return T.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,T.resolve()}}class eo{constructor(){this.Ir=new Ye(Vt.Tr),this.Er=new Ye(Vt.dr)}isEmpty(){return this.Ir.isEmpty()}addReference(e,t){let n=new Vt(e,t);this.Ir=this.Ir.add(n),this.Er=this.Er.add(n)}Ar(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Rr(new Vt(e,t))}Vr(e,t){e.forEach(n=>this.removeReference(n,t))}mr(e){let t=new J(new te([])),n=new Vt(t,e),i=new Vt(t,e+1),s=[];return this.Er.forEachInRange([n,i],l=>{this.Rr(l),s.push(l.key)}),s}gr(){this.Ir.forEach(e=>this.Rr(e))}Rr(e){this.Ir=this.Ir.delete(e),this.Er=this.Er.delete(e)}pr(e){let t=new J(new te([])),n=new Vt(t,e),i=new Vt(t,e+1),s=ke();return this.Er.forEachInRange([n,i],l=>{s=s.add(l.key)}),s}containsKey(e){let t=new Vt(e,0),n=this.Ir.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Vt{constructor(e,t){this.key=e,this.yr=t}static Tr(e,t){return J.comparator(e.key,t.key)||ve(e.yr,t.yr)}static dr(e,t){return ve(e.yr,t.yr)||J.comparator(e.key,t.key)}}class Vc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.wr=1,this.Sr=new Ye(Vt.Tr)}checkEmpty(e){return T.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.wr;this.wr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let l=new Ba(s,t,n,i);for(let u of(this.mutationQueue.push(l),i))this.Sr=this.Sr.add(new Vt(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return T.resolve(l)}lookupMutationBatch(e,t){return T.resolve(this.br(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Dr(t+1),i=n<0?0:n;return T.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return T.resolve(this.mutationQueue.length===0?-1:this.wr-1)}getAllMutationBatches(e){return T.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Vt(t,0),i=new Vt(t,Number.POSITIVE_INFINITY),s=[];return this.Sr.forEachInRange([n,i],l=>{let u=this.br(l.yr);s.push(u)}),T.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ye(ve);return t.forEach(i=>{let s=new Vt(i,0),l=new Vt(i,Number.POSITIVE_INFINITY);this.Sr.forEachInRange([s,l],u=>{n=n.add(u.yr)})}),T.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;J.isDocumentKey(s)||(s=s.child(""));let l=new Vt(new J(s),0),u=new Ye(ve);return this.Sr.forEachWhile(c=>{let g=c.key.path;return!!n.isPrefixOf(g)&&(g.length===i&&(u=u.add(c.yr)),!0)},l),T.resolve(this.Cr(u))}Cr(e){let t=[];return e.forEach(n=>{let i=this.br(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){this.vr(t.batchId,"removed")===0||K(),this.mutationQueue.shift();let n=this.Sr;return T.forEach(t.mutations,i=>{let s=new Vt(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Sr=n})}xn(e){}containsKey(e,t){let n=new Vt(t,0),i=this.Sr.firstAfterOrEqual(n);return T.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,T.resolve()}vr(e,t){return this.Dr(e)}Dr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}br(e){let t=this.Dr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Bc{constructor(e){this.Fr=e,this.docs=new at(J.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,l=this.Fr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:l}),this.size+=l-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return T.resolve(n?n.document.mutableCopy():mt.newInvalidDocument(t))}getEntries(e,t){let n=G;return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():mt.newInvalidDocument(i))}),T.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=G,l=t.path,u=new J(l.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:g,value:{document:v}}=c.getNext();if(!l.isPrefixOf(g.path))break;g.path.length>l.length+1||0>=Ie(X(v),n)||(i.has(v.key)||f(t,v))&&(s=s.insert(v.key,v.mutableCopy()))}return T.resolve(s)}getAllFromCollectionGroup(e,t,n,i){K()}Mr(e,t){return T.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new qc(this)}getSize(e){return T.resolve(this.size)}}class qc extends Yl{constructor(e){super(),this.ur=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ur.addEntry(e,i)):this.ur.removeEntry(n)}),T.waitFor(t)}getFromCache(e,t){return this.ur.getEntry(e,t)}getAllFromCache(e,t){return this.ur.getEntries(e,t)}}class jc{constructor(e){this.persistence=e,this.Or=new x(t=>$n(t),Qn),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.Nr=0,this.Lr=new eo,this.targetCount=0,this.Br=Ur.Ln()}forEachTarget(e,t){return this.Or.forEach((n,i)=>t(i)),T.resolve()}getLastRemoteSnapshotVersion(e){return T.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return T.resolve(this.Nr)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),T.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Nr&&(this.Nr=t),T.resolve()}Qn(e){this.Or.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Br=new Ur(t),this.highestTargetId=t),e.sequenceNumber>this.Nr&&(this.Nr=e.sequenceNumber)}addTargetData(e,t){return this.Qn(t),this.targetCount+=1,T.resolve()}updateTargetData(e,t){return this.Qn(t),T.resolve()}removeTargetData(e,t){return this.Or.delete(t.target),this.Lr.mr(t.targetId),this.targetCount-=1,T.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Or.forEach((l,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Or.delete(l),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),T.waitFor(s).next(()=>i)}getTargetCount(e){return T.resolve(this.targetCount)}getTargetData(e,t){let n=this.Or.get(t)||null;return T.resolve(n)}addMatchingKeys(e,t,n){return this.Lr.Ar(t,n),T.resolve()}removeMatchingKeys(e,t,n){this.Lr.Vr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(l=>{s.push(i.markPotentiallyOrphaned(e,l))}),T.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Lr.mr(t),T.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Lr.pr(t);return T.resolve(n)}containsKey(e,t){return T.resolve(this.Lr.containsKey(t))}}class iu{constructor(e,t){this.kr={},this.overlays={},this.qr=new ct(0),this.Qr=!1,this.Qr=!0,this.Kr=new Fc,this.referenceDelegate=e(this),this.$r=new jc(this),this.indexManager=new Ac,this.remoteDocumentCache=new Bc(n=>this.referenceDelegate.Ur(n)),this.serializer=new xl(t),this.Wr=new Mc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Qr=!1,Promise.resolve()}get started(){return this.Qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Uc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.kr[e.toKey()];return n||(n=new Vc(t,this.referenceDelegate),this.kr[e.toKey()]=n),n}getGlobalsCache(){return this.Kr}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Wr}runTransaction(e,t,n){H("MemoryPersistence","Starting transaction:",e);let i=new zc(this.qr.next());return this.referenceDelegate.Gr(),n(i).next(s=>this.referenceDelegate.zr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}jr(e,t){return T.or(Object.values(this.kr).map(n=>()=>n.containsKey(e,t)))}}class zc extends Ae{constructor(e){super(),this.currentSequenceNumber=e}}class Gs{constructor(e){this.persistence=e,this.Hr=new eo,this.Jr=null}static Yr(e){return new Gs(e)}get Zr(){if(this.Jr)return this.Jr;throw K()}addReference(e,t,n){return this.Hr.addReference(n,t),this.Zr.delete(n.toString()),T.resolve()}removeReference(e,t,n){return this.Hr.removeReference(n,t),this.Zr.add(n.toString()),T.resolve()}markPotentiallyOrphaned(e,t){return this.Zr.add(t.toString()),T.resolve()}removeTarget(e,t){this.Hr.mr(t.targetId).forEach(i=>this.Zr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Zr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Gr(){this.Jr=new Set}zr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return T.forEach(this.Zr,n=>{let i=J.fromPath(n);return this.Xr(e,i).next(s=>{s||t.removeEntry(i,R.min())})}).next(()=>(this.Jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Xr(e,t).next(n=>{n?this.Zr.delete(t.toString()):this.Zr.add(t.toString())})}Ur(e){return 0}Xr(e,t){return T.or([()=>T.resolve(this.Hr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.jr(e,t)])}}class su{constructor(e,t){this.persistence=e,this.ei=new x(n=>nt(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=new Xl(this,t)}static Yr(e,t){return new su(e,t)}Gr(){}zr(e){return T.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Jn(e){let t=this.Xn(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Xn(e){let t=0;return this.Yn(e,n=>{t++}).next(()=>t)}Yn(e,t){return T.forEach(this.ei,(n,i)=>this.tr(e,n,i).next(s=>s?T.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Mr(e,l=>this.tr(e,l,t).next(u=>{u||(n++,s.removeEntry(l,R.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.ei.set(t,e.currentSequenceNumber),T.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.ei.set(n,e.currentSequenceNumber),T.resolve()}removeReference(e,t,n){return this.ei.set(n,e.currentSequenceNumber),T.resolve()}updateLimboDocument(e,t){return this.ei.set(t,e.currentSequenceNumber),T.resolve()}Ur(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function n(i){switch(On(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let l=kr(i);return l?16+n(l):16;case 5:return 2*i.stringValue.length;case 6:return Sn(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(i.arrayValue.values||[]).reduce((c,g)=>c+n(g),0);case 10:var s;let u;return s=i.mapValue,u=0,En(s.fields,(c,g)=>{u+=c.length+n(g)}),u;default:throw K()}}(e.data.value)),t}tr(e,t,n){return T.or([()=>this.persistence.jr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.ei.get(t);return T.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class $c{constructor(e){this.serializer=e}O(e,t,n,i){let s=new st("createOrUpgrade",t);n<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gn,{unique:!0}),e.createObjectStore("documentMutations"),au(e),function(u){u.createObjectStore("remoteDocuments")}(e));let l=T.resolve();return n<3&&i>=3&&(n!==0&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),au(e)),l=l.next(()=>function(u){let c=u.store("targetGlobal"),g={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:R.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",g)}(s))),n<4&&i>=4&&(n!==0&&(l=l.next(()=>s.store("mutations").U().next(u=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gn,{unique:!0});let c=s.store("mutations"),g=u.map(v=>c.put(v));return T.waitFor(g)}))),l=l.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(l=l.next(()=>this.ti(s))),n<6&&i>=6&&(l=l.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ni(s)))),n<7&&i>=7&&(l=l.next(()=>this.ri(s))),n<8&&i>=8&&(l=l.next(()=>this.ii(e,s))),n<9&&i>=9&&(l=l.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&i>=10&&(l=l.next(()=>this.si(s))),n<11&&i>=11&&(l=l.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(l=l.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:xn});c.createIndex("collectionPathOverlayIndex",Bn,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",qn,{unique:!1})})(e)})),n<13&&i>=13&&(l=l.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:Na});c.createIndex("documentKeyIndex",xa),c.createIndex("collectionGroupIndex",Da)}(e)).next(()=>this.oi(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(l=l.next(()=>this._i(e,s))),n<15&&i>=15&&(l=l.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Er}).createIndex("sequenceNumberIndex",_s,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Tr}).createIndex("documentKeyIndex",Vn,{unique:!1})})),n<16&&i>=16&&(l=l.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(l=l.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),l}ni(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=zs(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ti(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>T.forEach(i,s=>{let l=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",l).next(u=>T.forEach(u,c=>{c.userId===s.userId||K();let g=Pr(this.serializer,c);return Gl(e,s.userId,g).next(()=>{})}))}))}ri(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((l,u)=>{let c=new te(l),g=[0,nt(c)];s.push(t.get(g).next(v=>v?T.resolve():t.put({targetId:0,path:nt(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>T.waitFor(s))})}ii(e,t){e.createObjectStore("collectionParents",{keyPath:ki});let n=t.store("collectionParents"),i=new Za,s=l=>{if(i.add(l)){let u=l.lastSegment(),c=l.popLast();return n.put({collectionId:u,parent:nt(c)})}};return t.store("remoteDocuments").J({H:!0},(l,u)=>s(new te(l).popLast())).next(()=>t.store("documentMutations").J({H:!0},([l,u,c],g)=>s(kt(u).popLast())))}si(e){let t=e.store("targets");return t.J((n,i)=>{let s=Gi(i),l=Rl(this.serializer,s);return t.put(l)})}oi(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,l)=>{let u=t.store("remoteDocumentsV14"),c=(l.document?new J(te.fromString(l.document.name).popFirst(5)):l.noDocument?J.fromSegments(l.noDocument.path):l.unknownDocument?J.fromSegments(l.unknownDocument.path):K()).path.toArray(),g={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:l.readTime||[0,0],unknownDocument:l.unknownDocument,noDocument:l.noDocument,document:l.document,hasCommittedMutations:!!l.hasCommittedMutations};i.push(u.put(g))}).next(()=>T.waitFor(i))}_i(e,t){let n=t.store("mutations"),i=new Zl(this.serializer),s=new iu(Gs.Yr,this.serializer.ct);return n.U().next(l=>{let u=new Map;return l.forEach(c=>{var g;let v=(g=u.get(c.userId))!==null&&g!==void 0?g:ke();Pr(this.serializer,c).keys().forEach(k=>v=v.add(k)),u.set(c.userId,v)}),T.forEach(u,(c,g)=>{let v=new xe(g),k=Bs.lt(this.serializer,v),N=s.getIndexManager(v);return new ru(i,$s.lt(v,this.serializer,N,s.referenceDelegate),k,N).recalculateAndSaveOverlaysForDocumentKeys(new Ai(t,ct.oe),c).next()})})}}function au(r){r.createObjectStore("targetDocuments",{keyPath:Oa}).createIndex("documentTargetsIndex",rr,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ra,{unique:!0}),r.createObjectStore("targetGlobal")}let to="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class no{constructor(e,t,n,i,s,l,u,c,g,v,k=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ai=s,this.window=l,this.document=u,this.ui=g,this.ci=v,this.li=k,this.qr=null,this.Qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.hi=null,this.inForeground=!1,this.Pi=null,this.Ii=null,this.Ti=Number.NEGATIVE_INFINITY,this.Ei=N=>Promise.resolve(),!no.D())throw new ee(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Oc(this,i),this.di=t+"main",this.serializer=new xl(c),this.Ai=new Le(this.di,this.li,new $c(this.serializer)),this.Kr=new Tc,this.$r=new xc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new Zl(this.serializer),this.Wr=new Ec,this.window&&this.window.localStorage?this.Ri=this.window.localStorage:(this.Ri=null,v===!1&&Ve("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Vi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ee(M.FAILED_PRECONDITION,to);return this.mi(),this.fi(),this.gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.$r.getHighestSequenceNumber(e))}).then(e=>{this.qr=new ct(e,this.ui)}).then(()=>{this.Qr=!0}).catch(e=>(this.Ai&&this.Ai.close(),Promise.reject(e)))}pi(e){return this.Ei=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ai.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ai.enqueueAndForget(async()=>{this.started&&await this.Vi()}))}Vi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Hs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.yi(e).next(t=>{t||(this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)))})}).next(()=>this.wi(e)).next(t=>this.isPrimary&&!t?this.Si(e).next(()=>!1):!!t&&this.bi(e).next(()=>!0))).catch(e=>{if(Xe(e))return H("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return H("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ai.enqueueRetryable(()=>this.Ei(e)),this.isPrimary=e})}yi(e){return Xi(e).get("owner").next(t=>T.resolve(this.Di(t)))}Ci(e){return Hs(e).delete(this.clientId)}async vi(){if(this.isPrimary&&!this.Fi(this.Ti,18e5)){this.Ti=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Et(t,"clientMetadata");return n.U().next(i=>{let s=this.Mi(i,18e5),l=i.filter(u=>s.indexOf(u)===-1);return T.forEach(l,u=>n.delete(u.clientId)).next(()=>l)})}).catch(()=>[]);if(this.Ri)for(let t of e)this.Ri.removeItem(this.xi(t.clientId))}}gi(){this.Ii=this.ai.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Vi().then(()=>this.vi()).then(()=>this.gi()))}Di(e){return!!e&&e.ownerId===this.clientId}wi(e){return this.ci?T.resolve(!0):Xi(e).get("owner").next(t=>{if(t!==null&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)){if(this.Di(t)&&this.networkEnabled)return!0;if(!this.Di(t)){if(!t.allowTabSynchronization)throw new ee(M.FAILED_PRECONDITION,to);return!1}}return!(!this.networkEnabled||!this.inForeground)||Hs(e).U().next(n=>this.Mi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,l=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||l&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&H("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Qr=!1,this.Ni(),this.Ii&&(this.Ii.cancel(),this.Ii=null),this.Li(),this.Bi(),await this.Ai.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ai(e,ct.oe);return this.Si(t).next(()=>this.Ci(t))}),this.Ai.close(),this.ki()}Mi(e,t){return e.filter(n=>this.Fi(n.updateTimeMs,t)&&!this.Oi(n.clientId))}qi(){return this.runTransaction("getActiveClients","readonly",e=>Hs(e).U().next(t=>this.Mi(t,18e5).map(n=>n.clientId)))}get started(){return this.Qr}getGlobalsCache(){return this.Kr}getMutationQueue(e,t){return $s.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.$r}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Nc(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Bs.lt(this.serializer,e)}getBundleCache(){return this.Wr}runTransaction(e,t,n){var i;let s;H("IndexedDbPersistence","Starting transaction:",e);let l=(i=this.li)===17?Pa:i===16||i===15?Hr:i===14||i===13?ir:i===12?bs:i===11?Dn:void K();return this.Ai.runTransaction(e,t==="readonly"?"readonly":"readwrite",l,u=>(s=new Ai(u,this.qr?this.qr.next():ct.oe),t==="readwrite-primary"?this.yi(s).next(c=>!!c||this.wi(s)).next(c=>{if(!c)throw Ve(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ai.enqueueRetryable(()=>this.Ei(!1)),new ee(M.FAILED_PRECONDITION,pe);return n(s)}).next(c=>this.bi(s).next(()=>c)):this.Qi(s).next(()=>n(s)))).then(u=>(s.raiseOnCommittedEvent(),u))}Qi(e){return Xi(e).get("owner").next(t=>{if(t!==null&&this.Fi(t.leaseTimestampMs,5e3)&&!this.Oi(t.ownerId)&&!this.Di(t)&&!(this.ci||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ee(M.FAILED_PRECONDITION,to)})}bi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xi(e).put("owner",t)}static D(){return Le.D()}Si(e){let t=Xi(e);return t.get("owner").next(n=>this.Di(n)?(H("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):T.resolve())}Fi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(Ve(`Detected an update time that is in the future: ${e} > ${n}`),!1))}mi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Pi=()=>{this.ai.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Vi()))},this.document.addEventListener("visibilitychange",this.Pi),this.inForeground=this.document.visibilityState==="visible")}Li(){this.Pi&&(this.document.removeEventListener("visibilitychange",this.Pi),this.Pi=null)}fi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.hi=()=>{this.Ni();let t=/(?:Version|Mobile)\/1[456]/;(0,Fe.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ai.enterRestrictedMode(!0),this.ai.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.hi))}Bi(){this.hi&&(this.window.removeEventListener("pagehide",this.hi),this.hi=null)}Oi(e){var t;try{let n=((t=this.Ri)===null||t===void 0?void 0:t.getItem(this.xi(e)))!==null;return H("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Ve("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Ni(){if(this.Ri)try{this.Ri.setItem(this.xi(this.clientId),String(Date.now()))}catch(e){Ve("Failed to set zombie client id.",e)}}ki(){if(this.Ri)try{this.Ri.removeItem(this.xi(this.clientId))}catch{}}xi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Xi(r){return Et(r,"owner")}function Hs(r){return Et(r,"clientMetadata")}function Kc(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class ro{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Ki=n,this.$i=i}static Ui(e,t){let n=ke(),i=ke();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ro(e,t.fromCache,n,i)}}class Gc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ou{constructor(){this.Wi=!1,this.Gi=!1,this.zi=100,this.ji=(0,Fe.G6)()?8:ht((0,Fe.z$)())>0?6:4}initialize(e,t){this.Hi=e,this.indexManager=t,this.Wi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Ji(e,t).next(l=>{s.result=l}).next(()=>{if(!s.result)return this.Yi(e,t,i,n).next(l=>{s.result=l})}).next(()=>{if(s.result)return;let l=new Gc;return this.Zi(e,t,l).next(u=>{if(s.result=u,this.Gi)return this.Xi(e,t,l,u.size)})}).next(()=>s.result)}Xi(e,t,n,i){return n.documentReadCount<this.zi?($t()<=pt.in.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",h(t),"since it only creates cache indexes for collection contains","more than or equal to",this.zi,"documents"),T.resolve()):($t()<=pt.in.DEBUG&&H("QueryEngine","Query:",h(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ji*i?($t()<=pt.in.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",h(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Kt(t))):T.resolve())}Ji(e,t){if(Vi(t))return T.resolve(null);let n=Kt(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(n=Kt(t=ni(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let l=ke(...s);return this.Hi.getDocuments(e,l).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let g=this.es(t,u);return this.ts(t,g,l,c.readTime)?this.Ji(e,ni(t,null,"F")):this.ns(e,g,t,c)}))})))}Yi(e,t,n,i){return Vi(t)||i.isEqual(R.min())?T.resolve(null):this.Hi.getDocuments(e,n).next(s=>{let l=this.es(t,s);return this.ts(t,l,n,i)?T.resolve(null):($t()<=pt.in.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),h(t)),this.ns(e,l,t,U(i,-1)).next(u=>u))})}es(e,t){let n=new Ye(b(e));return t.forEach((i,s)=>{f(e,s)&&(n=n.add(s))}),n}ts(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Zi(e,t,n){return $t()<=pt.in.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",h(t)),this.Hi.getDocumentsMatchingQuery(e,t,de.min(),n)}ns(e,t,n,i){return this.Hi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(l=>{s=s.insert(l.key,l)}),s))}}class lu{constructor(e,t,n,i){this.persistence=e,this.rs=t,this.serializer=i,this.ss=new at(ve),this.os=new x(s=>$n(s),Qn),this._s=new Map,this.us=e.getRemoteDocumentCache(),this.$r=e.getTargetCache(),this.Wr=e.getBundleCache(),this.cs(n)}cs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ru(this.us,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.us.setIndexManager(this.indexManager),this.rs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ss))}}async function uu(r,e){return await r.persistence.runTransaction("Handle user change","readonly",t=>{let n;return r.mutationQueue.getAllMutationBatches(t).next(i=>(n=i,r.cs(e),r.mutationQueue.getAllMutationBatches(t))).next(i=>{let s=[],l=[],u=ke();for(let c of n)for(let g of(s.push(c.batchId),c.mutations))u=u.add(g.key);for(let c of i)for(let g of(l.push(c.batchId),c.mutations))u=u.add(g.key);return r.localDocuments.getDocuments(t,u).next(c=>({ls:c,removedBatchIds:s,addedBatchIds:l}))})})}function hu(r){return r.persistence.runTransaction("Get last remote snapshot version","readonly",e=>r.$r.getLastRemoteSnapshotVersion(e))}function Hc(r,e,t){let n=ke(),i=ke();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let l=G;return t.forEach((u,c)=>{let g=s.get(u);c.isFoundDocument()!==g.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(R.min())?(e.removeEntry(u,c.readTime),l=l.insert(u,c)):!g.isValidDocument()||c.version.compareTo(g.version)>0||c.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(c),l=l.insert(u,c)):H("LocalStore","Ignoring outdated watch update for ",u,". Current version:",g.version," Watch version:",c.version)}),{hs:l,Ps:i}})}function Ws(r,e){return r.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return r.$r.getTargetData(t,e).next(i=>i?(n=i,T.resolve(n)):r.$r.allocateTargetId(t).next(s=>(n=new Xn(e,s,"TargetPurposeListen",t.currentSequenceNumber),r.$r.addTargetData(t,n).next(()=>n))))}).then(t=>{let n=r.ss.get(t.targetId);return(n===null||t.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.ss=r.ss.insert(t.targetId,t),r.os.set(e,t.targetId)),t})}async function di(r,e,t){let n=r.ss.get(e);try{t||await r.persistence.runTransaction("Release target",t?"readwrite":"readwrite-primary",i=>r.persistence.referenceDelegate.removeTarget(i,n))}catch(i){if(!Xe(i))throw i;H("LocalStore",`Failed to update sequence numbers for target ${e}: ${i}`)}r.ss=r.ss.remove(e),r.os.delete(n.target)}function io(r,e,t){let n=R.min(),i=ke();return r.persistence.runTransaction("Execute query","readwrite",s=>function(l,u,c){let g=l.os.get(c);return g!==void 0?T.resolve(l.ss.get(g)):l.$r.getTargetData(u,c)}(r,s,Kt(e)).next(l=>{if(l)return n=l.lastLimboFreeSnapshotVersion,r.$r.getMatchingKeysForTargetId(s,l.targetId).next(u=>{i=u})}).next(()=>r.rs.getDocumentsMatchingQuery(s,e,t?n:R.min(),t?i:ke())).next(l=>(fu(r,y(e),l),{documents:l,Is:i})))}function cu(r,e){let t=r.$r,n=r.ss.get(e);return n?Promise.resolve(n.target):r.persistence.runTransaction("Get target data","readonly",i=>t.ot(i,e).next(s=>s?s.target:null))}function du(r,e){let t=r._s.get(e)||R.min();return r.persistence.runTransaction("Get new document changes","readonly",n=>r.us.getAllFromCollectionGroup(n,e,U(t,-1),Number.MAX_SAFE_INTEGER)).then(n=>(fu(r,e,n),n))}function fu(r,e,t){let n=r._s.get(e)||R.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r._s.set(e,n)}function pu(r,e){return`firestore_clients_${r}_${e}`}function mu(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function so(r,e){return`firestore_targets_${r}_${e}`}class Qs{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static As(e,t,n){let i=JSON.parse(n),s,l=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return l&&i.error&&(l=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(s=new ee(i.error.code,i.error.message)),l?new Qs(e,t,i.state,s):(Ve("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Rs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Yi{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static As(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string")&&(i=new ee(n.error.code,n.error.message)),s?new Yi(e,n.state,i):(Ve("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Rs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Js{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static As(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=hn;for(let l=0;i&&l<n.activeTargetIds.length;++l)i=bn(n.activeTargetIds[l]),s=s.add(n.activeTargetIds[l]);return i?new Js(e,s):(Ve("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ao{constructor(e,t){this.clientId=e,this.onlineState=t}static As(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new ao(t.clientId,t.onlineState):(Ve("SharedClientState",`Failed to parse online state: ${e}`),null)}}class oo{constructor(){this.activeTargetIds=hn}Vs(e){this.activeTargetIds=this.activeTargetIds.add(e)}fs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Rs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class gf{constructor(e,t,n,i,s){var l,u,c;this.window=e,this.ai=t,this.persistenceKey=n,this.gs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ps=this.ys.bind(this),this.ws=new at(ve),this.started=!1,this.Ss=[];let g=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.bs=pu(this.persistenceKey,this.gs),this.Ds=(l=this.persistenceKey,`firestore_sequence_number_${l}`),this.ws=this.ws.insert(this.gs,new oo),this.Cs=RegExp(`^firestore_clients_${g}_([^_]*)$`),this.vs=RegExp(`^firestore_mutations_${g}_(\\d+)(?:_(.*))?$`),this.Fs=RegExp(`^firestore_targets_${g}_(\\d+)$`),this.Ms=(u=this.persistenceKey,`firestore_online_state_${u}`),this.xs=(c=this.persistenceKey,`firestore_bundle_loaded_v2_${c}`),this.window.addEventListener("storage",this.ps)}static D(e){return!(!e||!e.localStorage)}async start(){for(let t of await this.syncEngine.qi()){if(t===this.gs)continue;let n=this.getItem(pu(this.persistenceKey,t));if(n){let i=Js.As(t,n);i&&(this.ws=this.ws.insert(i.clientId,i))}}this.Os();let e=this.storage.getItem(this.Ms);if(e){let t=this.Ns(e);t&&this.Ls(t)}for(let t of this.Ss)this.ys(t);this.Ss=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ds,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Bs(this.ws)}isActiveQueryTarget(e){let t=!1;return this.ws.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ks(e,"pending")}updateMutationState(e,t,n){this.ks(e,t,n),this.qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(so(this.persistenceKey,e));if(n){let i=Yi.As(e,n);i&&(t=i.state)}}return this.Qs.Vs(e),this.Os(),t}removeLocalQueryTarget(e){this.Qs.fs(e),this.Os()}isLocalQueryTarget(e){return this.Qs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(so(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ks(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.$s(e)}notifyBundleLoaded(e){this.Us(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ps),this.removeItem(this.bs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return H("SharedClientState","READ",e,t),t}setItem(e,t){H("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){H("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ys(e){if(e.storageArea===this.storage){if(H("SharedClientState","EVENT",e.key,e.newValue),e.key===this.bs)return void Ve("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ai.enqueueRetryable(async()=>{if(this.started){if(e.key!==null){if(this.Cs.test(e.key)){if(e.newValue==null){let t=this.Ws(e.key);return this.Gs(t,null)}{let t=this.zs(e.key,e.newValue);if(t)return this.Gs(t.clientId,t)}}else if(this.vs.test(e.key)){if(e.newValue!==null){let t=this.js(e.key,e.newValue);if(t)return this.Hs(t)}}else if(this.Fs.test(e.key)){if(e.newValue!==null){let t=this.Js(e.key,e.newValue);if(t)return this.Ys(t)}}else if(e.key===this.Ms){if(e.newValue!==null){let t=this.Ns(e.newValue);if(t)return this.Ls(t)}}else if(e.key===this.Ds){let t=function(n){let i=ct.oe;if(n!=null)try{let s=JSON.parse(n);typeof s=="number"||K(),i=s}catch(s){Ve("SharedClientState","Failed to read sequence number from WebStorage",s)}return i}(e.newValue);t!==ct.oe&&this.sequenceNumberHandler(t)}else if(e.key===this.xs){let t=this.Zs(e.newValue);await Promise.all(t.map(n=>this.syncEngine.Xs(n)))}}}else this.Ss.push(e)})}}get Qs(){return this.ws.get(this.gs)}Os(){this.setItem(this.bs,this.Qs.Rs())}ks(e,t,n){let i=new Qs(this.currentUser,e,t,n),s=mu(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Rs())}qs(e){let t=mu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}$s(e){let t={clientId:this.gs,onlineState:e};this.storage.setItem(this.Ms,JSON.stringify(t))}Ks(e,t,n){let i=so(this.persistenceKey,e),s=new Yi(e,t,n);this.setItem(i,s.Rs())}Us(e){let t=JSON.stringify(Array.from(e));this.setItem(this.xs,t)}Ws(e){let t=this.Cs.exec(e);return t?t[1]:null}zs(e,t){let n=this.Ws(e);return Js.As(n,t)}js(e,t){let n=this.vs.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Qs.As(new xe(s),i,t)}Js(e,t){let n=Number(this.Fs.exec(e)[1]);return Yi.As(n,t)}Ns(e){return ao.As(e)}Zs(e){return JSON.parse(e)}async Hs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.eo(e.batchId,e.state,e.error);H("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Ys(e){return this.syncEngine.no(e.targetId,e.state,e.error)}Gs(e,t){let n=t?this.ws.insert(e,t):this.ws.remove(e),i=this.Bs(this.ws),s=this.Bs(n),l=[],u=[];return s.forEach(c=>{i.has(c)||l.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.ro(l,u).then(()=>{this.ws=n})}Ls(e){this.ws.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Bs(e){let t=hn;return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class gu{constructor(){this.io=new oo,this.so={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.io.Vs(e),this.so[e]||"not-current"}updateQueryState(e,t,n){this.so[e]=t}removeLocalQueryTarget(e){this.io.fs(e)}isLocalQueryTarget(e){return this.io.activeTargetIds.has(e)}clearQueryState(e){delete this.so[e]}getAllActiveQueryTargets(){return this.io.activeTargetIds}isActiveQueryTarget(e){return this.io.activeTargetIds.has(e)}start(){return this.io=new oo,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Wc{oo(e){}shutdown(){}}class yu{constructor(){this._o=()=>this.ao(),this.uo=()=>this.co(),this.lo=[],this.ho()}oo(e){this.lo.push(e)}shutdown(){window.removeEventListener("online",this._o),window.removeEventListener("offline",this.uo)}ho(){window.addEventListener("online",this._o),window.addEventListener("offline",this.uo)}ao(){for(let e of(H("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.lo))e(0)}co(){for(let e of(H("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.lo))e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Xs=null;function lo(){return Xs===null?Xs=268435456+Math.round(2147483648*Math.random()):Xs++,"0x"+Xs.toString(16)}let Qc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Jc{constructor(e){this.Po=e.Po,this.Io=e.Io}To(e){this.Eo=e}Ao(e){this.Ro=e}Vo(e){this.mo=e}onMessage(e){this.fo=e}close(){this.Io()}send(e){this.Po(e)}po(){this.Eo()}yo(){this.Ro()}wo(e){this.mo(e)}So(e){this.fo(e)}}let Gt="WebChannelConnection";class Xc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.bo=t+"://"+e.host,this.Do=`projects/${n}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get vo(){return!1}Fo(e,t,n,i,s){let l=lo(),u=this.Mo(e,t.toUriEncodedString());H("RestConnection",`Sending RPC '${e}' ${l}:`,u,n);let c={"google-cloud-resource-prefix":this.Do,"x-goog-request-params":this.Co};return this.xo(c,i,s),this.Oo(e,u,c,n).then(g=>(H("RestConnection",`Received RPC '${e}' ${l}: `,g),g),g=>{throw Yt("RestConnection",`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",n),g})}No(e,t,n,i,s,l){return this.Fo(e,t,n,i,s)}xo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+yt}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}Mo(e,t){let n=Qc[e];return`${this.bo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Oo(e,t,n,i){let s=lo();return new Promise((l,u)=>{let c=new He;c.setWithCredentials(!0),c.listenOnce(ze.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case ie.NO_ERROR:let v=c.getResponseJson();H(Gt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(v)),l(v);break;case ie.TIMEOUT:H(Gt,`RPC '${e}' ${s} timed out`),u(new ee(M.DEADLINE_EXCEEDED,"Request time out"));break;case ie.HTTP_ERROR:let k=c.getStatus();if(H(Gt,`RPC '${e}' ${s} failed with status:`,k,"response text:",c.getResponseText()),k>0){let N=c.getResponseJson();Array.isArray(N)&&(N=N[0]);let O=N?.error;if(O&&O.status&&O.message){let Q=function(se){let ae=se.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(ae)>=0?ae:M.UNKNOWN}(O.status);u(new ee(Q,O.message))}else u(new ee(M.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new ee(M.UNAVAILABLE,"Connection failed."));break;default:K()}}finally{H(Gt,`RPC '${e}' ${s} completed.`)}});let g=JSON.stringify(i);H(Gt,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",g,n,15)})}Lo(e,t,n){let i=lo(),s=[this.bo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=Oe(),u=Ce(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(c.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(c.xmlHttpFactory=new it({})),this.xo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let v=s.join("");H(Gt,`Creating RPC '${e}' stream ${i}: ${v}`,c);let k=l.createWebChannel(v,c),N=!1,O=!1,Q=new Jc({Po:ae=>{O?H(Gt,`Not sending because RPC '${e}' stream ${i} is closed:`,ae):(N||(H(Gt,`Opening RPC '${e}' stream ${i} transport.`),k.open(),N=!0),H(Gt,`RPC '${e}' stream ${i} sending:`,ae),k.send(ae))},Io:()=>k.close()}),se=(ae,_e,ge)=>{ae.listen(_e,A=>{try{ge(A)}catch(I){setTimeout(()=>{throw I},0)}})};return se(k,St.EventType.OPEN,()=>{O||(H(Gt,`RPC '${e}' stream ${i} transport opened.`),Q.po())}),se(k,St.EventType.CLOSE,()=>{O||(O=!0,H(Gt,`RPC '${e}' stream ${i} transport closed`),Q.wo())}),se(k,St.EventType.ERROR,ae=>{O||(O=!0,Yt(Gt,`RPC '${e}' stream ${i} transport errored:`,ae),Q.wo(new ee(M.UNAVAILABLE,"The operation could not be completed")))}),se(k,St.EventType.MESSAGE,ae=>{var _e;if(!O){let ge=ae.data[0];ge||K();let A=ge.error||((_e=ge[0])===null||_e===void 0?void 0:_e.error);if(A){H(Gt,`RPC '${e}' stream ${i} received error:`,A);let I=A.status,_=function(D){let L=Re[D];if(L!==void 0)return dl(L)}(I),C=A.message;_===void 0&&(_=M.INTERNAL,C="Unknown error status: "+I+" with message "+A.message),O=!0,Q.wo(new ee(_,C)),k.close()}else H(Gt,`RPC '${e}' stream ${i} received:`,ge),Q.So(ge)}}),se(u,he.STAT_EVENT,ae=>{ae.stat===ne.PROXY?H(Gt,`RPC '${e}' stream ${i} detected buffering proxy`):ae.stat===ne.NOPROXY&&H(Gt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{Q.yo()},0),Q}}function Yc(){return typeof window<"u"?window:null}function Ys(){return typeof document<"u"?document:null}function Zs(r){return new _c(r,!0)}class vu{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ai=e,this.timerId=t,this.Bo=n,this.ko=i,this.qo=s,this.Qo=0,this.Ko=null,this.$o=Date.now(),this.reset()}reset(){this.Qo=0}Uo(){this.Qo=this.qo}Wo(e){this.cancel();let t=Math.floor(this.Qo+this.Go()),n=Math.max(0,Date.now()-this.$o),i=Math.max(0,t-n);i>0&&H("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Qo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ko=this.ai.enqueueAfterDelay(this.timerId,i,()=>(this.$o=Date.now(),e())),this.Qo*=this.ko,this.Qo<this.Bo&&(this.Qo=this.Bo),this.Qo>this.qo&&(this.Qo=this.qo)}zo(){this.Ko!==null&&(this.Ko.skipDelay(),this.Ko=null)}cancel(){this.Ko!==null&&(this.Ko.cancel(),this.Ko=null)}Go(){return(Math.random()-.5)*this.Qo}}class wu{constructor(e,t,n,i,s,l,u,c){this.ai=e,this.jo=n,this.Ho=i,this.connection=s,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Jo=0,this.Yo=null,this.Zo=null,this.stream=null,this.Xo=0,this.e_=new vu(e,t)}t_(){return this.state===1||this.state===5||this.n_()}n_(){return this.state===2||this.state===3}start(){this.Xo=0,this.state!==4?this.auth():this.r_()}async stop(){this.t_()&&await this.close(0)}i_(){this.state=0,this.e_.reset()}s_(){this.n_()&&this.Yo===null&&(this.Yo=this.ai.enqueueAfterDelay(this.jo,6e4,()=>this.o_()))}__(e){this.a_(),this.stream.send(e)}async o_(){if(this.n_())return this.close(0)}a_(){this.Yo&&(this.Yo.cancel(),this.Yo=null)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}async close(e,t){this.a_(),this.u_(),this.e_.cancel(),this.Jo++,e!==4?this.e_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(Ve(t.toString()),Ve("Using maximum backoff delay to prevent overloading the backend."),this.e_.Uo()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.c_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Vo(t)}c_(){}auth(){this.state=1;let e=this.l_(this.Jo),t=this.Jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Jo===t&&this.h_(n,i)},n=>{e(()=>{let i=new ee(M.UNKNOWN,"Fetching auth token failed: "+n.message);return this.P_(i)})})}h_(e,t){let n=this.l_(this.Jo);this.stream=this.I_(e,t),this.stream.To(()=>{n(()=>this.listener.To())}),this.stream.Ao(()=>{n(()=>(this.state=2,this.Zo=this.ai.enqueueAfterDelay(this.Ho,1e4,()=>(this.n_()&&(this.state=3),Promise.resolve())),this.listener.Ao()))}),this.stream.Vo(i=>{n(()=>this.P_(i))}),this.stream.onMessage(i=>{n(()=>++this.Xo==1?this.T_(i):this.onNext(i))})}r_(){this.state=5,this.e_.Wo(async()=>{this.state=0,this.start()})}P_(e){return H("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}l_(e){return t=>{this.ai.enqueueAndForget(()=>this.Jo===e?t():(H("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zc extends wu{constructor(e,t,n,i,s,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,l),this.serializer=s}I_(e,t){return this.connection.Lo("Listen",e,t)}T_(e){return this.onNext(e)}onNext(e){this.e_.reset();let t=function(i,s){let l;if("targetChange"in s){var u,c;s.targetChange;let g=(u=s.targetChange.targetChangeType||"NO_CHANGE")==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:K(),v=s.targetChange.targetIds||[],k=(c=s.targetChange.resumeToken,i.useProto3Json?(c===void 0||typeof c=="string"||K(),lt.fromBase64String(c||"")):(c===void 0||c instanceof We||c instanceof Uint8Array||K(),lt.fromUint8Array(c||new Uint8Array))),N=s.targetChange.cause;l=new gl(g,v,k,N&&new ee(N.code===void 0?M.UNKNOWN:dl(N.code),N.message||"")||null)}else if("documentChange"in s){s.documentChange;let g=s.documentChange;g.document,g.document.name,g.document.updateTime;let v=Dr(i,g.document.name),k=nn(g.document.updateTime),N=g.document.createTime?nn(g.document.createTime):R.min(),O=new Mt({mapValue:{fields:g.document.fields}}),Q=mt.newFoundDocument(v,k,N,O);l=new Ms(g.targetIds||[],g.removedTargetIds||[],Q.key,Q)}else if("documentDelete"in s){s.documentDelete;let g=s.documentDelete;g.document;let v=Dr(i,g.document),k=g.readTime?nn(g.readTime):R.min(),N=mt.newNoDocument(v,k);l=new Ms([],g.removedTargetIds||[],N.key,N)}else if("documentRemove"in s){s.documentRemove;let g=s.documentRemove;g.document;let v=Dr(i,g.document);l=new Ms([],g.removedTargetIds||[],v,null)}else{if(!("filter"in s))return K();{s.filter;let g=s.filter;g.targetId;let{count:v=0,unchangedNames:k}=g,N=new mc(v,k);l=new ml(g.targetId,N)}}return l}(this.serializer,e),n=function(i){if(!("targetChange"in i))return R.min();let s=i.targetChange;return s.targetIds&&s.targetIds.length?R.min():s.readTime?nn(s.readTime):R.min()}(e);return this.listener.E_(t,n)}d_(e){let t={};t.database=Ha(this.serializer),t.addTarget=function(i,s){let l,u=s.target;if((l=Zr(u)?{documents:Cl(i,u)}:{query:kl(i,u)._t}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0){l.resumeToken=Il(i,s.resumeToken);let c=$a(i,s.expectedCount);c!==null&&(l.expectedCount=c)}else if(s.snapshotVersion.compareTo(R.min())>0){l.readTime=si(i,s.snapshotVersion.toTimestamp());let c=$a(i,s.expectedCount);c!==null&&(l.expectedCount=c)}return l}(this.serializer,e);let n=function(i,s){let l=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return K()}}(s.purpose);return l==null?null:{"goog-listen-tags":l}}(this.serializer,e);n&&(t.labels=n),this.__(t)}A_(e){let t={};t.database=Ha(this.serializer),t.removeTarget=e,this.__(t)}}class ed extends wu{constructor(e,t,n,i,s,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,l),this.serializer=s}get R_(){return this.Xo>0}start(){this.lastStreamToken=void 0,super.start()}c_(){this.R_&&this.V_([])}I_(e,t){return this.connection.Lo("Write",e,t)}T_(e){return e.streamToken||K(),this.lastStreamToken=e.streamToken,e.writeResults&&e.writeResults.length!==0&&K(),this.listener.m_()}onNext(e){var t,n;e.streamToken||K(),this.lastStreamToken=e.streamToken,this.e_.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(n!==void 0||K(),t.map(l=>{let u;return(u=l.updateTime?nn(l.updateTime):nn(n)).isEqual(R.min())&&(u=nn(n)),new pc(u,l.transformResults||[])})):[]),s=nn(e.commitTime);return this.listener.f_(s,i)}g_(){let e={};e.database=Ha(this.serializer),this.__(e)}V_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Fs(this.serializer,n))};this.__(t)}}class td extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.p_=!1}y_(){if(this.p_)throw new ee(M.FAILED_PRECONDITION,"The client has already been terminated.")}Fo(e,t,n,i){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,l])=>this.connection.Fo(e,Ga(t,n),i,s,l)).catch(s=>{throw s.name==="FirebaseError"?(s.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ee(M.UNKNOWN,s.toString())})}No(e,t,n,i,s){return this.y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.No(e,Ga(t,n),i,l,u,s)).catch(l=>{throw l.name==="FirebaseError"?(l.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new ee(M.UNKNOWN,l.toString())})}terminate(){this.p_=!0,this.connection.terminate()}}class nd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.w_=0,this.S_=null,this.b_=!0}D_(){this.w_===0&&(this.C_("Unknown"),this.S_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.S_=null,this.v_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}F_(e){this.state==="Online"?this.C_("Unknown"):(this.w_++,this.w_>=1&&(this.M_(),this.v_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.M_(),this.w_=0,e==="Online"&&(this.b_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}v_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.b_?(Ve(t),this.b_=!1):H("OnlineStateTracker",t)}M_(){this.S_!==null&&(this.S_.cancel(),this.S_=null)}}class rd{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.x_=[],this.O_=new Map,this.N_=new Set,this.L_=[],this.B_=s,this.B_.oo(l=>{n.enqueueAndForget(async()=>{Vr(this)&&(H("RemoteStore","Restarting streams for network reachability change."),await async function(u){u.N_.add(4),await Zi(u),u.k_.set("Unknown"),u.N_.delete(4),await ea(u)}(this))})}),this.k_=new nd(n,i)}}async function ea(r){if(Vr(r))for(let e of r.L_)await e(!0)}async function Zi(r){for(let e of r.L_)await e(!1)}function ta(r,e){r.O_.has(e.targetId)||(r.O_.set(e.targetId,e),co(r)?ho(r):mi(r).n_()&&uo(r,e))}function fi(r,e){let t=mi(r);r.O_.delete(e),t.n_()&&Iu(r,e),r.O_.size===0&&(t.n_()?t.s_():Vr(r)&&r.k_.set("Unknown"))}function uo(r,e){if(r.q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(R.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}mi(r).d_(e)}function Iu(r,e){r.q_.xe(e),mi(r).A_(e)}function ho(r){r.q_=new yc({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.O_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),mi(r).start(),r.k_.D_()}function co(r){return Vr(r)&&!mi(r).t_()&&r.O_.size>0}function Vr(r){return r.N_.size===0}async function id(r){r.k_.set("Online")}async function sd(r){r.O_.forEach((e,t)=>{uo(r,e)})}async function ad(r,e){r.q_=void 0,co(r)?(r.k_.F_(e),ho(r)):r.k_.set("Unknown")}async function od(r,e,t){if(r.k_.set("Online"),e instanceof gl&&e.state===2&&e.cause)try{await async function(n,i){let s=i.cause;for(let l of i.targetIds)n.O_.has(l)&&(await n.remoteSyncer.rejectListen(l,s),n.O_.delete(l),n.q_.removeTarget(l))}(r,e)}catch(n){H("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await na(r,n)}else if(e instanceof Ms?r.q_.Ke(e):e instanceof ml?r.q_.He(e):r.q_.We(e),!t.isEqual(R.min()))try{let n=await hu(r.localStore);t.compareTo(n)>=0&&await function(i,s){let l=i.q_.rt(s);return l.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let g=i.O_.get(c);g&&i.O_.set(c,g.withResumeToken(u.resumeToken,s))}}),l.targetMismatches.forEach((u,c)=>{let g=i.O_.get(u);if(!g)return;i.O_.set(u,g.withResumeToken(lt.EMPTY_BYTE_STRING,g.snapshotVersion)),Iu(i,u);let v=new Xn(g.target,u,c,g.sequenceNumber);uo(i,v)}),i.remoteSyncer.applyRemoteEvent(l)}(r,t)}catch(n){H("RemoteStore","Failed to raise snapshot:",n),await na(r,n)}}async function na(r,e,t){if(!Xe(e))throw e;r.N_.add(1),await Zi(r),r.k_.set("Offline"),t||(t=()=>hu(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{H("RemoteStore","Retrying IndexedDB access"),await t(),r.N_.delete(1),await ea(r)})}function _u(r,e){return e().catch(t=>na(r,t,e))}async function pi(r){let e=mr(r),t=r.x_.length>0?r.x_[r.x_.length-1].batchId:-1;for(;Vr(r)&&r.x_.length<10;)try{let n=await function(i,s){return i.persistence.runTransaction("Get next mutation batch","readonly",l=>(s===void 0&&(s=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(l,s)))}(r.localStore,t);if(n===null){r.x_.length===0&&e.s_();break}t=n.batchId,function(i,s){i.x_.push(s);let l=mr(i);l.n_()&&l.R_&&l.V_(s.mutations)}(r,n)}catch(n){await na(r,n)}bu(r)&&Eu(r)}function bu(r){return Vr(r)&&!mr(r).t_()&&r.x_.length>0}function Eu(r){mr(r).start()}async function ld(r){mr(r).g_()}async function ud(r){let e=mr(r);for(let t of r.x_)e.V_(t.mutations)}async function hd(r,e,t){let n=r.x_.shift(),i=qa.from(n,e,t);await _u(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await pi(r)}async function cd(r,e){e&&mr(r).R_&&await async function(t,n){var i;if(function(s){switch(s){default:return K();case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0}}(i=n.code)&&i!==M.ABORTED){let s=t.x_.shift();mr(t).i_(),await _u(t,()=>t.remoteSyncer.rejectFailedWrite(s.batchId,n)),await pi(t)}}(r,e),bu(r)&&Eu(r)}async function Tu(r,e){r.asyncQueue.verifyOperationInProgress(),H("RemoteStore","RemoteStore received new credentials");let t=Vr(r);r.N_.add(3),await Zi(r),t&&r.k_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.N_.delete(3),await ea(r)}async function fo(r,e){e?(r.N_.delete(2),await ea(r)):e||(r.N_.add(2),await Zi(r),r.k_.set("Unknown"))}function mi(r){var e,t,n;return r.Q_||(r.Q_=(e=r.datastore,t=r.asyncQueue,n={To:id.bind(null,r),Ao:sd.bind(null,r),Vo:ad.bind(null,r),E_:od.bind(null,r)},e.y_(),new Zc(t,e.connection,e.authCredentials,e.appCheckCredentials,e.serializer,n)),r.L_.push(async i=>{i?(r.Q_.i_(),co(r)?ho(r):r.k_.set("Unknown")):(await r.Q_.stop(),r.q_=void 0)})),r.Q_}function mr(r){var e,t,n;return r.K_||(r.K_=(e=r.datastore,t=r.asyncQueue,n={To:()=>Promise.resolve(),Ao:ld.bind(null,r),Vo:cd.bind(null,r),m_:ud.bind(null,r),f_:hd.bind(null,r)},e.y_(),new ed(t,e.connection,e.authCredentials,e.appCheckCredentials,e.serializer,n)),r.L_.push(async i=>{i?(r.K_.i_(),await pi(r)):(await r.K_.stop(),r.x_.length>0&&(H("RemoteStore",`Stopping write stream with ${r.x_.length} pending writes`),r.x_=[]))})),r.K_}class po{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let l=new po(e,t,Date.now()+n,i,s);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ee(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mo(r,e){if(Ve("AsyncQueue",`${e}: ${r}`),Xe(r))return new ee(M.UNAVAILABLE,`${e}: ${r}`);throw r}class gi{constructor(e){this.comparator=e?(t,n)=>e(t,n)||J.comparator(t.key,n.key):(t,n)=>J.comparator(t.key,n.key),this.keyedMap=le(),this.sortedSet=new at(this.comparator)}static emptySet(e){return new gi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gi)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new gi;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Su{constructor(){this.U_=new at(J.comparator)}track(e){let t=e.doc.key,n=this.U_.get(t);n?e.type!==0&&n.type===3?this.U_=this.U_.insert(t,e):e.type===3&&n.type!==1?this.U_=this.U_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.U_=this.U_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.U_=this.U_.remove(t):e.type===1&&n.type===2?this.U_=this.U_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.U_=this.U_.insert(t,{type:2,doc:e.doc}):K():this.U_=this.U_.insert(t,e)}W_(){let e=[];return this.U_.inorderTraversal((t,n)=>{e.push(n)}),e}}class yi{constructor(e,t,n,i,s,l,u,c,g){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=g}static fromInitialDocuments(e,t,n,i,s){let l=[];return t.forEach(u=>{l.push({type:0,doc:u})}),new yi(e,t,gi.emptySet(t),l,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&p(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class dd{constructor(){this.G_=void 0,this.z_=[]}j_(){return this.z_.some(e=>e.H_())}}class fd{constructor(){this.queries=Cu(),this.onlineState="Unknown",this.J_=new Set}terminate(){(function(e,t){let n=e.queries;e.queries=Cu(),n.forEach((i,s)=>{for(let l of s.z_)l.onError(t)})})(this,new ee(M.ABORTED,"Firestore shutting down"))}}function Cu(){return new x(r=>a(r),p)}async function ku(r,e){let t=3,n=e.query,i=r.queries.get(n);i?!i.j_()&&e.H_()&&(t=2):(i=new dd,t=e.H_()?0:1);try{switch(t){case 0:i.G_=await r.onListen(n,!0);break;case 1:i.G_=await r.onListen(n,!1);break;case 2:await r.onFirstRemoteStoreListen(n)}}catch(s){let l=mo(s,`Initialization of query '${h(e.query)}' failed`);return void e.onError(l)}r.queries.set(n,i),i.z_.push(e),e.Y_(r.onlineState),i.G_&&e.Z_(i.G_)&&go(r)}async function Au(r,e){let t=e.query,n=3,i=r.queries.get(t);if(i){let s=i.z_.indexOf(e);s>=0&&(i.z_.splice(s,1),i.z_.length===0?n=e.H_()?0:1:!i.j_()&&e.H_()&&(n=2))}switch(n){case 0:return r.queries.delete(t),r.onUnlisten(t,!0);case 1:return r.queries.delete(t),r.onUnlisten(t,!1);case 2:return r.onLastRemoteStoreUnlisten(t);default:return}}function pd(r,e){let t=!1;for(let n of e){let i=n.query,s=r.queries.get(i);if(s){for(let l of s.z_)l.Z_(n)&&(t=!0);s.G_=n}}t&&go(r)}function md(r,e,t){let n=r.queries.get(e);if(n)for(let i of n.z_)i.onError(t);r.queries.delete(e)}function go(r){r.J_.forEach(e=>{e.next()})}(ue=ft||(ft={})).X_="default",ue.Cache="cache";class Nu{constructor(e,t,n){this.query=e,this.ea=t,this.ta=!1,this.na=null,this.onlineState="Unknown",this.options=n||{}}Z_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new yi(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ta?this.ra(e)&&(this.ea.next(e),t=!0):this.ia(e,this.onlineState)&&(this.sa(e),t=!0),this.na=e,t}onError(e){this.ea.error(e)}Y_(e){this.onlineState=e;let t=!1;return this.na&&!this.ta&&this.ia(this.na,e)&&(this.sa(this.na),t=!0),t}ia(e,t){return!(e.fromCache&&this.H_())||(!this.options.oa||t==="Offline")&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ra(e){if(e.docChanges.length>0)return!0;let t=this.na&&this.na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}sa(e){e=yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ta=!0,this.ea.next(e)}H_(){return this.options.source!==ft.Cache}}class xu{constructor(e){this.key=e}}class Du{constructor(e){this.key=e}}class gd{constructor(e,t){this.query=e,this.Ia=t,this.Ta=null,this.hasCachedResults=!1,this.current=!1,this.Ea=ke(),this.mutatedKeys=ke(),this.da=b(e),this.Aa=new gi(this.da)}get Ra(){return this.Ia}Va(e,t){let n=t?t.ma:new Su,i=t?t.Aa:this.Aa,s=t?t.mutatedKeys:this.mutatedKeys,l=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,g=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((v,k)=>{let N=i.get(v),O=f(this.query,k)?k:null,Q=!!N&&this.mutatedKeys.has(N.key),se=!!O&&(O.hasLocalMutations||this.mutatedKeys.has(O.key)&&O.hasCommittedMutations),ae=!1;N&&O?N.data.isEqual(O.data)?Q!==se&&(n.track({type:3,doc:O}),ae=!0):this.fa(N,O)||(n.track({type:2,doc:O}),ae=!0,(c&&this.da(O,c)>0||g&&0>this.da(O,g))&&(u=!0)):!N&&O?(n.track({type:0,doc:O}),ae=!0):N&&!O&&(n.track({type:1,doc:N}),ae=!0,(c||g)&&(u=!0)),ae&&(O?(l=l.add(O),s=se?s.add(v):s.delete(v)):(l=l.delete(v),s=s.delete(v)))}),this.query.limit!==null)for(;l.size>this.query.limit;){let v=this.query.limitType==="F"?l.last():l.first();l=l.delete(v.key),s=s.delete(v.key),n.track({type:1,doc:v})}return{Aa:l,ma:n,ts:u,mutatedKeys:s}}fa(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Aa;this.Aa=e.Aa,this.mutatedKeys=e.mutatedKeys;let l=e.ma.W_();l.sort((v,k)=>function(N,O){let Q=se=>{switch(se){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K()}};return Q(N)-Q(O)}(v.type,k.type)||this.da(v.doc,k.doc)),this.ga(n),i=i!=null&&i;let u=t&&!i?this.pa():[],c=this.Ea.size===0&&this.current&&!i?1:0,g=c!==this.Ta;return this.Ta=c,l.length!==0||g?{snapshot:new yi(this.query,e.Aa,s,l,e.mutatedKeys,c===0,g,!1,!!n&&n.resumeToken.approximateByteSize()>0),ya:u}:{ya:u}}Y_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Aa:this.Aa,ma:new Su,mutatedKeys:this.mutatedKeys,ts:!1},!1)):{ya:[]}}wa(e){return!this.Ia.has(e)&&!!this.Aa.has(e)&&!this.Aa.get(e).hasLocalMutations}ga(e){e&&(e.addedDocuments.forEach(t=>this.Ia=this.Ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ia=this.Ia.delete(t)),this.current=e.current)}pa(){if(!this.current)return[];let e=this.Ea;this.Ea=ke(),this.Aa.forEach(n=>{this.wa(n.key)&&(this.Ea=this.Ea.add(n.key))});let t=[];return e.forEach(n=>{this.Ea.has(n)||t.push(new Du(n))}),this.Ea.forEach(n=>{e.has(n)||t.push(new xu(n))}),t}Sa(e){this.Ia=e.Is,this.Ea=ke();let t=this.Va(e.documents);return this.applyChanges(t,!0)}ba(){return yi.fromInitialDocuments(this.query,this.Aa,this.mutatedKeys,this.Ta===0,this.hasCachedResults)}}class yd{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class vd{constructor(e){this.key=e,this.Da=!1}}class wd{constructor(e,t,n,i,s,l){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=l,this.Ca={},this.va=new x(u=>a(u),p),this.Fa=new Map,this.Ma=new Set,this.xa=new at(J.comparator),this.Oa=new Map,this.Na=new eo,this.La={},this.Ba=new Map,this.ka=Ur.Bn(),this.onlineState="Unknown",this.qa=void 0}get isPrimaryClient(){return this.qa===!0}}async function Id(r,e,t=!0){let n,i=ra(r),s=i.va.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.ba()):n=await Ru(i,e,t,!0),n}async function _d(r,e){let t=ra(r);await Ru(t,e,!0,!1)}async function Ru(r,e,t,n){let i,s=await Ws(r.localStore,Kt(e)),l=s.targetId,u=t?r.sharedClientState.addLocalQueryTarget(l):"not-current";return n&&(i=await yo(r,e,l,u==="current",s.resumeToken)),r.isPrimaryClient&&t&&ta(r.remoteStore,s),i}async function yo(r,e,t,n,i){r.Qa=(k,N,O)=>async function(Q,se,ae,_e){let ge=se.view.Va(ae);ge.ts&&(ge=await io(Q.localStore,se.query,!1).then(({documents:C})=>se.view.Va(C,ge)));let A=_e&&_e.targetChanges.get(se.targetId),I=_e&&_e.targetMismatches.get(se.targetId)!=null,_=se.view.applyChanges(ge,Q.isPrimaryClient,A,I);return Io(Q,se.targetId,_.ya),_.snapshot}(r,k,N,O);let s=await io(r.localStore,e,!0),l=new gd(e,s.Is),u=l.Va(s.documents),c=Ki.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),g=l.applyChanges(u,r.isPrimaryClient,c);Io(r,t,g.ya);let v=new yd(e,t,l);return r.va.set(e,v),r.Fa.has(t)?r.Fa.get(t).push(e):r.Fa.set(t,[e]),g.snapshot}async function bd(r,e,t){let n=r.va.get(e),i=r.Fa.get(n.targetId);if(i.length>1)return r.Fa.set(n.targetId,i.filter(s=>!p(s,e))),void r.va.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(n.targetId),r.sharedClientState.isActiveQueryTarget(n.targetId)||await di(r.localStore,n.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(n.targetId),t&&fi(r.remoteStore,n.targetId),vi(r,n.targetId)}).catch(be)):(vi(r,n.targetId),await di(r.localStore,n.targetId,!0))}async function Ed(r,e){let t=r.va.get(e),n=r.Fa.get(t.targetId);r.isPrimaryClient&&n.length===1&&(r.sharedClientState.removeLocalQueryTarget(t.targetId),fi(r.remoteStore,t.targetId))}async function Td(r,e,t){let n=bo(r);try{var i;let s,l=await function(u,c){let g,v,k=W.now(),N=c.reduce((O,Q)=>O.add(Q.key),ke());return u.persistence.runTransaction("Locally write mutations","readwrite",O=>{let Q=G,se=ke();return u.us.getEntries(O,N).next(ae=>{(Q=ae).forEach((_e,ge)=>{ge.isValidDocument()||(se=se.add(_e))})}).next(()=>u.localDocuments.getOverlayedDocuments(O,Q)).next(ae=>{g=ae;let _e=[];for(let ge of c){let A=function(I,_){let C=null;for(let D of I.fieldTransforms){let L=_.data.field(D.field),E=cn(D.transform,L||null);E!=null&&(C===null&&(C=Mt.empty()),C.set(D.field,E))}return C||null}(ge,g.get(ge.key).overlayedDocument);A!=null&&_e.push(new Jn(ge.key,A,function I(_){let C=[];return En(_.fields,(D,L)=>{let E=new we([D]);if(Xr(L)){let Nt=I(L.mapValue).fields;if(Nt.length===0)C.push(E);else for(let bi of Nt)C.push(E.child(bi))}else C.push(E)}),new jt(C)}(A.value.mapValue),tn.exists(!0)))}return u.mutationQueue.addMutationBatch(O,k,_e,c)}).next(ae=>{v=ae;let _e=ae.applyToLocalDocumentSet(g,se);return u.documentOverlayCache.saveOverlays(O,ae.batchId,_e)})}).then(()=>({batchId:v.batchId,changes:Te(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(l.batchId),i=l.batchId,(s=n.La[n.currentUser.toKey()])||(s=new at(ve)),s=s.insert(i,t),n.La[n.currentUser.toKey()]=s,await gr(n,l.changes),await pi(n.remoteStore)}catch(s){let l=mo(s,"Failed to persist write");t.reject(l)}}async function Ou(r,e){try{let t=await function(n,i){let s=i.snapshotVersion,l=n.ss;return n.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{let c=n.us.newChangeBuffer({trackRemovals:!0});l=n.ss;let g=[];i.targetChanges.forEach((N,O)=>{var Q;let se=l.get(O);if(!se)return;g.push(n.$r.removeMatchingKeys(u,N.removedDocuments,O).next(()=>n.$r.addMatchingKeys(u,N.addedDocuments,O)));let ae=se.withSequenceNumber(u.currentSequenceNumber);i.targetMismatches.get(O)!==null?ae=ae.withResumeToken(lt.EMPTY_BYTE_STRING,R.min()).withLastLimboFreeSnapshotVersion(R.min()):N.resumeToken.approximateByteSize()>0&&(ae=ae.withResumeToken(N.resumeToken,s)),l=l.insert(O,ae),Q=ae,(se.resumeToken.approximateByteSize()===0||Q.snapshotVersion.toMicroseconds()-se.snapshotVersion.toMicroseconds()>=3e8||N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0)&&g.push(n.$r.updateTargetData(u,ae))});let v=G,k=ke();if(i.documentUpdates.forEach(N=>{i.resolvedLimboDocuments.has(N)&&g.push(n.persistence.referenceDelegate.updateLimboDocument(u,N))}),g.push(Hc(u,c,i.documentUpdates).next(N=>{v=N.hs,k=N.Ps})),!s.isEqual(R.min())){let N=n.$r.getLastRemoteSnapshotVersion(u).next(O=>n.$r.setTargetsMetadata(u,u.currentSequenceNumber,s));g.push(N)}return T.waitFor(g).next(()=>c.apply(u)).next(()=>n.localDocuments.getLocalViewOfDocuments(u,v,k)).next(()=>v)}).then(u=>(n.ss=l,u))}(r.localStore,e);e.targetChanges.forEach((n,i)=>{let s=r.Oa.get(i);s&&(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1||K(),n.addedDocuments.size>0?s.Da=!0:n.modifiedDocuments.size>0?s.Da||K():n.removedDocuments.size>0&&(s.Da||K(),s.Da=!1))}),await gr(r,t,e)}catch(t){await be(t)}}function Pu(r,e,t){var n;if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i,s=[];r.va.forEach((l,u)=>{let c=u.view.Y_(e);c.snapshot&&s.push(c.snapshot)}),(n=r.eventManager).onlineState=e,i=!1,n.queries.forEach((l,u)=>{for(let c of u.z_)c.Y_(e)&&(i=!0)}),i&&go(n),s.length&&r.Ca.E_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Sd(r,e,t){r.sharedClientState.updateQueryState(e,"rejected",t);let n=r.Oa.get(e),i=n&&n.key;if(i){let s=new at(J.comparator);s=s.insert(i,mt.newNoDocument(i,R.min()));let l=ke().add(i),u=new $i(R.min(),new Map,new at(ve),s,l);await Ou(r,u),r.xa=r.xa.remove(i),r.Oa.delete(e),_o(r)}else await di(r.localStore,e,!1).then(()=>vi(r,e,t)).catch(be)}async function Cd(r,e){var t;let n=e.batch.batchId;try{let i=await(t=r.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{let l=e.batch.keys(),u=t.us.newChangeBuffer({trackRemovals:!0});return function(c,g,v,k){let N=v.batch,O=N.keys(),Q=T.resolve();return O.forEach(se=>{Q=Q.next(()=>k.getEntry(g,se)).next(ae=>{let _e=v.docVersions.get(se);_e!==null||K(),0>ae.version.compareTo(_e)&&(N.applyToRemoteDocument(ae,v),ae.isValidDocument()&&(ae.setReadTime(v.commitVersion),k.addEntry(ae)))})}),Q.next(()=>c.mutationQueue.removeMutationBatch(g,N))}(t,s,e,u).next(()=>u.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,l,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(c){let g=ke();for(let v=0;v<c.mutationResults.length;++v)c.mutationResults[v].transformResults.length>0&&(g=g.add(c.batch.mutations[v].key));return g}(e))).next(()=>t.localDocuments.getDocuments(s,l))});wo(r,n,null),vo(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await gr(r,i)}catch(i){await be(i)}}async function kd(r,e,t){var n;try{let i=await(n=r.localStore).persistence.runTransaction("Reject batch","readwrite-primary",s=>{let l;return n.mutationQueue.lookupMutationBatch(s,e).next(u=>(u!==null||K(),l=u.keys(),n.mutationQueue.removeMutationBatch(s,u))).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,l,e)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,l)).next(()=>n.localDocuments.getDocuments(s,l))});wo(r,e,t),vo(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await gr(r,i)}catch(i){await be(i)}}function vo(r,e){(r.Ba.get(e)||[]).forEach(t=>{t.resolve()}),r.Ba.delete(e)}function wo(r,e,t){let n=r.La[r.currentUser.toKey()];if(n){let i=n.get(e);i&&(t?i.reject(t):i.resolve(),n=n.remove(e)),r.La[r.currentUser.toKey()]=n}}function vi(r,e,t=null){for(let n of(r.sharedClientState.removeLocalQueryTarget(e),r.Fa.get(e)))r.va.delete(n),t&&r.Ca.Ka(n,t);r.Fa.delete(e),r.isPrimaryClient&&r.Na.mr(e).forEach(n=>{r.Na.containsKey(n)||Lu(r,n)})}function Lu(r,e){r.Ma.delete(e.path.canonicalString());let t=r.xa.get(e);t!==null&&(fi(r.remoteStore,t),r.xa=r.xa.remove(e),r.Oa.delete(t),_o(r))}function Io(r,e,t){for(let n of t)n instanceof xu?(r.Na.addReference(n.key,e),function(i,s){let l=s.key,u=l.path.canonicalString();i.xa.get(l)||i.Ma.has(u)||(H("SyncEngine","New document in limbo: "+l),i.Ma.add(u),_o(i))}(r,n)):n instanceof Du?(H("SyncEngine","Document no longer in limbo: "+n.key),r.Na.removeReference(n.key,e),r.Na.containsKey(n.key)||Lu(r,n.key)):K()}function _o(r){for(;r.Ma.size>0&&r.xa.size<r.maxConcurrentLimboResolutions;){let e=r.Ma.values().next().value;r.Ma.delete(e);let t=new J(te.fromString(e)),n=r.ka.next();r.Oa.set(n,new vd(t)),r.xa=r.xa.insert(t,n),ta(r.remoteStore,new Xn(Kt(xr(t.path)),n,"TargetPurposeLimboResolution",ct.oe))}}async function gr(r,e,t){let n=[],i=[],s=[];r.va.isEmpty()||(r.va.forEach((l,u)=>{s.push(r.Qa(u,e,t).then(c=>{var g;if((c||t)&&r.isPrimaryClient){let v=c?!c.fromCache:(g=t?.targetChanges.get(u.targetId))===null||g===void 0?void 0:g.current;r.sharedClientState.updateQueryState(u.targetId,v?"current":"not-current")}if(c){n.push(c);let v=ro.Ui(u.targetId,c);i.push(v)}}))}),await Promise.all(s),r.Ca.E_(n),await async function(l,u){try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",c=>T.forEach(u,g=>T.forEach(g.Ki,v=>l.persistence.referenceDelegate.addReference(c,g.targetId,v)).next(()=>T.forEach(g.$i,v=>l.persistence.referenceDelegate.removeReference(c,g.targetId,v)))))}catch(c){if(!Xe(c))throw c;H("LocalStore","Failed to update sequence numbers: "+c)}for(let c of u){let g=c.targetId;if(!c.fromCache){let v=l.ss.get(g),k=v.snapshotVersion,N=v.withLastLimboFreeSnapshotVersion(k);l.ss=l.ss.insert(g,N)}}}(r.localStore,i))}async function Ad(r,e){var t;if(!r.currentUser.isEqual(e)){H("SyncEngine","User change. New user:",e.toKey());let n=await uu(r.localStore,e);r.currentUser=e,t="'waitForPendingWrites' promise is rejected due to a user change.",r.Ba.forEach(i=>{i.forEach(s=>{s.reject(new ee(M.CANCELLED,t))})}),r.Ba.clear(),r.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await gr(r,n.ls)}}function Nd(r,e){let t=r.Oa.get(e);if(t&&t.Da)return ke().add(t.key);{let n=ke(),i=r.Fa.get(e);if(!i)return n;for(let s of i){let l=r.va.get(s);n=n.unionWith(l.view.Ra)}return n}}async function xd(r,e){let t=await io(r.localStore,e.query,!0),n=e.view.Sa(t);return r.isPrimaryClient&&Io(r,e.targetId,n.ya),n}async function yf(r,e){return du(r.localStore,e).then(t=>gr(r,t))}async function vf(r,e,t,n){let i=await function(s,l){let u=s.mutationQueue;return s.persistence.runTransaction("Lookup mutation documents","readonly",c=>u.Fn(c,l).next(g=>g?s.localDocuments.getDocuments(c,g):T.resolve(null)))}(r.localStore,e);i!==null?(t==="pending"?await pi(r.remoteStore):t==="acknowledged"||t==="rejected"?(wo(r,e,n||null),vo(r,e),function(s,l){s.mutationQueue.xn(l)}(r.localStore,e)):K(),await gr(r,i)):H("SyncEngine","Cannot apply mutation batch with id: "+e)}async function wf(r,e){if(ra(r),bo(r),e===!0&&r.qa!==!0){let t=r.sharedClientState.getAllActiveQueryTargets(),n=await Mu(r,t.toArray());for(let i of(r.qa=!0,await fo(r.remoteStore,!0),n))ta(r.remoteStore,i)}else if(e===!1&&r.qa!==!1){let t=[],n=Promise.resolve();r.Fa.forEach((i,s)=>{r.sharedClientState.isLocalQueryTarget(s)?t.push(s):n=n.then(()=>(vi(r,s),di(r.localStore,s,!0))),fi(r.remoteStore,s)}),await n,await Mu(r,t),r.Oa.forEach((i,s)=>{fi(r.remoteStore,s)}),r.Na.gr(),r.Oa=new Map,r.xa=new at(J.comparator),r.qa=!1,await fo(r.remoteStore,!1)}}async function Mu(r,e,t){let n=[],i=[];for(let s of e){let l,u=r.Fa.get(s);if(u&&u.length!==0)for(let c of(l=await Ws(r.localStore,Kt(u[0])),u)){let g=r.va.get(c),v=await xd(r,g);v.snapshot&&i.push(v.snapshot)}else{let c=await cu(r.localStore,s);l=await Ws(r.localStore,c),await yo(r,Uu(c),s,!1,l.resumeToken)}n.push(l)}return r.Ca.E_(i),n}function Uu(r){var e,t,n,i;return e=r.path,t=r.collectionGroup,n=r.orderBy,i=r.filters,new ln(e,t,n,i,r.limit,"F",r.startAt,r.endAt)}function If(r){return r.localStore.persistence.qi()}async function _f(r,e,t,n){if(r.qa)return void H("SyncEngine","Ignoring unexpected query state notification.");let i=r.Fa.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{let s=await du(r.localStore,y(i[0])),l=$i.createSynthesizedRemoteEventForCurrentChange(e,t==="current",lt.EMPTY_BYTE_STRING);await gr(r,s,l);break}case"rejected":await di(r.localStore,e,!0),vi(r,e,n);break;default:K()}}async function bf(r,e,t){let n=ra(r);if(n.qa){for(let i of e){if(n.Fa.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){H("SyncEngine","Adding an already active target "+i);continue}let s=await cu(n.localStore,i),l=await Ws(n.localStore,s);await yo(n,Uu(s),l.targetId,!1,l.resumeToken),ta(n.remoteStore,l)}for(let i of t)n.Fa.has(i)&&await di(n.localStore,i,!1).then(()=>{fi(n.remoteStore,i),vi(n,i)}).catch(be)}}function ra(r){return r.remoteStore.remoteSyncer.applyRemoteEvent=Ou.bind(null,r),r.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nd.bind(null,r),r.remoteStore.remoteSyncer.rejectListen=Sd.bind(null,r),r.Ca.E_=pd.bind(null,r.eventManager),r.Ca.Ka=md.bind(null,r.eventManager),r}function bo(r){return r.remoteStore.remoteSyncer.applySuccessfulWrite=Cd.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=kd.bind(null,r),r}class Eo{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Zs(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t;return t=this.persistence,new lu(t,new ou,e.initialUser,this.serializer)}createPersistence(e){return new iu(Gs.Yr,this.serializer)}createSharedClientState(e){return new gu}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ef extends Eo{constructor(e,t,n){super(),this.Ua=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ua.initialize(this,e),await bo(this.Ua.syncEngine),await pi(this.Ua.remoteStore),await this.persistence.pi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t;return t=this.persistence,new lu(t,new ou,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Rc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new Gr(t,this.persistence);return new Kr(e.asyncQueue,n)}createPersistence(e){let t=Kc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?dn.withCacheSize(this.cacheSizeBytes):dn.DEFAULT;return new no(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Yc(),Ys(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new gu}}class Dd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Pu(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ad.bind(null,this.syncEngine),await fo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fd}createDatastore(e){let t=Zs(e.databaseInfo.databaseId),n=new Xc(e.databaseInfo);return new td(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){var t;return t=this.localStore,new rd(t,this.datastore,e.asyncQueue,n=>Pu(this.syncEngine,n,0),yu.D()?new yu:new Wc)}createSyncEngine(e,t){return function(n,i,s,l,u,c,g){let v=new wd(n,i,s,l,u,c);return g&&(v.qa=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(n){H("RemoteStore","RemoteStore shutting down."),n.N_.add(5),await Zi(n),n.B_.shutdown(),n.k_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}class Fu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Wa(this.observer.next,e)}error(e){this.observer.error?this.Wa(this.observer.error,e):Ve("Uncaught Error in snapshot listener:",e.toString())}Ga(){this.muted=!0}Wa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Rd{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=xe.UNAUTHENTICATED,this.clientId=wt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async s=>{H("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(n,s=>(H("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ee(M.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=mo(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function To(r,e){r.asyncQueue.verifyOperationInProgress(),H("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await uu(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function Vu(r,e){r.asyncQueue.verifyOperationInProgress();let t=await Od(r);H("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Tu(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Tu(e.remoteStore,i)),r._onlineComponents=e}async function Od(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){H("FirestoreClient","Using user provided OfflineComponentProvider");try{await To(r,r._uninitializedComponentsProvider._offline)}catch(t){var e;if(!((e=t).name==="FirebaseError"?e.code===M.FAILED_PRECONDITION||e.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11))throw t;Yt("Error using user provided cache. Falling back to memory cache: "+t),await To(r,new Eo)}}else H("FirestoreClient","Using default OfflineComponentProvider"),await To(r,new Eo);return r._offlineComponents}async function Bu(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(H("FirestoreClient","Using user provided OnlineComponentProvider"),await Vu(r,r._uninitializedComponentsProvider._online)):(H("FirestoreClient","Using default OnlineComponentProvider"),await Vu(r,new Dd))),r._onlineComponents}async function qu(r){let e=await Bu(r),t=e.eventManager;return t.onListen=Id.bind(null,e.syncEngine),t.onUnlisten=bd.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_d.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Ed.bind(null,e.syncEngine),t}function ju(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}let zu=new Map;function $u(r,e,t){if(!t)throw new ee(M.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Ku(r){if(!J.isDocumentKey(r))throw new ee(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Gu(r){if(J.isDocumentKey(r))throw new ee(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ia(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{var e;let t=(e=r).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":K()}function Yn(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new ee(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ia(r);throw new ee(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class Hu{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new ee(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ee(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(i,s,l,u){if(s===!0&&u===!0)throw new ee(M.INVALID_ARGUMENT,`${i} and ${l} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ju((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ee(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ee(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ee(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sa{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ee(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new ee(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hu(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new q;switch(t.type){case"firstParty":return new Pe(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ee(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=zu.get(e);t&&(H("ComponentProvider","Removing Datastore"),zu.delete(e),t.terminate())}(this),Promise.resolve()}}class Kn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Kn(this.firestore,e,this._query)}}class fn{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fn(this.firestore,e,this._key)}}class yr extends Kn{constructor(e,t,n){super(e,t,xr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new fn(this.firestore,null,new J(e))}withConverter(e){return new yr(this.firestore,e,this._path)}}function Pd(r,e,...t){if(r=(0,Fe.m9)(r),$u("collection","path",e),r instanceof sa){let n=te.fromString(e,...t);return Gu(n),new yr(r,null,n)}{if(!(r instanceof fn||r instanceof yr))throw new ee(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(te.fromString(e,...t));return Gu(n),new yr(r.firestore,null,n)}}function Wu(r,e,...t){if(r=(0,Fe.m9)(r),arguments.length==1&&(e=wt.newId()),$u("doc","path",e),r instanceof sa){let n=te.fromString(e,...t);return Ku(n),new fn(r,null,new J(n))}{if(!(r instanceof fn||r instanceof yr))throw new ee(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(te.fromString(e,...t));return Ku(n),new fn(r.firestore,r instanceof yr?r.converter:null,new J(n))}}class Ld{constructor(){this._u=Promise.resolve(),this.au=[],this.uu=!1,this.cu=[],this.lu=null,this.hu=!1,this.Pu=!1,this.Iu=[],this.e_=new vu(this,"async_queue_retry"),this.Tu=()=>{let t=Ys();t&&H("AsyncQueue","Visibility state changed to "+t.visibilityState),this.e_.zo()};let e=Ys();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Tu)}get isShuttingDown(){return this.uu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Eu(),this.du(e)}enterRestrictedMode(e){if(!this.uu){this.uu=!0,this.Pu=e||!1;let t=Ys();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Tu)}}enqueue(e){if(this.Eu(),this.uu)return new Promise(()=>{});let t=new Rt;return this.du(()=>this.uu&&this.Pu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.au.push(e),this.Au()))}async Au(){if(this.au.length!==0){try{await this.au[0](),this.au.shift(),this.e_.reset()}catch(e){if(!Xe(e))throw e;H("AsyncQueue","Operation failed with retryable error: "+e)}this.au.length>0&&this.e_.Wo(()=>this.Au())}}du(e){let t=this._u.then(()=>(this.hu=!0,e().catch(n=>{let i;throw this.lu=n,this.hu=!1,Ve("INTERNAL UNHANDLED ERROR: ",(i=n.message||"",n.stack&&(i=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),i)),n}).then(n=>(this.hu=!1,n))));return this._u=t,t}enqueueAfterDelay(e,t,n){this.Eu(),this.Iu.indexOf(e)>-1&&(t=0);let i=po.createAndSchedule(this,e,t,n,s=>this.Ru(s));return this.cu.push(i),i}Eu(){this.lu&&K()}verifyOperationInProgress(){}async Vu(){let e;do e=this._u,await e;while(e!==this._u)}mu(e){for(let t of this.cu)if(t.timerId===e)return!0;return!1}fu(e){return this.Vu().then(()=>{for(let t of(this.cu.sort((n,i)=>n.targetTimeMs-i.targetTimeMs),this.cu))if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Vu()})}gu(e){this.Iu.push(e)}Ru(e){let t=this.cu.indexOf(e);this.cu.splice(t,1)}}class wi extends sa{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Ld,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Qu(this),this._firestoreClient.terminate()}}function Md(r,e){let t=typeof r=="object"?r:(0,Je.Mq)(),n=(0,Je.qX)(t,"firestore").getImmediate({identifier:typeof r=="string"?r:e||"(default)"});if(!n._initialized){let i=(0,Fe.P0)("firestore");i&&function(s,l,u,c={}){var g;let v=(s=Yn(s,sa))._getSettings(),k=`${l}:${u}`;if(v.host!=="firestore.googleapis.com"&&v.host!==k&&Yt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},v),{host:k,ssl:!1})),c.mockUserToken){let N,O;if(typeof c.mockUserToken=="string")N=c.mockUserToken,O=xe.MOCK_USER;else{N=(0,Fe.Sg)(c.mockUserToken,(g=s._app)===null||g===void 0?void 0:g.options.projectId);let Q=c.mockUserToken.sub||c.mockUserToken.user_id;if(!Q)throw new ee(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");O=new xe(Q)}s._authCredentials=new Y(new V(N,O))}}(n,...i)}return n}function So(r){return r._firestoreClient||Qu(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Qu(r){var e,t,n,i;let s=r._freezeSettings(),l=(i=r._databaseId,new Es(i,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,ju(s.experimentalLongPollingOptions),s.useFetchStreams));r._firestoreClient=new Rd(r._authCredentials,r._appCheckCredentials,r._queue,l),((t=s.localCache)===null||t===void 0?void 0:t._offlineComponentProvider)&&((n=s.localCache)===null||n===void 0?void 0:n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Ii{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ii(lt.fromBase64String(e))}catch(t){throw new ee(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ii(lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class aa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ee(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new we(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class _i{constructor(e){this._methodName=e}}class Co{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ee(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ee(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}}let Ud=/^__.*__$/;class Fd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Jn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ii(e,this.data,t,this.fieldTransforms)}}class Ju{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Jn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Xu(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K()}}class oa{constructor(e,t,n,i,s,l){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.pu(),this.fieldTransforms=s||[],this.fieldMask=l||[]}get path(){return this.settings.path}get yu(){return this.settings.yu}wu(e){return new oa(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Su(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.Du(e),i}Cu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.wu({path:n,bu:!1});return i.pu(),i}vu(e){return this.wu({path:void 0,bu:!0})}Fu(e){return ha(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.xu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Du(this.path.get(e))}Du(e){if(e.length===0)throw this.Fu("Document fields must not be empty");if(Xu(this.yu)&&Ud.test(e))throw this.Fu('Document fields cannot begin and end with "__"')}}class Vd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Zs(e)}Ou(e,t,n,i=!1){return new oa({yu:e,methodName:t,xu:n,path:we.emptyPath(),bu:!1,Mu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function la(r){let e=r._freezeSettings(),t=Zs(r._databaseId);return new Vd(r._databaseId,!!e.ignoreUndefinedProperties,t)}class ua extends _i{_toFieldTransform(e){if(e.yu!==2)throw e.yu===1?e.Fu(`${this._methodName}() can only appear at the top level of your update data`):e.Fu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ua}}function Yu(r,e,t){return new oa({yu:3,xu:e.settings.xu,methodName:r._methodName,bu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Zu extends null{_toFieldTransform(e){return new ji(e.path,new Ft)}isEqual(e){return e instanceof Zu}}class eh extends _i{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){let t=Yu(this,e,!0),n=new Lt(this.Nu.map(i=>Br(i,t)));return new ji(e.path,n)}isEqual(e){return e instanceof eh&&(0,Fe.vZ)(this.Nu,e.Nu)}}class th extends _i{constructor(e,t){super(e),this.Nu=t}_toFieldTransform(e){let t=Yu(this,e,!0),n=new An(this.Nu.map(i=>Br(i,t)));return new ji(e.path,n)}isEqual(e){return e instanceof th&&(0,Fe.vZ)(this.Nu,e.Nu)}}class nh extends _i{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=new cr(e.serializer,wn(e.serializer,this.Lu));return new ji(e.path,t)}isEqual(e){return e instanceof nh&&this.Lu===e.Lu}}function rh(r,e,t,n=!1){return Br(t,r.Ou(n?4:3,e))}function Br(r,e){if(sh(r=(0,Fe.m9)(r)))return ko("Unsupported field value:",e,r),ih(r,e);if(r instanceof _i)return function(t,n){if(!Xu(n.yu))throw n.Fu(`${t._methodName}() can only be used with update() and set()`);if(!n.path)throw n.Fu(`${t._methodName}() is not currently supported inside arrays`);let i=t._toFieldTransform(n);i&&n.fieldTransforms.push(i)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.bu&&e.yu!==4)throw e.Fu("Nested arrays are not supported");return function(t,n){let i=[],s=0;for(let l of t){let u=Br(l,n.vu(s));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),s++}return{arrayValue:{values:i}}}(r,e)}return function(t,n){if((t=(0,Fe.m9)(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return wn(n.serializer,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){let i=W.fromDate(t);return{timestampValue:si(n.serializer,i)}}if(t instanceof W){let i=new W(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:si(n.serializer,i)}}if(t instanceof Co)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ii)return{bytesValue:Il(n.serializer,t._byteString)};if(t instanceof fn){let i=n.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw n.Fu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ka(t.firestore._databaseId||n.databaseId,t._key.path)}}throw n.Fu(`Unsupported field value: ${ia(t)}`)}(r,e)}function ih(r,e){let t={};return Wr(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):En(r,(n,i)=>{let s=Br(i,e.Su(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function sh(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof W||r instanceof Co||r instanceof Ii||r instanceof fn||r instanceof _i)}function ko(r,e,t){if(!sh(t)||!(typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null))){let n=ia(t);throw n==="an object"?e.Fu(r+" a custom object"):e.Fu(r+" "+n)}}function Ao(r,e,t){if((e=(0,Fe.m9)(e))instanceof aa)return e._internalPath;if(typeof e=="string")return No(r,e);throw ha("Field path arguments must be of type string or ",r,!1,void 0,t)}let Bd=RegExp("[~\\*/\\[\\]]");function No(r,e,t){if(e.search(Bd)>=0)throw ha(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new aa(...e.split("."))._internalPath}catch{throw ha(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ha(r,e,t,n,i){let s=n&&!n.isEmpty(),l=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||l)&&(c+=" (found",s&&(c+=` in field ${n}`),l&&(c+=` in document ${i}`),c+=")"),new ee(M.INVALID_ARGUMENT,u+r+c)}function ah(r,e){return r.some(t=>t.isEqual(e))}class xo{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new fn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new qd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Do("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class qd extends xo{data(){return super.data()}}function Do(r,e){return typeof e=="string"?No(r,e):e instanceof aa?e._internalPath:e._delegate._internalPath}class Ro{}class es extends Ro{}function jd(r,e,...t){let n=[];for(let i of(e instanceof Ro&&n.push(e),function(s){let l=s.filter(c=>c instanceof Oo).length,u=s.filter(c=>c instanceof ca).length;if(l>1||l>0&&u>0)throw new ee(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(t)),n))r=i._apply(r);return r}class ca extends es{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ca(e,t,n)}_apply(e){let t=this._parse(e);return ph(e._query,t),new Kn(e.firestore,e.converter,qi(e._query,t))}_parse(e){let t=la(e.firestore);return function(n,i,s,l,u,c,g){let v;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new ee(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){fh(g,c);let k=[];for(let N of g)k.push(dh(l,n,N));v={arrayValue:{values:k}}}else v=dh(l,n,g)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||fh(g,c),v=rh(s,i,g,c==="in"||c==="not-in");return Me.create(u,c,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function zd(r,e,t){let n=Do("where",r);return ca._create(n,e,t)}class Oo extends Ro{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Oo(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Ze.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(n,i){let s=n;for(let l of i.getFlattenedFilters())ph(s,l),s=qi(s,l)}(e._query,t),new Kn(e.firestore,e.converter,qi(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class oh extends es{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oh(e,t)}_apply(e){let t=function(n,i,s){if(n.startAt!==null)throw new ee(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new ee(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new or(i,s)}(e._query,this._field,this._direction);return new Kn(e.firestore,e.converter,function(n,i){let s=n.explicitOrderBy.concat([i]);return new ln(n.path,n.collectionGroup,s,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}(e._query,t))}}class lh extends es{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new lh(e,t,n)}_apply(e){return new Kn(e.firestore,e.converter,ni(e._query,this._limit,this._limitType))}}class uh extends es{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new uh(e,t,n)}_apply(e){var t;let n=ch(e,this.type,this._docOrFields,this._inclusive);return new Kn(e.firestore,e.converter,new ln((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}class hh extends es{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hh(e,t,n)}_apply(e){var t;let n=ch(e,this.type,this._docOrFields,this._inclusive);return new Kn(e.firestore,e.converter,new ln((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n))}}function ch(r,e,t,n){if(t[0]=(0,Fe.m9)(t[0]),t[0]instanceof xo)return function(i,s,l,u,c){if(!u)throw new ee(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);let g=[];for(let v of hr(i))if(v.field.isKeyField())g.push(Ln(s,u.key));else{let k=u.data.field(v.field);if(Jr(k))throw new ee(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+v.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(k===null){let N=v.field.canonicalString();throw new ee(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${N}' (used as the orderBy) does not exist.`)}g.push(k)}return new zn(g,c)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=la(r.firestore);return function(s,l,u,c,g,v){let k=s.explicitOrderBy;if(g.length>k.length)throw new ee(M.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let N=[];for(let O=0;O<g.length;O++){let Q=g[O];if(k[O].field.isKeyField()){if(typeof Q!="string")throw new ee(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof Q}`);if(!Bi(s)&&Q.indexOf("/")!==-1)throw new ee(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${Q}' contains a slash.`);let se=s.path.child(te.fromString(Q));if(!J.isDocumentKey(se))throw new ee(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${se}' is not because it contains an odd number of segments.`);let ae=new J(se);N.push(Ln(l,ae))}else{let se=rh(u,c,Q);N.push(se)}}return new zn(N,v)}(r._query,r.firestore._databaseId,i,e,t,n)}}function dh(r,e,t){if(typeof(t=(0,Fe.m9)(t))=="string"){if(t==="")throw new ee(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bi(e)&&t.indexOf("/")!==-1)throw new ee(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(te.fromString(t));if(!J.isDocumentKey(n))throw new ee(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ln(r,new J(n))}if(t instanceof fn)return Ln(r,t._key);throw new ee(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ia(t)}.`)}function fh(r,e){if(!Array.isArray(r)||r.length===0)throw new ee(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ph(r,e){let t=function(n,i){for(let s of n)for(let l of s.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(r.filters,function(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ee(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ee(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class $d{convertValue(e,t="none"){switch(On(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw K()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return En(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new Co($e(e.latitude),$e(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=kr(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(jn(e));default:return null}}convertTimestamp(e){let t=Rn(e);return new W(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=te.fromString(e);Nl(n)||K();let i=new yn(n.get(1),n.get(3)),s=new J(n.popFirst(5));return i.isEqual(t)||Ve(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class ts{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mh extends xo{constructor(e,t,n,i,s,l){super(e,t,n,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new da(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Do("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class da extends mh{data(e={}){return super.data(e)}}class Kd{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ts(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new da(this._firestore,this._userDataWriter,n.key,n,new ts(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ee(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(n,i){if(n._snapshot.oldDocs.isEmpty()){let s=0;return n._snapshot.docChanges.map(l=>{let u=new da(n._firestore,n._userDataWriter,l.doc.key,l.doc,new ts(n._snapshot.mutatedKeys.has(l.doc.key),n._snapshot.fromCache),n.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:s++}})}{let s=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{let u=new da(n._firestore,n._userDataWriter,l.doc.key,l.doc,new ts(n._snapshot.mutatedKeys.has(l.doc.key),n._snapshot.fromCache),n.query.converter),c=-1,g=-1;return l.type!==0&&(c=s.indexOf(l.doc.key),s=s.delete(l.doc.key)),l.type!==1&&(g=(s=s.add(l.doc)).indexOf(l.doc.key)),{type:function(v){switch(v){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K()}}(l.type),doc:u,oldIndex:c,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Gd(r){r=Yn(r,fn);let e=Yn(r.firestore,wi);return function(t,n,i={}){let s=new Rt;return t.asyncQueue.enqueueAndForget(async()=>function(l,u,c,g,v){let k=new Fu({next:O=>{u.enqueueAndForget(()=>Au(l,N));let Q=O.docs.has(c);!Q&&O.fromCache?v.reject(new ee(M.UNAVAILABLE,"Failed to get document because the client is offline.")):Q&&O.fromCache&&g&&g.source==="server"?v.reject(new ee(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):v.resolve(O)},error:O=>v.reject(O)}),N=new Nu(xr(c.path),k,{includeMetadataChanges:!0,oa:!0});return ku(l,N)}(await qu(t),t.asyncQueue,n,i,s)),s.promise}(So(e),r._key).then(t=>function(n,i,s){let l=s.docs.get(i._key),u=new gh(n);return new mh(n,u,i._key,l,new ts(s.hasPendingWrites,s.fromCache),i.converter)}(e,r,t))}class gh extends $d{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fn(this.firestore,null,t)}}function Hd(r){r=Yn(r,Kn);let e=Yn(r.firestore,wi),t=So(e),n=new gh(e);return function(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new ee(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(r._query),function(i,s,l={}){let u=new Rt;return i.asyncQueue.enqueueAndForget(async()=>function(c,g,v,k,N){let O=new Nu(v,new Fu({next:Q=>{g.enqueueAndForget(()=>Au(c,O)),Q.fromCache&&k.source==="server"?N.reject(new ee(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):N.resolve(Q)},error:Q=>N.reject(Q)}),{includeMetadataChanges:!0,oa:!0});return ku(c,O)}(await qu(i),i.asyncQueue,s,l,u)),u.promise}(t,r._query).then(i=>new Kd(e,n,r,i))}function Wd(r,e,t,...n){r=Yn(r,fn);let i=Yn(r.firestore,wi),s=la(i);return Po(i,[(typeof(e=(0,Fe.m9)(e))=="string"||e instanceof aa?function(l,u,c,g,v,k){let N=l.Ou(1,u,c),O=[Ao(u,g,c)],Q=[v];if(k.length%2!=0)throw new ee(M.INVALID_ARGUMENT,`Function ${u}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _e=0;_e<k.length;_e+=2)O.push(Ao(u,k[_e])),Q.push(k[_e+1]);let se=[],ae=Mt.empty();for(let _e=O.length-1;_e>=0;--_e)if(!ah(se,O[_e])){let ge=O[_e],A=Q[_e];A=(0,Fe.m9)(A);let I=N.Cu(ge);if(A instanceof ua)se.push(ge);else{let _=Br(A,I);_!=null&&(se.push(ge),ae.set(ge,_))}}return new Ju(ae,new jt(se),N.fieldTransforms)}(s,"updateDoc",r._key,e,t,n):function(l,u,c,g){let v=l.Ou(1,u,c);ko("Data must be an object, but it was:",v,g);let k=[],N=Mt.empty();return En(g,(O,Q)=>{let se=No(u,O,c);Q=(0,Fe.m9)(Q);let ae=v.Cu(se);if(Q instanceof ua)k.push(se);else{let _e=Br(Q,ae);_e!=null&&(k.push(se),N.set(se,_e))}}),new Ju(N,new jt(k),v.fieldTransforms)}(s,"updateDoc",r._key,e)).toMutation(r._key,tn.exists(!0))])}function Qd(r){return Po(Yn(r.firestore,wi),[new Ps(r._key,tn.none())])}function Jd(r,e){var t,n,i;let s=Yn(r.firestore,wi),l=Wu(r),u=(t=r.converter,n=e,t?t.toFirestore(n):n);return Po(s,[function(c,g,v,k,N,O={}){let Q,se,ae=c.Ou(O.merge||O.mergeFields?2:0,g,v,N);ko("Data must be an object, but it was:",ae,k);let _e=ih(k,ae);if(O.merge)Q=new jt(ae.fieldMask),se=ae.fieldTransforms;else if(O.mergeFields){let ge=[];for(let A of O.mergeFields){let I=Ao(g,A,v);if(!ae.contains(I))throw new ee(M.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);ah(ge,I)||ge.push(I)}Q=new jt(ge),se=ae.fieldTransforms.filter(A=>Q.covers(A.field))}else Q=null,se=ae.fieldTransforms;return new Fd(new Mt(_e),Q,se)}(la(r.firestore),"addDoc",l._key,u,r.converter!==null,{}).toMutation(l._key,tn.exists(!1))]).then(()=>l)}function Po(r,e){return function(t,n){let i=new Rt;return t.asyncQueue.enqueueAndForget(async()=>Td(await Bu(t).then(s=>s.syncEngine),n,i)),i.promise}(So(r),e)}(function(r=!0){yt=Je.Jn,(0,Je.Xd)(new pn.wA("firestore",(e,{instanceIdentifier:t,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new wi(new me(e.getProvider("auth-internal")),new vt(e.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new ee(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yn(l.options.projectId,u)}(i,t),i);return n=Object.assign({useFetchStreams:r},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,Je.KN)(ot,"4.6.5",void 0),(0,Je.KN)(ot,"4.6.5","esm2017")})()},Gn.__chunk_5283=(tr,qt,De)=>{De.d(qt,{hJ:()=>xn,v0:()=>ni});var re=De(2338),fe=De(1511),He=De(3369);function it(p,a){var h={};for(var f in p)Object.prototype.hasOwnProperty.call(p,f)&&0>a.indexOf(f)&&(h[f]=p[f]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,f=Object.getOwnPropertySymbols(p);y<f.length;y++)0>a.indexOf(f[y])&&Object.prototype.propertyIsEnumerable.call(p,f[y])&&(h[f[y]]=p[f[y]]);return h}typeof SuppressedError=="function"&&SuppressedError;var St=De(9122);function ze(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let ie=new fe.LL("auth","Firebase",ze()),ne=new He.Yd("@firebase/auth");function he(p,...a){ne.logLevel<=He.in.ERROR&&ne.error(`Auth (${re.Jn}): ${p}`,...a)}function Ce(p,...a){throw ft(p,...a)}function Oe(p,...a){return ft(p,...a)}function Re(p,a,h){let f=Object.assign(Object.assign({},ze()),{[a]:h});return new fe.LL("auth","Firebase",f).create(a,{appName:p.name})}function Ee(p){return Re(p,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ft(p,...a){if(typeof p!="string"){let h=a[0],f=[...a.slice(1)];return f[0]&&(f[0].appName=p.name),p._errorFactory.create(h,...f)}return ie.create(p,...a)}function ue(p,a,...h){if(!p)throw ft(a,...h)}function Je(p){let a="INTERNAL ASSERTION FAILED: "+p;throw he(a),Error(a)}function pn(){var p;return typeof Ge<"u"&&((p=Ge.location)===null||p===void 0?void 0:p.href)||""}function pt(){var p;return typeof Ge<"u"&&((p=Ge.location)===null||p===void 0?void 0:p.protocol)||null}class Fe{constructor(a,h){var f;this.shortDelay=a,this.longDelay=h,f="Short delay should be less than long delay!",h>a||Je(f),this.isMobile=(0,fe.uI)()||(0,fe.b$)()}get(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pt()==="http:"||pt()==="https:"||(0,fe.ru)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function mn(p,a){var h,f;h=p.emulator,f="Emulator should always be set here",h||Je(f);let{url:y}=p.emulator;return a?`${y}${a.startsWith("/")?a.slice(1):a}`:y}class zt{static initialize(a,h,f){this.fetchImpl=a,h&&(this.headersImpl=h),f&&(this.responseImpl=f)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof Ge<"u"&&"fetch"in Ge?Ge.fetch:typeof Xt<"u"&&Xt.fetch?Xt.fetch:typeof fetch<"u"?fetch:void Je("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof Ge<"u"&&"Headers"in Ge?Ge.Headers:typeof Xt<"u"&&Xt.Headers?Xt.Headers:typeof Headers<"u"?Headers:void Je("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof Ge<"u"&&"Response"in Ge?Ge.Response:typeof Xt<"u"&&Xt.Response?Xt.Response:typeof Response<"u"?Response:void Je("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let an={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},gt=new Fe(3e4,6e4);function We(p,a){return p.tenantId&&!a.tenantId?Object.assign(Object.assign({},a),{tenantId:p.tenantId}):a}async function ot(p,a,h,f,y={}){return xe(p,y,async()=>{let b={},x={};f&&(a==="GET"?x=f:b={body:JSON.stringify(f)});let G=(0,fe.xO)(Object.assign({key:p.config.apiKey},x)).slice(1),j=await p._getAdditionalHeaders();return j["Content-Type"]="application/json",p.languageCode&&(j["X-Firebase-Locale"]=p.languageCode),zt.fetch()(xt(p,p.config.apiHost,h,G),Object.assign({method:a,headers:j,referrerPolicy:"no-referrer"},b))})}async function xe(p,a,h){p._canInitEmulator=!1;let f=Object.assign(Object.assign({},an),a);try{let y=new $t(p),b=await Promise.race([h(),y.promise]);y.clearNetworkTimeout();let x=await b.json();if("needConfirmation"in x)throw H(p,"account-exists-with-different-credential",x);if(b.ok&&!("errorMessage"in x))return x;{let[G,j]=(b.ok?x.errorMessage:x.error.message).split(" : ");if(G==="FEDERATED_USER_ID_ALREADY_LINKED")throw H(p,"credential-already-in-use",x);if(G==="EMAIL_EXISTS")throw H(p,"email-already-in-use",x);if(G==="USER_DISABLED")throw H(p,"user-disabled",x);let le=f[G]||G.toLowerCase().replace(/[_\s]+/g,"-");if(j)throw Re(p,le,j);Ce(p,le)}}catch(y){if(y instanceof fe.ZR)throw y;Ce(p,"network-request-failed",{message:String(y)})}}async function yt(p,a,h,f,y={}){let b=await ot(p,a,h,f,y);return"mfaPendingCredential"in b&&Ce(p,"multi-factor-auth-required",{_serverResponse:b}),b}function xt(p,a,h,f){let y=`${a}${h}?${f}`;return p.config.emulator?mn(p.config,y):`${p.config.apiScheme}://${y}`}class $t{constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((h,f)=>{this.timer=setTimeout(()=>f(Oe(this.auth,"network-request-failed")),gt.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function H(p,a,h){let f={appName:p.name};h.email&&(f.email=h.email),h.phoneNumber&&(f.phoneNumber=h.phoneNumber);let y=Oe(p,a,f);return y.customData._tokenResponse=h,y}function Ve(p){return p!==void 0&&p.enterprise!==void 0}class Yt{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],a.recaptchaKey===void 0)throw Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let h of this.recaptchaEnforcementState)if(h.provider&&h.provider===a)return function(f){switch(f){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}(h.enforcementState);return null}isProviderEnabled(a){return this.getProviderEnforcementState(a)==="ENFORCE"||this.getProviderEnforcementState(a)==="AUDIT"}}async function Dt(p,a){return ot(p,"GET","/v2/recaptchaConfig",We(p,a))}async function K(p,a){return ot(p,"POST","/v1/accounts:delete",a)}async function M(p,a){return ot(p,"POST","/v1/accounts:lookup",a)}function ee(p){if(p)try{let a=new Date(Number(p));if(!isNaN(a.getTime()))return a.toUTCString()}catch{}}async function Rt(p,a=!1){let h=(0,fe.m9)(p),f=await h.getIdToken(a),y=q(f);ue(y&&y.exp&&y.auth_time&&y.iat,h.auth,"internal-error");let b=typeof y.firebase=="object"?y.firebase:void 0,x=b?.sign_in_provider;return{claims:y,token:f,authTime:ee(V(y.auth_time)),issuedAtTime:ee(V(y.iat)),expirationTime:ee(V(y.exp)),signInProvider:x||null,signInSecondFactor:b?.sign_in_second_factor||null}}function V(p){return 1e3*Number(p)}function q(p){let[a,h,f]=p.split(".");if(a===void 0||h===void 0||f===void 0)return he("JWT malformed, contained fewer than 3 sections"),null;try{let y=(0,fe.tV)(h);return y?JSON.parse(y):(he("Failed to decode base64 JWT payload"),null)}catch(y){return he("Caught error parsing JWT payload as JSON",y?.toString()),null}}function Y(p){let a=q(p);return ue(a,"internal-error"),ue(a.exp!==void 0,"internal-error"),ue(a.iat!==void 0,"internal-error"),Number(a.exp)-Number(a.iat)}async function me(p,a,h=!1){if(h)return a;try{return await a}catch(f){throw f instanceof fe.ZR&&function({code:y}){return y==="auth/user-disabled"||y==="auth/user-token-expired"}(f)&&p.auth.currentUser===p&&await p.auth.signOut(),f}}class ce{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(a){var h;if(!a)return this.errorBackoff=3e4,Math.max(0,((h=this.user.stsTokenManager.expirationTime)!==null&&h!==void 0?h:0)-Date.now()-3e5);{let f=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),f}}schedule(a=!1){if(!this.isRunning)return;let h=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},h)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Pe{constructor(a,h){this.createdAt=a,this.lastLoginAt=h,this._initializeTime()}_initializeTime(){this.lastSignInTime=ee(this.lastLoginAt),this.creationTime=ee(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Qe(p){var a;let h=p.auth,f=await p.getIdToken(),y=await me(p,M(h,{idToken:f}));ue(y?.users.length,h,"internal-error");let b=y.users[0];p._notifyReloadListener(b);let x=!((a=b.providerUserInfo)===null||a===void 0)&&a.length?wt(b.providerUserInfo):[],G=[...p.providerData.filter(Te=>!x.some(Ne=>Ne.providerId===Te.providerId)),...x],j=p.isAnonymous,le=!(p.email&&b.passwordHash)&&!G?.length;Object.assign(p,{uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:G,metadata:new Pe(b.createdAt,b.lastLoginAt),isAnonymous:!!j&&le})}async function vt(p){let a=(0,fe.m9)(p);await Qe(a),await a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)}function wt(p){return p.map(a=>{var{providerId:h}=a,f=it(a,["providerId"]);return{providerId:h,uid:f.rawId||"",displayName:f.displayName||null,email:f.email||null,phoneNumber:f.phoneNumber||null,photoURL:f.photoUrl||null}})}async function ve(p,a){let h=await xe(p,{},async()=>{let f=(0,fe.xO)({grant_type:"refresh_token",refresh_token:a}).slice(1),{tokenApiHost:y,apiKey:b}=p.config,x=xt(p,y,"/v1/token",`key=${b}`),G=await p._getAdditionalHeaders();return G["Content-Type"]="application/x-www-form-urlencoded",zt.fetch()(x,{method:"POST",headers:G,body:f})});return{accessToken:h.access_token,expiresIn:h.expires_in,refreshToken:h.refresh_token}}async function bt(p,a){return ot(p,"POST","/v2/accounts:revokeToken",We(p,a))}class W{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){ue(a.idToken,"internal-error"),ue(a.idToken!==void 0,"internal-error"),ue(a.refreshToken!==void 0,"internal-error");let h="expiresIn"in a&&a.expiresIn!==void 0?Number(a.expiresIn):Y(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,h)}updateFromIdToken(a){ue(a.length!==0,"internal-error");let h=Y(a);this.updateTokensAndExpiration(a,null,h)}async getToken(a,h=!1){return h||!this.accessToken||this.isExpired?(ue(this.refreshToken,a,"user-token-expired"),this.refreshToken?(await this.refresh(a,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(a,h){let{accessToken:f,refreshToken:y,expiresIn:b}=await ve(a,h);this.updateTokensAndExpiration(f,y,Number(b))}updateTokensAndExpiration(a,h,f){this.refreshToken=h||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*f}static fromJSON(a,h){let{refreshToken:f,accessToken:y,expirationTime:b}=h,x=new W;return f&&(ue(typeof f=="string","internal-error",{appName:a}),x.refreshToken=f),y&&(ue(typeof y=="string","internal-error",{appName:a}),x.accessToken=y),b&&(ue(typeof b=="number","internal-error",{appName:a}),x.expirationTime=b),x}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new W,this.toJSON())}_performRefresh(){return Je("not implemented")}}function R(p,a){ue(typeof p=="string"||p===void 0,"internal-error",{appName:a})}class Z{constructor(a){var{uid:h,auth:f,stsTokenManager:y}=a,b=it(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ce(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=h,this.auth=f,this.stsTokenManager=y,this.accessToken=y.accessToken,this.displayName=b.displayName||null,this.email=b.email||null,this.emailVerified=b.emailVerified||!1,this.phoneNumber=b.phoneNumber||null,this.photoURL=b.photoURL||null,this.isAnonymous=b.isAnonymous||!1,this.tenantId=b.tenantId||null,this.providerData=b.providerData?[...b.providerData]:[],this.metadata=new Pe(b.createdAt||void 0,b.lastLoginAt||void 0)}async getIdToken(a){let h=await me(this,this.stsTokenManager.getToken(this.auth,a));return ue(h,this.auth,"internal-error"),this.accessToken!==h&&(this.accessToken=h,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),h}getIdTokenResult(a){return Rt(this,a)}reload(){return vt(this)}_assign(a){this!==a&&(ue(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(h=>Object.assign({},h)),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){let h=new Z(Object.assign(Object.assign({},this),{auth:a,stsTokenManager:this.stsTokenManager._clone()}));return h.metadata._copy(this.metadata),h}_onReload(a){ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,h=!1){let f=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),f=!0),h&&await Qe(this),await this.auth._persistUserIfCurrent(this),f&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,re.rh)(this.auth.app))return Promise.reject(Ee(this.auth));let a=await this.getIdToken();return await me(this,K(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>Object.assign({},a)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,h){var f,y,b,x,G,j,le,Te;let Ne=(f=h.displayName)!==null&&f!==void 0?f:void 0,un=(y=h.email)!==null&&y!==void 0?y:void 0,Mn=(b=h.phoneNumber)!==null&&b!==void 0?b:void 0,ke=(x=h.photoURL)!==null&&x!==void 0?x:void 0,hn=(G=h.tenantId)!==null&&G!==void 0?G:void 0,Ut=(j=h._redirectEventId)!==null&&j!==void 0?j:void 0,_t=(le=h.createdAt)!==null&&le!==void 0?le:void 0,wn=(Te=h.lastLoginAt)!==null&&Te!==void 0?Te:void 0,{uid:In,emailVerified:cn,isAnonymous:Ft,providerData:Lt,stsTokenManager:Un}=h;ue(In&&Un,a,"internal-error");let An=W.fromJSON(this.name,Un);ue(typeof In=="string",a,"internal-error"),R(Ne,a.name),R(un,a.name),ue(typeof cn=="boolean",a,"internal-error"),ue(typeof Ft=="boolean",a,"internal-error"),R(Mn,a.name),R(ke,a.name),R(hn,a.name),R(Ut,a.name),R(_t,a.name),R(wn,a.name);let ri=new Z({uid:In,auth:a,email:un,emailVerified:cn,displayName:Ne,isAnonymous:Ft,photoURL:ke,phoneNumber:Mn,tenantId:hn,stsTokenManager:An,createdAt:_t,lastLoginAt:wn});return Lt&&Array.isArray(Lt)&&(ri.providerData=Lt.map(cr=>Object.assign({},cr))),Ut&&(ri._redirectEventId=Ut),ri}static async _fromIdTokenResponse(a,h,f=!1){let y=new W;y.updateFromServerResponse(h);let b=new Z({uid:h.localId,auth:a,stsTokenManager:y,isAnonymous:f});return await Qe(b),b}static async _fromGetAccountInfoResponse(a,h,f){let y=h.users[0];ue(y.localId!==void 0,"internal-error");let b=y.providerUserInfo!==void 0?wt(y.providerUserInfo):[],x=!(y.email&&y.passwordHash)&&!b?.length,G=new W;G.updateFromIdToken(f);let j=new Z({uid:y.localId,auth:a,stsTokenManager:G,isAnonymous:x});return Object.assign(j,{uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:b,metadata:new Pe(y.createdAt,y.lastLoginAt),isAnonymous:!(y.email&&y.passwordHash)&&!b?.length}),j}}let te=new Map;function Se(p){var a,h;a="Expected a class definition",p instanceof Function||Je(a);let f=te.get(p);return f?(h="Instance stored in cache mismatched with class",f instanceof p||Je(h)):(f=new p,te.set(p,f)),f}class we{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,h){this.storage[a]=h}async _get(a){let h=this.storage[a];return h===void 0?null:h}async _remove(a){delete this.storage[a]}_addListener(a,h){}_removeListener(a,h){}}function J(p,a,h){return`firebase:${p}:${a}:${h}`}we.type="NONE";class je{constructor(a,h,f){this.persistence=a,this.auth=h,this.userKey=f;let{config:y,name:b}=this.auth;this.fullUserKey=J(this.userKey,y.apiKey,b),this.fullPersistenceKey=J("persistence",y.apiKey,b),this.boundEventHandler=h._onStorageEvent.bind(h),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){let a=await this.persistence._get(this.fullUserKey);return a?Z._fromJSON(this.auth,a):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;let h=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,h)return this.setCurrentUser(h)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,h,f="authUser"){if(!h.length)return new je(Se(we),a,f);let y=(await Promise.all(h.map(async le=>{if(await le._isAvailable())return le}))).filter(le=>le),b=y[0]||Se(we),x=J(f,a.config.apiKey,a.name),G=null;for(let le of h)try{let Te=await le._get(x);if(Te){let Ne=Z._fromJSON(a,Te);le!==b&&(G=Ne),b=le;break}}catch{}let j=y.filter(le=>le._shouldAllowMigration);return b._shouldAllowMigration&&j.length&&(b=j[0],G&&await b._set(x,G.toJSON()),await Promise.all(h.map(async le=>{if(le!==b)try{await le._remove(x)}catch{}}))),new je(b,a,f)}}function Be(p){let a=p.toLowerCase();if(a.includes("opera/")||a.includes("opr/")||a.includes("opios/"))return"Opera";if(U(a))return"IEMobile";if(a.includes("msie")||a.includes("trident/"))return"IE";{if(a.includes("edge/"))return"Edge";if(P(a))return"Firefox";if(a.includes("silk/"))return"Silk";if(de(a))return"Blackberry";if(Ie(a))return"Webos";if(S(a))return"Safari";if((a.includes("chrome/")||$(a))&&!a.includes("edge/"))return"Chrome";if(X(a))return"Android";let h=p.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(h?.length===2)return h[1]}return"Other"}function P(p=(0,fe.z$)()){return/firefox\//i.test(p)}function S(p=(0,fe.z$)()){let a=p.toLowerCase();return a.includes("safari/")&&!a.includes("chrome/")&&!a.includes("crios/")&&!a.includes("android")}function $(p=(0,fe.z$)()){return/crios\//i.test(p)}function U(p=(0,fe.z$)()){return/iemobile/i.test(p)}function X(p=(0,fe.z$)()){return/android/i.test(p)}function de(p=(0,fe.z$)()){return/blackberry/i.test(p)}function Ie(p=(0,fe.z$)()){return/webos/i.test(p)}function pe(p=(0,fe.z$)()){return/iphone|ipad|ipod/i.test(p)||/macintosh/i.test(p)&&/mobile/i.test(p)}function Ae(p=(0,fe.z$)()){return pe(p)||X(p)||Ie(p)||de(p)||/windows phone/i.test(p)||U(p)}function be(p,a=[]){let h;switch(p){case"Browser":h=Be((0,fe.z$)());break;case"Worker":h=`${Be((0,fe.z$)())}-${p}`;break;default:h=p}let f=a.length?a.join(","):"FirebaseCore-web";return`${h}/JsCore/${re.Jn}/${f}`}class T{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,h){let f=b=>new Promise((x,G)=>{try{let j=a(b);x(j)}catch(j){G(j)}});f.onAbort=h,this.queue.push(f);let y=this.queue.length-1;return()=>{this.queue[y]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;let h=[];try{for(let f of this.queue)await f(a),f.onAbort&&h.push(f.onAbort)}catch(f){for(let y of(h.reverse(),h))try{y()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:f?.message})}}}async function st(p,a={}){return ot(p,"GET","/v2/passwordPolicy",We(p,a))}class Le{constructor(a){var h,f,y,b;let x=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(h=x.minPasswordLength)!==null&&h!==void 0?h:6,x.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=x.maxPasswordLength),x.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=x.containsLowercaseCharacter),x.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=x.containsUppercaseCharacter),x.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=x.containsNumericCharacter),x.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=x.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(y=(f=a.allowedNonAlphanumericCharacters)===null||f===void 0?void 0:f.join(""))!==null&&y!==void 0?y:"",this.forceUpgradeOnSignin=(b=a.forceUpgradeOnSignin)!==null&&b!==void 0&&b,this.schemaVersion=a.schemaVersion}validatePassword(a){var h,f,y,b,x,G;let j={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,j),this.validatePasswordCharacterOptions(a,j),j.isValid&&(j.isValid=(h=j.meetsMinPasswordLength)===null||h===void 0||h),j.isValid&&(j.isValid=(f=j.meetsMaxPasswordLength)===null||f===void 0||f),j.isValid&&(j.isValid=(y=j.containsLowercaseLetter)===null||y===void 0||y),j.isValid&&(j.isValid=(b=j.containsUppercaseLetter)===null||b===void 0||b),j.isValid&&(j.isValid=(x=j.containsNumericCharacter)===null||x===void 0||x),j.isValid&&(j.isValid=(G=j.containsNonAlphanumericCharacter)===null||G===void 0||G),j}validatePasswordLengthOptions(a,h){let f=this.customStrengthOptions.minPasswordLength,y=this.customStrengthOptions.maxPasswordLength;f&&(h.meetsMinPasswordLength=a.length>=f),y&&(h.meetsMaxPasswordLength=a.length<=y)}validatePasswordCharacterOptions(a,h){let f;this.updatePasswordCharacterOptionsStatuses(h,!1,!1,!1,!1);for(let y=0;y<a.length;y++)f=a.charAt(y),this.updatePasswordCharacterOptionsStatuses(h,f>="a"&&f<="z",f>="A"&&f<="Z",f>="0"&&f<="9",this.allowedNonAlphanumericCharacters.includes(f))}updatePasswordCharacterOptionsStatuses(a,h,f,y,b){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=h)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=f)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=y)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=b))}}class ht{constructor(a,h,f,y){this.app=a,this.heartbeatServiceProvider=h,this.appCheckServiceProvider=f,this.config=y,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ot(this),this.idTokenSubscription=new Ot(this),this.beforeStateQueue=new T(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=y.sdkClientVersion}_initializeWithPersistence(a,h){return h&&(this._popupRedirectResolver=Se(h)),this._initializationPromise=this.queue(async()=>{var f,y;if(!this._deleted&&(this.persistenceManager=await je.create(this,a),!this._deleted)){if(!((f=this._popupRedirectResolver)===null||f===void 0)&&f._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(h),this.lastNotifiedUid=((y=this.currentUser)===null||y===void 0?void 0:y.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let a=await this.assertedPersistence.getCurrentUser();if(this.currentUser||a){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{let h=await M(this,{idToken:a}),f=await Z._fromGetAccountInfoResponse(this,h,a);await this.directlySetCurrentUser(f)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){var h;if((0,re.rh)(this.app)){let x=this.app.settings.authIdToken;return x?new Promise(G=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(x).then(G,G))}):this.directlySetCurrentUser(null)}let f=await this.assertedPersistence.getCurrentUser(),y=f,b=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let x=(h=this.redirectUser)===null||h===void 0?void 0:h._redirectEventId,G=y?._redirectEventId,j=await this.tryRedirectSignIn(a);(!x||x===G)&&j?.user&&(y=j.user,b=!0)}if(!y)return this.directlySetCurrentUser(null);if(!y._redirectEventId){if(b)try{await this.beforeStateQueue.runMiddleware(y)}catch(x){y=f,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(x))}return y?this.reloadAndSetCurrentUserOrClear(y):this.directlySetCurrentUser(null)}return ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===y._redirectEventId?this.directlySetCurrentUser(y):this.reloadAndSetCurrentUserOrClear(y)}async tryRedirectSignIn(a){let h=null;try{h=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch{await this._setRedirectUser(null)}return h}async reloadAndSetCurrentUserOrClear(a){try{await Qe(a)}catch(h){if(h?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=function(){if(typeof navigator>"u")return null;let a=navigator;return a.languages&&a.languages[0]||a.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if((0,re.rh)(this.app))return Promise.reject(Ee(this));let h=a?(0,fe.m9)(a):null;return h&&ue(h.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(h&&h._clone(this))}async _updateCurrentUser(a,h=!1){if(!this._deleted)return a&&ue(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),h||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return(0,re.rh)(this.app)?Promise.reject(Ee(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return(0,re.rh)(this.app)?Promise.reject(Ee(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Se(a))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let h=this._getPasswordPolicyInternal();return h.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(a)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let a=new Le(await st(this));this.tenantId===null?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(a){this._errorFactory=new fe.LL("auth","Firebase",a())}onAuthStateChanged(a,h,f){return this.registerStateListener(this.authStateSubscription,a,h,f)}beforeAuthStateChanged(a,h){return this.beforeStateQueue.pushCallback(a,h)}onIdTokenChanged(a,h,f){return this.registerStateListener(this.idTokenSubscription,a,h,f)}authStateReady(){return new Promise((a,h)=>{if(this.currentUser)a();else{let f=this.onAuthStateChanged(()=>{f(),a()},h)}})}async revokeAccessToken(a){if(this.currentUser){let h={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:await this.currentUser.getIdToken()};this.tenantId!=null&&(h.tenantId=this.tenantId),await bt(this,h)}}toJSON(){var a;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(a=this._currentUser)===null||a===void 0?void 0:a.toJSON()}}async _setRedirectUser(a,h){let f=await this.getOrInitRedirectPersistenceManager(h);return a===null?f.removeCurrentUser():f.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){let h=a&&Se(a)||this._popupRedirectResolver;ue(h,this,"argument-error"),this.redirectPersistenceManager=await je.create(this,[Se(h._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){var h,f;return this._isInitialized&&await this.queue(async()=>{}),((h=this._currentUser)===null||h===void 0?void 0:h._redirectEventId)===a?this._currentUser:((f=this.redirectUser)===null||f===void 0?void 0:f._redirectEventId)===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var a,h;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let f=(h=(a=this.currentUser)===null||a===void 0?void 0:a.uid)!==null&&h!==void 0?h:null;this.lastNotifiedUid!==f&&(this.lastNotifiedUid=f,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,h,f,y){if(this._deleted)return()=>{};let b=typeof h=="function"?h:h.next.bind(h),x=!1,G=this._isInitialized?Promise.resolve():this._initializationPromise;if(ue(G,this,"internal-error"),G.then(()=>{x||b(this.currentUser)}),typeof h=="function"){let j=a.addObserver(h,f,y);return()=>{x=!0,j()}}{let j=a.addObserver(h);return()=>{x=!0,j()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=be(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var a;let h={"X-Client-Version":this.clientVersion};this.app.options.appId&&(h["X-Firebase-gmpid"]=this.app.options.appId);let f=await((a=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||a===void 0?void 0:a.getHeartbeatsHeader());f&&(h["X-Firebase-Client"]=f);let y=await this._getAppCheckToken();return y&&(h["X-Firebase-AppCheck"]=y),h}async _getAppCheckToken(){var a;let h=await((a=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||a===void 0?void 0:a.getToken());return h?.error&&function(f,...y){ne.logLevel<=He.in.WARN&&ne.warn(`Auth (${re.Jn}): ${f}`,...y)}(`Error while retrieving App Check token: ${h.error}`),h?.token}}function It(p){return(0,fe.m9)(p)}class Ot{constructor(a){this.auth=a,this.observer=null,this.addObserver=(0,fe.ne)(h=>this.observer=h)}get next(){return ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Xe={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ct(p){return`__${p}${Math.floor(1e6*Math.random())}`}class Zt{constructor(a){this.type="recaptcha-enterprise",this.auth=It(a)}async verify(a="verify",h=!1){async function f(b){if(!h){if(b.tenantId==null&&b._agentRecaptchaConfig!=null)return b._agentRecaptchaConfig.siteKey;if(b.tenantId!=null&&b._tenantRecaptchaConfigs[b.tenantId]!==void 0)return b._tenantRecaptchaConfigs[b.tenantId].siteKey}return new Promise(async(x,G)=>{Dt(b,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(j=>{if(j.recaptchaKey===void 0)G(Error("recaptcha Enterprise site key undefined"));else{let le=new Yt(j);return b.tenantId==null?b._agentRecaptchaConfig=le:b._tenantRecaptchaConfigs[b.tenantId]=le,x(le.siteKey)}}).catch(j=>{G(j)})})}function y(b,x,G){let j=window.grecaptcha;Ve(j)?j.enterprise.ready(()=>{j.enterprise.execute(b,{action:a}).then(le=>{x(le)}).catch(()=>{x("NO_RECAPTCHA")})}):G(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((b,x)=>{f(this.auth).then(G=>{if(!h&&Ve(window.grecaptcha))y(G,b,x);else{var j;if(typeof window>"u"){x(Error("RecaptchaVerifier is only supported in browser"));return}let le=Xe.recaptchaEnterpriseScript;le.length!==0&&(le+=G),(j=le,Xe.loadJS(j)).then(()=>{y(G,b,x)}).catch(Te=>{x(Te)})}}).catch(G=>{x(G)})})}}async function on(p,a,h,f=!1){let y,b=new Zt(p);try{y=await b.verify(h)}catch{y=await b.verify(h,!0)}let x=Object.assign({},a);return f?Object.assign(x,{captchaResp:y}):Object.assign(x,{captchaResponse:y}),Object.assign(x,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(x,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),x}async function nr(p,a,h,f){var y;if((y=p._getRecaptchaConfig())===null||y===void 0||!y.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return f(p,a).catch(async b=>{if(b.code!=="auth/missing-recaptcha-token")return Promise.reject(b);{console.log(`${h} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let x=await on(p,a,h,h==="getOobCode");return f(p,x)}});{let b=await on(p,a,h,h==="getOobCode");return f(p,b)}}function Kr(p){let a=p.indexOf(":");return a<0?"":p.substr(0,a+1)}function Gr(p){if(!p)return null;let a=Number(p);return isNaN(a)?null:a}class ct{constructor(a,h){this.providerId=a,this.signInMethod=h}toJSON(){return Je("not implemented")}_getIdTokenResponse(a){return Je("not implemented")}_linkToIdToken(a,h){return Je("not implemented")}_getReauthenticationResolver(a){return Je("not implemented")}}async function Fn(p,a){return ot(p,"POST","/v1/accounts:signUp",a)}async function Pt(p,a){return yt(p,"POST","/v1/accounts:signInWithPassword",We(p,a))}async function bn(p,a){return yt(p,"POST","/v1/accounts:signInWithEmailLink",We(p,a))}async function nt(p,a){return yt(p,"POST","/v1/accounts:signInWithEmailLink",We(p,a))}class kt extends ct{constructor(a,h,f,y=null){super("password",f),this._email=a,this._password=h,this._tenantId=y}static _fromEmailAndPassword(a,h){return new kt(a,h,"password")}static _fromEmailAndCode(a,h,f=null){return new kt(a,h,"emailLink",f)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){let h=typeof a=="string"?JSON.parse(a):a;if(h?.email&&h?.password){if(h.signInMethod==="password")return this._fromEmailAndPassword(h.email,h.password);if(h.signInMethod==="emailLink")return this._fromEmailAndCode(h.email,h.password,h.tenantId)}return null}async _getIdTokenResponse(a){switch(this.signInMethod){case"password":return nr(a,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Pt);case"emailLink":return bn(a,{email:this._email,oobCode:this._password});default:Ce(a,"internal-error")}}async _linkToIdToken(a,h){switch(this.signInMethod){case"password":return nr(a,{idToken:h,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Fn);case"emailLink":return nt(a,{idToken:h,email:this._email,oobCode:this._password});default:Ce(a,"internal-error")}}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}async function gn(p,a){return yt(p,"POST","/v1/accounts:signInWithIdp",We(p,a))}class Hn extends ct{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){let h=new Hn(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(h.idToken=a.idToken),a.accessToken&&(h.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(h.nonce=a.nonce),a.pendingToken&&(h.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(h.accessToken=a.oauthToken,h.secret=a.oauthTokenSecret):Ce("argument-error"),h}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){let h=typeof a=="string"?JSON.parse(a):a,{providerId:f,signInMethod:y}=h,b=it(h,["providerId","signInMethod"]);if(!f||!y)return null;let x=new Hn(f,y);return x.idToken=b.idToken||void 0,x.accessToken=b.accessToken||void 0,x.secret=b.secret,x.nonce=b.nonce,x.pendingToken=b.pendingToken||null,x}_getIdTokenResponse(a){return gn(a,this.buildRequest())}_linkToIdToken(a,h){let f=this.buildRequest();return f.idToken=h,gn(a,f)}_getReauthenticationResolver(a){let h=this.buildRequest();return h.autoCreate=!1,gn(a,h)}buildRequest(){let a={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{let h={};this.idToken&&(h.id_token=this.idToken),this.accessToken&&(h.access_token=this.accessToken),this.secret&&(h.oauth_token_secret=this.secret),h.providerId=this.providerId,this.nonce&&!this.pendingToken&&(h.nonce=this.nonce),a.postBody=(0,fe.xO)(h)}return a}}async function Na(p,a){return ot(p,"POST","/v1/accounts:sendVerificationCode",We(p,a))}async function xa(p,a){return yt(p,"POST","/v1/accounts:signInWithPhoneNumber",We(p,a))}async function Da(p,a){let h=await yt(p,"POST","/v1/accounts:signInWithPhoneNumber",We(p,a));if(h.temporaryProof)throw H(p,"account-exists-with-different-credential",h);return h}let Ra={USER_NOT_FOUND:"user-not-found"};async function Oa(p,a){return yt(p,"POST","/v1/accounts:signInWithPhoneNumber",We(p,Object.assign(Object.assign({},a),{operation:"REAUTH"})),Ra)}class rr extends ct{constructor(a){super("phone","phone"),this.params=a}static _fromVerification(a,h){return new rr({verificationId:a,verificationCode:h})}static _fromTokenResponse(a,h){return new rr({phoneNumber:a,temporaryProof:h})}_getIdTokenResponse(a){return xa(a,this._makeVerificationRequest())}_linkToIdToken(a,h){return Da(a,Object.assign({idToken:h},this._makeVerificationRequest()))}_getReauthenticationResolver(a){return Oa(a,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:a,phoneNumber:h,verificationId:f,verificationCode:y}=this.params;return a&&h?{temporaryProof:a,phoneNumber:h}:{sessionInfo:f,code:y}}toJSON(){let a={providerId:this.providerId};return this.params.phoneNumber&&(a.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(a.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(a.verificationCode=this.params.verificationCode),this.params.verificationId&&(a.verificationId=this.params.verificationId),a}static fromJSON(a){typeof a=="string"&&(a=JSON.parse(a));let{verificationId:h,verificationCode:f,phoneNumber:y,temporaryProof:b}=a;return f||h||y||b?new rr({verificationId:h,verificationCode:f,phoneNumber:y,temporaryProof:b}):null}}class ki{constructor(a){var h,f,y,b,x,G;let j=(0,fe.zd)((0,fe.pd)(a)),le=(h=j.apiKey)!==null&&h!==void 0?h:null,Te=(f=j.oobCode)!==null&&f!==void 0?f:null,Ne=function(un){switch(un){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}((y=j.mode)!==null&&y!==void 0?y:null);ue(le&&Te&&Ne,"argument-error"),this.apiKey=le,this.operation=Ne,this.code=Te,this.continueUrl=(b=j.continueUrl)!==null&&b!==void 0?b:null,this.languageCode=(x=j.languageCode)!==null&&x!==void 0?x:null,this.tenantId=(G=j.tenantId)!==null&&G!==void 0?G:null}static parseLink(a){let h=function(f){let y=(0,fe.zd)((0,fe.pd)(f)).link,b=y?(0,fe.zd)((0,fe.pd)(y)).deep_link_id:null,x=(0,fe.zd)((0,fe.pd)(f)).deep_link_id;return(x?(0,fe.zd)((0,fe.pd)(x)).link:null)||x||b||y||f}(a);try{return new ki(h)}catch{return null}}}class Er{constructor(){this.providerId=Er.PROVIDER_ID}static credential(a,h){return kt._fromEmailAndPassword(a,h)}static credentialWithLink(a,h){let f=ki.parseLink(h);return ue(f,"argument-error"),kt._fromEmailAndCode(a,f.code,f.tenantId)}}Er.PROVIDER_ID="password",Er.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Er.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class _s{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class Tr extends _s{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class Vn extends Tr{constructor(){super("facebook.com")}static credential(a){return Hn._fromParams({providerId:Vn.PROVIDER_ID,signInMethod:Vn.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return Vn.credentialFromTaggedObject(a)}static credentialFromError(a){return Vn.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return Vn.credential(a.oauthAccessToken)}catch{return null}}}Vn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vn.PROVIDER_ID="facebook.com";class xn extends Tr{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Hn._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return xn.credentialFromTaggedObject(a)}static credentialFromError(a){return xn.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthIdToken:h,oauthAccessToken:f}=a;if(!h&&!f)return null;try{return xn.credential(h,f)}catch{return null}}}xn.GOOGLE_SIGN_IN_METHOD="google.com",xn.PROVIDER_ID="google.com";class Bn extends Tr{constructor(){super("github.com")}static credential(a){return Hn._fromParams({providerId:Bn.PROVIDER_ID,signInMethod:Bn.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return Bn.credentialFromTaggedObject(a)}static credentialFromError(a){return Bn.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return Bn.credential(a.oauthAccessToken)}catch{return null}}}Bn.GITHUB_SIGN_IN_METHOD="github.com",Bn.PROVIDER_ID="github.com";class qn extends Tr{constructor(){super("twitter.com")}static credential(a,h){return Hn._fromParams({providerId:qn.PROVIDER_ID,signInMethod:qn.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return qn.credentialFromTaggedObject(a)}static credentialFromError(a){return qn.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthAccessToken:h,oauthTokenSecret:f}=a;if(!h||!f)return null;try{return qn.credential(h,f)}catch{return null}}}qn.TWITTER_SIGN_IN_METHOD="twitter.com",qn.PROVIDER_ID="twitter.com";class Dn{constructor(a){this.user=a.user,this.providerId=a.providerId,this._tokenResponse=a._tokenResponse,this.operationType=a.operationType}static async _fromIdTokenResponse(a,h,f,y=!1){return new Dn({user:await Z._fromIdTokenResponse(a,f,y),providerId:bs(f),_tokenResponse:f,operationType:h})}static async _forOperation(a,h,f){return await a._updateTokensIfNecessary(f,!0),new Dn({user:a,providerId:bs(f),_tokenResponse:f,operationType:h})}}function bs(p){return p.providerId?p.providerId:"phoneNumber"in p?"phone":null}class ir extends fe.ZR{constructor(a,h,f,y){var b;super(h.code,h.message),this.operationType=f,this.user=y,Object.setPrototypeOf(this,ir.prototype),this.customData={appName:a.name,tenantId:(b=a.tenantId)!==null&&b!==void 0?b:void 0,_serverResponse:h.customData._serverResponse,operationType:f}}static _fromErrorAndOperation(a,h,f,y){return new ir(a,h,f,y)}}function Hr(p,a,h,f){return(a==="reauthenticate"?h._getReauthenticationResolver(p):h._getIdTokenResponse(p)).catch(y=>{throw y.code==="auth/multi-factor-auth-required"?ir._fromErrorAndOperation(p,y,a,f):y})}async function Pa(p,a,h=!1){let f=await me(p,a._linkToIdToken(p.auth,await p.getIdToken()),h);return Dn._forOperation(p,"link",f)}async function Ai(p,a,h=!1){let{auth:f}=p;if((0,re.rh)(f.app))return Promise.reject(Ee(f));let y="reauthenticate";try{let b=await me(p,Hr(f,y,a,p),h);ue(b.idToken,f,"internal-error");let x=q(b.idToken);ue(x,f,"internal-error");let{sub:G}=x;return ue(p.uid===G,f,"user-mismatch"),Dn._forOperation(p,y,b)}catch(b){throw b?.code==="auth/user-not-found"&&Ce(f,"user-mismatch"),b}}async function Et(p,a,h=!1){if((0,re.rh)(p.app))return Promise.reject(Ee(p));let f="signIn",y=await Hr(p,f,a),b=await Dn._fromIdTokenResponse(p,f,y);return h||await p._updateCurrentUser(b.user),b}class Sr{constructor(a,h){this.factorId=a,this.uid=h.mfaEnrollmentId,this.enrollmentTime=new Date(h.enrolledAt).toUTCString(),this.displayName=h.displayName}static _fromServerResponse(a,h){return"phoneInfo"in h?En._fromServerResponse(a,h):"totpInfo"in h?Wr._fromServerResponse(a,h):Ce(a,"internal-error")}}class En extends Sr{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,h){return new En(h)}}class Wr extends Sr{constructor(a){super("totp",a)}static _fromServerResponse(a,h){return new Wr(h)}}class at{constructor(a,h,f={}){this.isNewUser=a,this.providerId=h,this.profile=f}}class Tn{constructor(a,h,f){this.type=a,this.credential=h,this.user=f}static _fromIdtoken(a,h){return new Tn("enroll",a,h)}static _fromMfaPendingCredential(a){return new Tn("signin",a)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(a){var h,f;if(a?.multiFactorSession){if(!((h=a.multiFactorSession)===null||h===void 0)&&h.pendingCredential)return Tn._fromMfaPendingCredential(a.multiFactorSession.pendingCredential);if(!((f=a.multiFactorSession)===null||f===void 0)&&f.idToken)return Tn._fromIdtoken(a.multiFactorSession.idToken)}return null}}class At{constructor(a,h,f){this.session=a,this.hints=h,this.signInResolver=f}static _fromError(a,h){let f=It(a),y=h.customData._serverResponse,b=(y.mfaInfo||[]).map(G=>Sr._fromServerResponse(f,G));ue(y.mfaPendingCredential,f,"internal-error");let x=Tn._fromMfaPendingCredential(y.mfaPendingCredential);return new At(x,b,async G=>{let j=await G._process(f,x);delete y.mfaInfo,delete y.mfaPendingCredential;let le=Object.assign(Object.assign({},y),{idToken:j.idToken,refreshToken:j.refreshToken});switch(h.operationType){case"signIn":let Te=await Dn._fromIdTokenResponse(f,h.operationType,le);return await f._updateCurrentUser(Te.user),Te;case"reauthenticate":return ue(h.user,f,"internal-error"),Dn._forOperation(h.user,h.operationType,le);default:Ce(f,"internal-error")}})}async resolveSignIn(a){return this.signInResolver(a)}}class Ye{constructor(a){this.user=a,this.enrolledFactors=[],a._onReload(h=>{h.mfaInfo&&(this.enrolledFactors=h.mfaInfo.map(f=>Sr._fromServerResponse(a.auth,f)))})}static _fromUser(a){return new Ye(a)}async getSession(){return Tn._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(a,h){let f=await this.getSession(),y=await me(this.user,a._process(this.user.auth,f,h));return await this.user._updateTokensIfNecessary(y),this.user.reload()}async unenroll(a){let h=typeof a=="string"?a:a.uid,f=await this.user.getIdToken();try{var y,b;let x=await me(this.user,(y=this.user.auth,b={idToken:f,mfaEnrollmentId:h},ot(y,"POST","/v2/accounts/mfaEnrollment:withdraw",We(y,b))));this.enrolledFactors=this.enrolledFactors.filter(({uid:G})=>G!==h),await this.user._updateTokensIfNecessary(x),await this.user.reload()}catch(x){throw x}}}let Cr="__sak";class Wn{constructor(a,h){this.storageRetriever=a,this.type=h}_isAvailable(){try{return this.storage?(this.storage.setItem(Cr,"1"),this.storage.removeItem(Cr),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(a,h){return this.storage.setItem(a,JSON.stringify(h)),Promise.resolve()}_get(a){let h=this.storage.getItem(a);return Promise.resolve(h?JSON.parse(h):null)}_remove(a){return this.storage.removeItem(a),Promise.resolve()}get storage(){return this.storageRetriever()}}class jt extends Wn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let a=(0,fe.z$)();return S(a)||pe(a)}()&&function(){try{return!!(window&&window!==window.top)}catch{return!1}}(),this.fallbackToPolling=Ae(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(let h of Object.keys(this.listeners)){let f=this.storage.getItem(h),y=this.localCache[h];f!==y&&a(h,y,f)}}onStorageEvent(a,h=!1){if(!a.key){this.forAllChangedKeys((x,G,j)=>{this.notifyListeners(x,j)});return}let f=a.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let x=this.storage.getItem(f);if(a.newValue!==x)a.newValue!==null?this.storage.setItem(f,a.newValue):this.storage.removeItem(f);else if(this.localCache[f]===a.newValue&&!h)return}let y=()=>{let x=this.storage.getItem(f);(h||this.localCache[f]!==x)&&this.notifyListeners(f,x)},b=this.storage.getItem(f);(0,fe.w1)()&&document.documentMode===10&&b!==a.newValue&&a.newValue!==a.oldValue?setTimeout(y,10):y()}notifyListeners(a,h){this.localCache[a]=h;let f=this.listeners[a];if(f)for(let y of Array.from(f))y(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:f}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),this.listeners[a].size===0&&delete this.listeners[a]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(a,h){await super._set(a,h),this.localCache[a]=JSON.stringify(h)}async _get(a){let h=await super._get(a);return this.localCache[a]=JSON.stringify(h),h}async _remove(a){await super._remove(a),delete this.localCache[a]}}jt.type="LOCAL";class Qr extends Wn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}Qr.type="SESSION";class lt{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){let h=this.receivers.find(y=>y.isListeningto(a));if(h)return h;let f=new lt(a);return this.receivers.push(f),f}isListeningto(a){return this.eventTarget===a}async handleEvent(a){let{eventId:h,eventType:f,data:y}=a.data,b=this.handlersMap[f];if(!b?.size)return;a.ports[0].postMessage({status:"ack",eventId:h,eventType:f});let x=Array.from(b).map(async j=>j(a.origin,y)),G=await Promise.all(x.map(async j=>{try{return{fulfilled:!0,value:await j}}catch(le){return{fulfilled:!1,reason:le}}}));a.ports[0].postMessage({status:"done",eventId:h,eventType:f,response:G})}_subscribe(a,h){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),h&&this.handlersMap[a].size!==0||delete this.handlersMap[a],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ni(p="",a=10){let h="";for(let f=0;f<a;f++)h+=Math.floor(10*Math.random());return p+h}lt.receivers=[];class Rn{constructor(a){this.target=a,this.handlers=new Set}removeMessageHandler(a){a.messageChannel&&(a.messageChannel.port1.removeEventListener("message",a.onMessage),a.messageChannel.port1.close()),this.handlers.delete(a)}async _send(a,h,f=50){let y,b,x=typeof MessageChannel<"u"?new MessageChannel:null;if(!x)throw Error("connection_unavailable");return new Promise((G,j)=>{let le=Ni("",20);x.port1.start();let Te=setTimeout(()=>{j(Error("unsupported_event"))},f);b={messageChannel:x,onMessage(Ne){if(Ne.data.eventId===le)switch(Ne.data.status){case"ack":clearTimeout(Te),y=setTimeout(()=>{j(Error("timeout"))},3e3);break;case"done":clearTimeout(y),G(Ne.data.response);break;default:clearTimeout(Te),clearTimeout(y),j(Error("invalid_response"))}}},this.handlers.add(b),x.port1.addEventListener("message",b.onMessage),this.target.postMessage({eventType:a,eventId:le,data:h},[x.port2])}).finally(()=>{b&&this.removeMessageHandler(b)})}}function $e(){return window}function Sn(){return $e().WorkerGlobalScope!==void 0&&typeof $e().importScripts=="function"}async function Jr(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let kr="firebaseLocalStorageDb",jn="firebaseLocalStorage",Es="fbase_key";class yn{constructor(a){this.request=a}toPromise(){return new Promise((a,h)=>{this.request.addEventListener("success",()=>{a(this.request.result)}),this.request.addEventListener("error",()=>{h(this.request.error)})})}}function vn(p,a){return p.transaction([jn],a?"readwrite":"readonly").objectStore(jn)}function sr(){let p=indexedDB.open(kr,1);return new Promise((a,h)=>{p.addEventListener("error",()=>{h(p.error)}),p.addEventListener("upgradeneeded",()=>{let f=p.result;try{f.createObjectStore(jn,{keyPath:Es})}catch(y){h(y)}}),p.addEventListener("success",async()=>{let f=p.result;f.objectStoreNames.contains(jn)?a(f):(f.close(),await new yn(indexedDB.deleteDatabase(kr)).toPromise(),a(await sr()))})})}async function On(p,a,h){return new yn(vn(p,!0).put({[Es]:a,value:h})).toPromise()}async function Cn(p,a){let h=vn(p,!1).get(a),f=await new yn(h).toPromise();return f===void 0?null:f.value}function ar(p,a){return new yn(vn(p,!0).delete(a)).toPromise()}class Pn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await sr()),this.db}async _withRetries(a){let h=0;for(;;)try{let f=await this._openDb();return await a(f)}catch(f){if(h++>3)throw f;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Sn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lt._getInstance(Sn()?Ge:null),this.receiver._subscribe("keyChanged",async(a,h)=>({keyProcessed:(await this._poll()).includes(h.key)})),this.receiver._subscribe("ping",async(a,h)=>["keyChanged"])}async initializeSender(){var a,h;if(this.activeServiceWorker=await Jr(),!this.activeServiceWorker)return;this.sender=new Rn(this.activeServiceWorker);let f=await this.sender._send("ping",{},800);f&&((a=f[0])===null||a===void 0?void 0:a.fulfilled)&&((h=f[0])===null||h===void 0?void 0:h.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(a){var h;if(this.sender&&this.activeServiceWorker&&(((h=navigator?.serviceWorker)===null||h===void 0?void 0:h.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:a},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let a=await sr();return await On(a,Cr,"1"),await ar(a,Cr),!0}catch{}return!1}async _withPendingWrite(a){this.pendingWrites++;try{await a()}finally{this.pendingWrites--}}async _set(a,h){return this._withPendingWrite(async()=>(await this._withRetries(f=>On(f,a,h)),this.localCache[a]=h,this.notifyServiceWorker(a)))}async _get(a){let h=await this._withRetries(f=>Cn(f,a));return this.localCache[a]=h,h}async _remove(a){return this._withPendingWrite(async()=>(await this._withRetries(h=>ar(h,a)),delete this.localCache[a],this.notifyServiceWorker(a)))}async _poll(){let a=await this._withRetries(y=>new yn(vn(y,!1).getAll()).toPromise());if(!a||this.pendingWrites!==0)return[];let h=[],f=new Set;if(a.length!==0)for(let{fbase_key:y,value:b}of a)f.add(y),JSON.stringify(this.localCache[y])!==JSON.stringify(b)&&(this.notifyListeners(y,b),h.push(y));for(let y of Object.keys(this.localCache))this.localCache[y]&&!f.has(y)&&(this.notifyListeners(y,null),h.push(y));return h}notifyListeners(a,h){this.localCache[a]=h;let f=this.listeners[a];if(f)for(let y of Array.from(f))y(h)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),this.listeners[a].size===0&&delete this.listeners[a]),Object.keys(this.listeners).length===0&&this.stopPolling()}}async function Ts(p,a,h){var f,y,b;let x=await h.verify();try{let G;if(ue(typeof x=="string",p,"argument-error"),ue(h.type==="recaptcha",p,"argument-error"),G=typeof a=="string"?{phoneNumber:a}:a,"session"in G){let j=G.session;if("phoneNumber"in G)return ue(j.type==="enroll",p,"internal-error"),(await(y={idToken:j.credential,phoneEnrollmentInfo:{phoneNumber:G.phoneNumber,recaptchaToken:x}},ot(p,"POST","/v2/accounts/mfaEnrollment:start",We(p,y)))).phoneSessionInfo.sessionInfo;{ue(j.type==="signin",p,"internal-error");let le=((f=G.multiFactorHint)===null||f===void 0?void 0:f.uid)||G.multiFactorUid;return ue(le,p,"missing-multi-factor-info"),(await(b={mfaPendingCredential:j.credential,mfaEnrollmentId:le,phoneSignInInfo:{recaptchaToken:x}},ot(p,"POST","/v2/accounts/mfaSignIn:start",We(p,b)))).phoneResponseInfo.sessionInfo}}{let{sessionInfo:j}=await Na(p,{phoneNumber:G.phoneNumber,recaptchaToken:x});return j}}finally{h._reset()}}Pn.type="LOCAL",Ct("rcb"),new Fe(3e4,6e4);class en{constructor(a){this.providerId=en.PROVIDER_ID,this.auth=It(a)}verifyPhoneNumber(a,h){return Ts(this.auth,a,(0,fe.m9)(h))}static credential(a,h){return rr._fromVerification(a,h)}static credentialFromResult(a){return en.credentialFromTaggedObject(a)}static credentialFromError(a){return en.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{phoneNumber:h,temporaryProof:f}=a;return h&&f?rr._fromTokenResponse(h,f):null}}en.PROVIDER_ID="phone",en.PHONE_SIGN_IN_METHOD="phone";class Ln extends ct{constructor(a){super("custom","custom"),this.params=a}_getIdTokenResponse(a){return gn(a,this._buildIdpRequest())}_linkToIdToken(a,h){return gn(a,this._buildIdpRequest(h))}_getReauthenticationResolver(a){return gn(a,this._buildIdpRequest())}_buildIdpRequest(a){let h={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return a&&(h.idToken=a),h}}function xi(p){return Et(p.auth,new Ln(p),p.bypassAuthState)}function Ar(p){let{auth:a,user:h}=p;return ue(h,a,"internal-error"),Ai(h,new Ln(p),p.bypassAuthState)}async function Ss(p){let{auth:a,user:h}=p;return ue(h,a,"internal-error"),Pa(h,new Ln(p),p.bypassAuthState)}class Di{constructor(a,h,f,y,b=!1){this.auth=a,this.resolver=f,this.user=y,this.bypassAuthState=b,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(h)?h:[h]}execute(){return new Promise(async(a,h)=>{this.pendingPromise={resolve:a,reject:h};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(f){this.reject(f)}})}async onAuthEvent(a){let{urlResponse:h,sessionId:f,postBody:y,tenantId:b,error:x,type:G}=a;if(x){this.reject(x);return}let j={auth:this.auth,requestUri:h,sessionId:f,tenantId:b||void 0,postBody:y||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(G)(j))}catch(le){this.reject(le)}}onError(a){this.reject(a)}getIdpTask(a){switch(a){case"signInViaPopup":case"signInViaRedirect":return xi;case"linkViaPopup":case"linkViaRedirect":return Ss;case"reauthViaPopup":case"reauthViaRedirect":return Ar;default:Ce(this.auth,"internal-error")}}resolve(a){var h,f;h=this.pendingPromise,f="Pending promise was never set",h||Je(f),this.pendingPromise.resolve(a),this.unregisterAndCleanUp()}reject(a){var h,f;h=this.pendingPromise,f="Pending promise was never set",h||Je(f),this.pendingPromise.reject(a),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let Xr=new Fe(2e3,1e4);class kn extends Di{constructor(a,h,f,y,b){super(a,h,y,b),this.provider=f,this.authWindow=null,this.pollId=null,kn.currentPopupAction&&kn.currentPopupAction.cancel(),kn.currentPopupAction=this}async executeNotNull(){let a=await this.execute();return ue(a,this.auth,"internal-error"),a}async onExecution(){var a,h;a=this.filter.length===1,h="Popup operations only handle one event",a||Je(h);let f=Ni();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],f),this.authWindow.associatedEvent=f,this.resolver._originValidation(this.auth).catch(y=>{this.reject(y)}),this.resolver._isIframeWebStorageSupported(this.auth,y=>{y||this.reject(Oe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var a;return((a=this.authWindow)===null||a===void 0?void 0:a.associatedEvent)||null}cancel(){this.reject(Oe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kn.currentPopupAction=null}pollUserCancellation(){let a=()=>{var h,f;if(!((f=(h=this.authWindow)===null||h===void 0?void 0:h.window)===null||f===void 0)&&f.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Oe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(a,Xr.get())};a()}}kn.currentPopupAction=null;let Nr=new Map;class Cs extends Di{constructor(a,h,f=!1){super(a,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],h,void 0,f),this.eventId=null}async execute(){let a=Nr.get(this.auth._key());if(!a){try{let h=await ks(this.resolver,this.auth)?await super.execute():null;a=()=>Promise.resolve(h)}catch(h){a=()=>Promise.reject(h)}Nr.set(this.auth._key(),a)}return this.bypassAuthState||Nr.set(this.auth._key(),()=>Promise.resolve(null)),a()}async onAuthEvent(a){if(a.type==="signInViaRedirect")return super.onAuthEvent(a);if(a.type==="unknown"){this.resolve(null);return}if(a.eventId){let h=await this.auth._redirectUserForId(a.eventId);if(h)return this.user=h,super.onAuthEvent(a);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ks(p,a){let h=zn(a),f=mt(p);if(!await f._isAvailable())return!1;let y=await f._get(h)==="true";return await f._remove(h),y}function Mt(p,a){Nr.set(p._key(),a)}function mt(p){return Se(p._redirectPersistence)}function zn(p){return J("pendingRedirect",p.config.apiKey,p.name)}async function As(p,a,h=!1){var f,y;if((0,re.rh)(p.app))return Promise.reject(Ee(p));let b=It(p),x=(f=b,(y=a)?Se(y):(ue(f._popupRedirectResolver,f,"argument-error"),f._popupRedirectResolver)),G=new Cs(b,x,h),j=await G.execute();return j&&!h&&(delete j.user._redirectEventId,await b._persistUserIfCurrent(j.user),await b._setRedirectUser(null,a)),j}class Ns{constructor(a){this.auth=a,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(a){this.consumers.add(a),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,a)&&(this.sendToConsumer(this.queuedRedirectEvent,a),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(a){this.consumers.delete(a)}onEvent(a){if(this.hasEventBeenHandled(a))return!1;let h=!1;return this.consumers.forEach(f=>{this.isEventForConsumer(a,f)&&(h=!0,this.sendToConsumer(a,f),this.saveEventToCache(a))}),this.hasHandledPotentialRedirect||!function(f){switch(f.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ri(f);default:return!1}}(a)||(this.hasHandledPotentialRedirect=!0,h||(this.queuedRedirectEvent=a,h=!0)),h}sendToConsumer(a,h){var f;if(a.error&&!Ri(a)){let y=((f=a.error.code)===null||f===void 0?void 0:f.split("auth/")[1])||"internal-error";h.onError(Oe(this.auth,y))}else h.onAuthEvent(a)}isEventForConsumer(a,h){let f=h.eventId===null||!!a.eventId&&a.eventId===h.eventId;return h.filter.includes(a.type)&&f}hasEventBeenHandled(a){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(or(a))}saveEventToCache(a){this.cachedEventUids.add(or(a)),this.lastProcessedEventTime=Date.now()}}function or(p){return[p.type,p.eventId,p.sessionId,p.tenantId].filter(a=>a).join("-")}function Ri({type:p,error:a}){return p==="unknown"&&a?.code==="auth/no-auth-event"}async function Me(p,a={}){return ot(p,"GET","/v1/projects",a)}let Ze=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lr=/^https?/;async function Oi(p){if(p.config.emulator)return;let{authorizedDomains:a}=await Me(p);for(let h of a)try{if(function(f){let y=pn(),{protocol:b,hostname:x}=new URL(y);if(f.startsWith("chrome-extension://")){let j=new URL(f);return j.hostname===""&&x===""?b==="chrome-extension:"&&f.replace("chrome-extension://","")===y.replace("chrome-extension://",""):b==="chrome-extension:"&&j.hostname===x}if(!lr.test(b))return!1;if(Ze.test(f))return x===f;let G=f.replace(/\./g,"\\.");return RegExp("^(.+\\."+G+"|"+G+")$","i").test(x)}(h))return}catch{}Ce(p,"unauthorized-domain")}let Pi=new Fe(3e4,6e4);function Li(){let p=$e().___jsl;if(p?.H){for(let a of Object.keys(p.H))if(p.H[a].r=p.H[a].r||[],p.H[a].L=p.H[a].L||[],p.H[a].r=[...p.H[a].L],p.CP)for(let h=0;h<p.CP.length;h++)p.CP[h]=null}}let Yr=null,La=new Fe(5e3,15e3),Ma={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ua=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function xs(p){let a=await(Yr=Yr||new Promise((f,y)=>{var b,x,G,j;function le(){Li(),gapi.load("gapi.iframes",{callback:()=>{f(gapi.iframes.getContext())},ontimeout:()=>{Li(),y(Oe(p,"network-request-failed"))},timeout:Pi.get()})}if(!((x=(b=$e().gapi)===null||b===void 0?void 0:b.iframes)===null||x===void 0)&&x.Iframe)f(gapi.iframes.getContext());else if(!((G=$e().gapi)===null||G===void 0)&&G.load)le();else{let Te=Ct("iframefcb");return $e()[Te]=()=>{gapi.load?le():y(Oe(p,"network-request-failed"))},(j=`${Xe.gapiScript}?onload=${Te}`,Xe.loadJS(j)).catch(Ne=>y(Ne))}}).catch(f=>{throw Yr=null,f})),h=$e().gapi;return ue(h,p,"internal-error"),a.open({where:document.body,url:function(f){let y=f.config;ue(y.authDomain,f,"auth-domain-config-required");let b=y.emulator?mn(y,"emulator/auth/iframe"):`https://${f.config.authDomain}/__/auth/iframe`,x={apiKey:y.apiKey,appName:f.name,v:re.Jn},G=Ua.get(f.config.apiHost);G&&(x.eid=G);let j=f._getFrameworks();return j.length&&(x.fw=j.join(",")),`${b}?${(0,fe.xO)(x).slice(1)}`}(p),messageHandlersFilter:h.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ma,dontclear:!0},f=>new Promise(async(y,b)=>{await f.restyle({setHideOnLeave:!1});let x=Oe(p,"network-request-failed"),G=$e().setTimeout(()=>{b(x)},La.get());function j(){$e().clearTimeout(G),y(f)}f.ping(j).then(j,()=>{b(x)})}))}let Fa={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Mi{constructor(a){this.window=a,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}let Va=encodeURIComponent("fac");async function Ds(p,a,h,f,y,b){ue(p.config.authDomain,p,"auth-domain-config-required"),ue(p.config.apiKey,p,"invalid-api-key");let x={apiKey:p.config.apiKey,appName:p.name,authType:h,redirectUrl:f,v:re.Jn,eventId:y};if(a instanceof _s)for(let[le,Te]of(a.setDefaultLanguage(p.languageCode),x.providerId=a.providerId||"",(0,fe.xb)(a.getCustomParameters())||(x.customParameters=JSON.stringify(a.getCustomParameters())),Object.entries(b||{})))x[le]=Te;if(a instanceof Tr){let le=a.getScopes().filter(Te=>Te!=="");le.length>0&&(x.scopes=le.join(","))}for(let le of(p.tenantId&&(x.tid=p.tenantId),Object.keys(x)))x[le]===void 0&&delete x[le];let G=await p._getAppCheckToken(),j=G?`#${Va}=${encodeURIComponent(G)}`:"";return`${function({config:le}){return le.emulator?mn(le,"emulator/auth/handler"):`https://${le.authDomain}/__/auth/handler`}(p)}?${(0,fe.xO)(x).slice(1)}${j}`}let Ui="webStorageSupport";class Fi{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qr,this._completeRedirectFn=As,this._overrideRedirectResult=Mt}async _openPopup(a,h,f,y){var b,x,G;x=(b=this.eventManagers[a._key()])===null||b===void 0?void 0:b.manager,G="_initialize() not called before _openPopup()",x||Je(G);let j=await Ds(a,h,f,pn(),y);return function(le,Te,Ne,un=500,Mn=600){let ke=Math.max((window.screen.availHeight-Mn)/2,0).toString(),hn=Math.max((window.screen.availWidth-un)/2,0).toString(),Ut="",_t=Object.assign(Object.assign({},Fa),{width:un.toString(),height:Mn.toString(),top:ke,left:hn}),wn=(0,fe.z$)().toLowerCase();Ne&&(Ut=$(wn)?"_blank":Ne),P(wn)&&(Te=Te||"http://localhost",_t.scrollbars="yes");let In=Object.entries(_t).reduce((Ft,[Lt,Un])=>`${Ft}${Lt}=${Un},`,"");if(function(Ft=(0,fe.z$)()){var Lt;return pe(Ft)&&!!(!((Lt=window.navigator)===null||Lt===void 0)&&Lt.standalone)}(wn)&&Ut!=="_self")return function(Ft,Lt){let Un=document.createElement("a");Un.href=Ft,Un.target=Lt;let An=document.createEvent("MouseEvent");An.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),Un.dispatchEvent(An)}(Te||"",Ut),new Mi(null);let cn=window.open(Te||"",Ut,In);ue(cn,le,"popup-blocked");try{cn.focus()}catch{}return new Mi(cn)}(a,j,Ni())}async _openRedirect(a,h,f,y){var b;return await this._originValidation(a),b=await Ds(a,h,f,pn(),y),$e().location.href=b,new Promise(()=>{})}_initialize(a){let h=a._key();if(this.eventManagers[h]){var f;let{manager:b,promise:x}=this.eventManagers[h];return b?Promise.resolve(b):(f="If manager is not set, promise should be",x||Je(f),x)}let y=this.initAndGetManager(a);return this.eventManagers[h]={promise:y},y.catch(()=>{delete this.eventManagers[h]}),y}async initAndGetManager(a){let h=await xs(a),f=new Ns(a);return h.register("authEvent",y=>(ue(y?.authEvent,a,"invalid-auth-event"),{status:f.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[a._key()]={manager:f},this.iframes[a._key()]=h,f}_isIframeWebStorageSupported(a,h){this.iframes[a._key()].send(Ui,{type:Ui},f=>{var y;let b=(y=f?.[0])===null||y===void 0?void 0:y[Ui];b!==void 0&&h(!!b),Ce(a,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(a){let h=a._key();return this.originValidationPromises[h]||(this.originValidationPromises[h]=Oi(a)),this.originValidationPromises[h]}get _shouldInitProactively(){return Ae()||S()||pe()}}class $n{constructor(a){this.factorId=a}_process(a,h,f){switch(h.type){case"enroll":return this._finalizeEnroll(a,h.credential,f);case"signin":return this._finalizeSignIn(a,h.credential);default:return Je("unexpected MultiFactorSessionType")}}}class Qn extends $n{constructor(a){super("phone"),this.credential=a}static _fromCredential(a){return new Qn(a)}_finalizeEnroll(a,h,f){return ot(a,"POST","/v2/accounts/mfaEnrollment:finalize",We(a,{idToken:h,displayName:f,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(a,h){return ot(a,"POST","/v2/accounts/mfaSignIn:finalize",We(a,{mfaPendingCredential:h,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class Zr{constructor(){}static assertion(a){return Qn._fromCredential(a)}}Zr.FACTOR_ID="phone";class ei{static assertionForEnrollment(a,h){return ur._fromSecret(a,h)}static assertionForSignIn(a,h){return ur._fromEnrollmentId(a,h)}static async generateSecret(a){var h,f;ue(((h=a.user)===null||h===void 0?void 0:h.auth)!==void 0,"internal-error");let y=await ot(f=a.user.auth,"POST","/v2/accounts/mfaEnrollment:start",We(f,{idToken:a.credential,totpEnrollmentInfo:{}}));return ti._fromStartTotpMfaEnrollmentResponse(y,a.user.auth)}}ei.FACTOR_ID="totp";class ur extends $n{constructor(a,h,f){super("totp"),this.otp=a,this.enrollmentId=h,this.secret=f}static _fromSecret(a,h){return new ur(h,void 0,a)}static _fromEnrollmentId(a,h){return new ur(h,a)}async _finalizeEnroll(a,h,f){return ue(this.secret!==void 0,a,"argument-error"),ot(a,"POST","/v2/accounts/mfaEnrollment:finalize",We(a,{idToken:h,displayName:f,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(a,h){ue(this.enrollmentId!==void 0&&this.otp!==void 0,a,"argument-error");let f={verificationCode:this.otp};return ot(a,"POST","/v2/accounts/mfaSignIn:finalize",We(a,{mfaPendingCredential:h,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:f}))}}class ti{constructor(a,h,f,y,b,x,G){this.sessionInfo=x,this.auth=G,this.secretKey=a,this.hashingAlgorithm=h,this.codeLength=f,this.codeIntervalSeconds=y,this.enrollmentCompletionDeadline=b}static _fromStartTotpMfaEnrollmentResponse(a,h){return new ti(a.totpSessionInfo.sharedSecretKey,a.totpSessionInfo.hashingAlgorithm,a.totpSessionInfo.verificationCodeLength,a.totpSessionInfo.periodSec,new Date(a.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),a.totpSessionInfo.sessionInfo,h)}_makeTotpVerificationInfo(a){return{sessionInfo:this.sessionInfo,verificationCode:a}}generateQrCodeUrl(a,h){var f;let y=!1;return(ln(a)||ln(h))&&(y=!0),y&&(ln(a)&&(a=((f=this.auth.currentUser)===null||f===void 0?void 0:f.email)||"unknownuser"),ln(h)&&(h=this.auth.name)),`otpauth://totp/${h}:${a}?secret=${this.secretKey}&issuer=${h}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ln(p){return p===void 0||p?.length===0}var xr="@firebase/auth",Vi="1.7.6";class Bi{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){var a;return this.assertAuthConfigured(),((a=this.auth.currentUser)===null||a===void 0?void 0:a.uid)||null}async getToken(a){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;let h=this.auth.onIdTokenChanged(f=>{a(f?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,h),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();let h=this.internalListeners.get(a);h&&(this.internalListeners.delete(a),h(),this.updateProactiveRefresh())}assertAuthConfigured(){ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let hr=(0,fe.Pz)("authIdTokenMaxAge")||300,Kt=null,qi=p=>async a=>{let h=a&&await a.getIdTokenResult(),f=h&&(new Date().getTime()-Date.parse(h.issuedAtTime))/1e3;if(f&&f>hr)return;let y=h?.token;Kt!==y&&(Kt=y,await fetch(p,{method:y?"POST":"DELETE",headers:y?{Authorization:`Bearer ${y}`}:{}}))};function ni(p=(0,re.Mq)()){let a=(0,re.qX)(p,"auth");if(a.isInitialized())return a.getImmediate();let h=function(G,j){let le=(0,re.qX)(G,"auth");if(le.isInitialized()){let Te=le.getImmediate(),Ne=le.getOptions();if((0,fe.vZ)(Ne,j??{}))return Te;Ce(Te,"already-initialized")}return le.initialize({options:j})}(p,{popupRedirectResolver:Fi,persistence:[Pn,jt,Qr]}),f=(0,fe.Pz)("authTokenSyncURL");if(f&&typeof isSecureContext=="boolean"&&isSecureContext){let G=new URL(f,location.origin);if(location.origin===G.origin){var y,b;let j=qi(G.toString());y=()=>j(h.currentUser),(0,fe.m9)(h).beforeAuthStateChanged(j,y),b=le=>j(le),(0,fe.m9)(h).onIdTokenChanged(b,void 0,void 0)}}let x=(0,fe.q4)("auth");return x&&function(G,j,le){let Te=It(G);ue(Te._canInitEmulator,Te,"emulator-config-failed"),ue(/^https?:\/\//.test(j),Te,"invalid-emulator-scheme");let Ne=Kr(j),{host:un,port:Mn}=function(hn){let Ut=Kr(hn),_t=/(\/\/)?([^?#/]+)/.exec(hn.substr(Ut.length));if(!_t)return{host:"",port:null};let wn=_t[2].split("@").pop()||"",In=/^(\[[^\]]+\])(:|$)/.exec(wn);if(In){let cn=In[1];return{host:cn,port:Gr(wn.substr(cn.length+1))}}{let[cn,Ft]=wn.split(":");return{host:cn,port:Gr(Ft)}}}(j),ke=Mn===null?"":`:${Mn}`;Te.config.emulator={url:`${Ne}//${un}${ke}/`},Te.settings.appVerificationDisabledForTesting=!0,Te.emulatorConfig=Object.freeze({host:un,port:Mn,protocol:Ne.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function hn(){let Ut=document.createElement("p"),_t=Ut.style;Ut.innerText="Running in emulator mode. Do not use with production credentials.",_t.position="fixed",_t.width="100%",_t.backgroundColor="#ffffff",_t.border=".1em solid #000000",_t.color="#b50000",_t.bottom="0px",_t.left="0px",_t.margin="0px",_t.zIndex="10000",_t.textAlign="center",Ut.classList.add("firebase-emulator-warning"),document.body.appendChild(Ut)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",hn):hn())}()}(h,`http://${x}`),h}Xe={loadJS:p=>new Promise((a,h)=>{let f=document.createElement("script");f.setAttribute("src",p),f.onload=a,f.onerror=y=>{let b=Oe("internal-error");b.customData=y,h(b)},f.type="text/javascript",f.charset="UTF-8",function(){var y,b;return(b=(y=document.getElementsByTagName("head"))===null||y===void 0?void 0:y[0])!==null&&b!==void 0?b:document}().appendChild(f)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(p){(0,re.Xd)(new St.wA("auth",(a,{options:h})=>{let f=a.getProvider("app").getImmediate(),y=a.getProvider("heartbeat"),b=a.getProvider("app-check-internal"),{apiKey:x,authDomain:G}=f.options;ue(x&&!x.includes(":"),"invalid-api-key",{appName:f.name});let j=new ht(f,y,b,{apiKey:x,authDomain:G,clientPlatform:p,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:be(p)});return function(le,Te){let Ne=Te?.persistence||[],un=(Array.isArray(Ne)?Ne:[Ne]).map(Se);Te?.errorMap&&le._updateErrorMap(Te.errorMap),le._initializeWithPersistence(un,Te?.popupRedirectResolver)}(j,h),j},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,h,f)=>{a.getProvider("auth-internal").initialize()})),(0,re.Xd)(new St.wA("auth-internal",a=>new Bi(It(a.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,re.KN)(xr,Vi,function(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(p)),(0,re.KN)(xr,Vi,"esm2017")}("Browser")},Gn.__chunk_919=(tr,qt,De)=>{De.d(qt,{ZF:()=>re.ZF});var re=De(2338);(0,re.KN)("firebase","10.12.5","app")},Gn.__chunk_3369=(tr,qt,De)=>{var re;De.d(qt,{Yd:()=>ie,in:()=>re});let fe=[];(function(ne){ne[ne.DEBUG=0]="DEBUG",ne[ne.VERBOSE=1]="VERBOSE",ne[ne.INFO=2]="INFO",ne[ne.WARN=3]="WARN",ne[ne.ERROR=4]="ERROR",ne[ne.SILENT=5]="SILENT"})(re||(re={}));let He={debug:re.DEBUG,verbose:re.VERBOSE,info:re.INFO,warn:re.WARN,error:re.ERROR,silent:re.SILENT},it=re.INFO,St={[re.DEBUG]:"log",[re.VERBOSE]:"log",[re.INFO]:"info",[re.WARN]:"warn",[re.ERROR]:"error"},ze=(ne,he,...Ce)=>{if(he<ne.logLevel)return;let Oe=new Date().toISOString(),Re=St[he];if(Re)console[Re](`[${Oe}]  ${ne.name}:`,...Ce);else throw Error(`Attempted to log a message with an invalid logType (value: ${he})`)};class ie{constructor(he){this.name=he,this._logLevel=it,this._logHandler=ze,this._userLogHandler=null,fe.push(this)}get logLevel(){return this._logLevel}set logLevel(he){if(!(he in re))throw TypeError(`Invalid value "${he}" assigned to \`logLevel\``);this._logLevel=he}setLogLevel(he){this._logLevel=typeof he=="string"?He[he]:he}get logHandler(){return this._logHandler}set logHandler(he){if(typeof he!="function")throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=he}get userLogHandler(){return this._userLogHandler}set userLogHandler(he){this._userLogHandler=he}debug(...he){this._userLogHandler&&this._userLogHandler(this,re.DEBUG,...he),this._logHandler(this,re.DEBUG,...he)}log(...he){this._userLogHandler&&this._userLogHandler(this,re.VERBOSE,...he),this._logHandler(this,re.VERBOSE,...he)}info(...he){this._userLogHandler&&this._userLogHandler(this,re.INFO,...he),this._logHandler(this,re.INFO,...he)}warn(...he){this._userLogHandler&&this._userLogHandler(this,re.WARN,...he),this._logHandler(this,re.WARN,...he)}error(...he){this._userLogHandler&&this._userLogHandler(this,re.ERROR,...he),this._logHandler(this,re.ERROR,...he)}}},Gn.__chunk_9122=(tr,qt,De)=>{De.d(qt,{H0:()=>St,wA:()=>fe});var re=De(1511);class fe{constructor(ie,ne,he){this.name=ie,this.instanceFactory=ne,this.type=he,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(ie){return this.instantiationMode=ie,this}setMultipleInstances(ie){return this.multipleInstances=ie,this}setServiceProps(ie){return this.serviceProps=ie,this}setInstanceCreatedCallback(ie){return this.onInstanceCreated=ie,this}}let He="[DEFAULT]";class it{constructor(ie,ne){this.name=ie,this.container=ne,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(ie){let ne=this.normalizeInstanceIdentifier(ie);if(!this.instancesDeferred.has(ne)){let he=new re.BH;if(this.instancesDeferred.set(ne,he),this.isInitialized(ne)||this.shouldAutoInitialize())try{let Ce=this.getOrInitializeService({instanceIdentifier:ne});Ce&&he.resolve(Ce)}catch{}}return this.instancesDeferred.get(ne).promise}getImmediate(ie){var ne;let he=this.normalizeInstanceIdentifier(ie?.identifier),Ce=(ne=ie?.optional)!==null&&ne!==void 0&&ne;if(this.isInitialized(he)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:he})}catch(Oe){if(Ce)return null;throw Oe}else{if(Ce)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(ie){if(ie.name!==this.name)throw Error(`Mismatching Component ${ie.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=ie,this.shouldAutoInitialize()){if(ie.instantiationMode==="EAGER")try{this.getOrInitializeService({instanceIdentifier:He})}catch{}for(let[ne,he]of this.instancesDeferred.entries()){let Ce=this.normalizeInstanceIdentifier(ne);try{let Oe=this.getOrInitializeService({instanceIdentifier:Ce});he.resolve(Oe)}catch{}}}}clearInstance(ie=He){this.instancesDeferred.delete(ie),this.instancesOptions.delete(ie),this.instances.delete(ie)}async delete(){let ie=Array.from(this.instances.values());await Promise.all([...ie.filter(ne=>"INTERNAL"in ne).map(ne=>ne.INTERNAL.delete()),...ie.filter(ne=>"_delete"in ne).map(ne=>ne._delete())])}isComponentSet(){return this.component!=null}isInitialized(ie=He){return this.instances.has(ie)}getOptions(ie=He){return this.instancesOptions.get(ie)||{}}initialize(ie={}){let{options:ne={}}=ie,he=this.normalizeInstanceIdentifier(ie.instanceIdentifier);if(this.isInitialized(he))throw Error(`${this.name}(${he}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let Ce=this.getOrInitializeService({instanceIdentifier:he,options:ne});for(let[Oe,Re]of this.instancesDeferred.entries())he===this.normalizeInstanceIdentifier(Oe)&&Re.resolve(Ce);return Ce}onInit(ie,ne){var he;let Ce=this.normalizeInstanceIdentifier(ne),Oe=(he=this.onInitCallbacks.get(Ce))!==null&&he!==void 0?he:new Set;Oe.add(ie),this.onInitCallbacks.set(Ce,Oe);let Re=this.instances.get(Ce);return Re&&ie(Re,Ce),()=>{Oe.delete(ie)}}invokeOnInitCallbacks(ie,ne){let he=this.onInitCallbacks.get(ne);if(he)for(let Ce of he)try{Ce(ie,ne)}catch{}}getOrInitializeService({instanceIdentifier:ie,options:ne={}}){let he=this.instances.get(ie);if(!he&&this.component&&(he=this.component.instanceFactory(this.container,{instanceIdentifier:ie===He?void 0:ie,options:ne}),this.instances.set(ie,he),this.instancesOptions.set(ie,ne),this.invokeOnInitCallbacks(he,ie),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,ie,he)}catch{}return he||null}normalizeInstanceIdentifier(ie=He){return this.component?this.component.multipleInstances?ie:He:ie}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}class St{constructor(ie){this.name=ie,this.providers=new Map}addComponent(ie){let ne=this.getProvider(ie.name);if(ne.isComponentSet())throw Error(`Component ${ie.name} has already been registered with ${this.name}`);ne.setComponent(ie)}addOrOverwriteComponent(ie){this.getProvider(ie.name).isComponentSet()&&this.providers.delete(ie.name),this.addComponent(ie)}getProvider(ie){if(this.providers.has(ie))return this.providers.get(ie);let ne=new it(ie,this);return this.providers.set(ie,ne),ne}getProviders(){return Array.from(this.providers.values())}}},Gn.__chunk_2338=(tr,qt,De)=>{let re,fe,He;De.d(qt,{Jn:()=>M,qX:()=>Ve,rh:()=>Yt,Xd:()=>H,Mq:()=>Rt,ZF:()=>ee,KN:()=>V});var it=De(9122),St=De(3369),ze=De(1511);let ie=(W,R)=>R.some(Z=>W instanceof Z),ne=new WeakMap,he=new WeakMap,Ce=new WeakMap,Oe=new WeakMap,Re=new WeakMap,Ee={get(W,R,Z){if(W instanceof IDBTransaction){if(R==="done")return he.get(W);if(R==="objectStoreNames")return W.objectStoreNames||Ce.get(W);if(R==="store")return Z.objectStoreNames[1]?void 0:Z.objectStore(Z.objectStoreNames[0])}return ft(W[R])},set:(W,R,Z)=>(W[R]=Z,!0),has:(W,R)=>W instanceof IDBTransaction&&(R==="done"||R==="store")||R in W};function ft(W){var R;if(W instanceof IDBRequest)return function(te){let Se=new Promise((we,J)=>{let je=()=>{te.removeEventListener("success",Be),te.removeEventListener("error",P)},Be=()=>{we(ft(te.result)),je()},P=()=>{J(te.error),je()};te.addEventListener("success",Be),te.addEventListener("error",P)});return Se.then(we=>{we instanceof IDBCursor&&ne.set(we,te)}).catch(()=>{}),Re.set(Se,te),Se}(W);if(Oe.has(W))return Oe.get(W);let Z=typeof(R=W)=="function"?R!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(fe||(fe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(R)?function(...te){return R.apply(ue(this),te),ft(ne.get(this))}:function(...te){return ft(R.apply(ue(this),te))}:function(te,...Se){let we=R.call(ue(this),te,...Se);return Ce.set(we,te.sort?te.sort():[te]),ft(we)}:(R instanceof IDBTransaction&&function(te){if(he.has(te))return;let Se=new Promise((we,J)=>{let je=()=>{te.removeEventListener("complete",Be),te.removeEventListener("error",P),te.removeEventListener("abort",P)},Be=()=>{we(),je()},P=()=>{J(te.error||new DOMException("AbortError","AbortError")),je()};te.addEventListener("complete",Be),te.addEventListener("error",P),te.addEventListener("abort",P)});he.set(te,Se)}(R),ie(R,re||(re=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(R,Ee):R);return Z!==W&&(Oe.set(W,Z),Re.set(Z,W)),Z}let ue=W=>Re.get(W),Je=["get","getKey","getAll","getAllKeys","count"],pn=["put","add","delete","clear"],pt=new Map;function Fe(W,R){if(!(W instanceof IDBDatabase&&!(R in W)&&typeof R=="string"))return;if(pt.get(R))return pt.get(R);let Z=R.replace(/FromIndex$/,""),te=R!==Z,Se=pn.includes(Z);if(!(Z in(te?IDBIndex:IDBObjectStore).prototype)||!(Se||Je.includes(Z)))return;let we=async function(J,...je){let Be=this.transaction(J,Se?"readwrite":"readonly"),P=Be.store;return te&&(P=P.index(je.shift())),(await Promise.all([P[Z](...je),Se&&Be.done]))[0]};return pt.set(R,we),we}Ee={...He=Ee,get:(W,R,Z)=>Fe(W,R)||He.get(W,R,Z),has:(W,R)=>!!Fe(W,R)||He.has(W,R)};class mn{constructor(R){this.container=R}getPlatformInfoString(){return this.container.getProviders().map(R=>{if(!function(Z){let te=Z.getComponent();return te?.type==="VERSION"}(R))return null;{let Z=R.getImmediate();return`${Z.library}/${Z.version}`}}).filter(R=>R).join(" ")}}let zt="@firebase/app",an="0.10.8",gt=new St.Yd("@firebase/app"),We="[DEFAULT]",ot={[zt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},xe=new Map,yt=new Map,xt=new Map;function $t(W,R){try{W.container.addComponent(R)}catch(Z){gt.debug(`Component ${R.name} failed to register with FirebaseApp ${W.name}`,Z)}}function H(W){let R=W.name;if(xt.has(R))return gt.debug(`There were multiple attempts to register component ${R}.`),!1;for(let Z of(xt.set(R,W),xe.values()))$t(Z,W);for(let Z of yt.values())$t(Z,W);return!0}function Ve(W,R){let Z=W.container.getProvider("heartbeat").getImmediate({optional:!0});return Z&&Z.triggerHeartbeat(),W.container.getProvider(R)}function Yt(W){return W.settings!==void 0}let Dt=new ze.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class K{constructor(R,Z,te){this._isDeleted=!1,this._options=Object.assign({},R),this._config=Object.assign({},Z),this._name=Z.name,this._automaticDataCollectionEnabled=Z.automaticDataCollectionEnabled,this._container=te,this.container.addComponent(new it.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(R){this.checkDestroyed(),this._automaticDataCollectionEnabled=R}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(R){this._isDeleted=R}checkDestroyed(){if(this.isDeleted)throw Dt.create("app-deleted",{appName:this._name})}}let M="10.12.5";function ee(W,R={}){let Z=W;typeof R!="object"&&(R={name:R});let te=Object.assign({name:We,automaticDataCollectionEnabled:!1},R),Se=te.name;if(typeof Se!="string"||!Se)throw Dt.create("bad-app-name",{appName:String(Se)});if(Z||(Z=(0,ze.aH)()),!Z)throw Dt.create("no-options");let we=xe.get(Se);if(we){if((0,ze.vZ)(Z,we.options)&&(0,ze.vZ)(te,we.config))return we;throw Dt.create("duplicate-app",{appName:Se})}let J=new it.H0(Se);for(let Be of xt.values())J.addComponent(Be);let je=new K(Z,te,J);return xe.set(Se,je),je}function Rt(W=We){let R=xe.get(W);if(!R&&W===We&&(0,ze.aH)())return ee();if(!R)throw Dt.create("no-app",{appName:W});return R}function V(W,R,Z){var te;let Se=(te=ot[W])!==null&&te!==void 0?te:W;Z&&(Se+=`-${Z}`);let we=Se.match(/\s|\//),J=R.match(/\s|\//);if(we||J){let je=[`Unable to register library "${Se}" with version "${R}":`];we&&je.push(`library name "${Se}" contains illegal characters (whitespace or "/")`),we&&J&&je.push("and"),J&&je.push(`version name "${R}" contains illegal characters (whitespace or "/")`),gt.warn(je.join(" "));return}H(new it.wA(`${Se}-version`,()=>({library:Se,version:R}),"VERSION"))}let q="firebase-heartbeat-store",Y=null;function me(){return Y||(Y=function(W,R,{blocked:Z,upgrade:te,blocking:Se,terminated:we}={}){let J=indexedDB.open(W,1),je=ft(J);return te&&J.addEventListener("upgradeneeded",Be=>{te(ft(J.result),Be.oldVersion,Be.newVersion,ft(J.transaction),Be)}),Z&&J.addEventListener("blocked",Be=>Z(Be.oldVersion,Be.newVersion,Be)),je.then(Be=>{we&&Be.addEventListener("close",()=>we()),Se&&Be.addEventListener("versionchange",P=>Se(P.oldVersion,P.newVersion,P))}).catch(()=>{}),je}("firebase-heartbeat-database",0,{upgrade:(W,R)=>{if(R===0)try{W.createObjectStore(q)}catch(Z){console.warn(Z)}}}).catch(W=>{throw Dt.create("idb-open",{originalErrorMessage:W.message})})),Y}async function ce(W){try{let R=(await me()).transaction(q),Z=await R.objectStore(q).get(Qe(W));return await R.done,Z}catch(R){if(R instanceof ze.ZR)gt.warn(R.message);else{let Z=Dt.create("idb-get",{originalErrorMessage:R?.message});gt.warn(Z.message)}}}async function Pe(W,R){try{let Z=(await me()).transaction(q,"readwrite");await Z.objectStore(q).put(R,Qe(W)),await Z.done}catch(Z){if(Z instanceof ze.ZR)gt.warn(Z.message);else{let te=Dt.create("idb-set",{originalErrorMessage:Z?.message});gt.warn(te.message)}}}function Qe(W){return`${W.name}!${W.options.appId}`}class vt{constructor(R){this.container=R,this._heartbeatsCache=null;let Z=this.container.getProvider("app").getImmediate();this._storage=new ve(Z),this._heartbeatsCachePromise=this._storage.read().then(te=>(this._heartbeatsCache=te,te))}async triggerHeartbeat(){var R,Z;let te=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),Se=wt();return((R=this._heartbeatsCache)===null||R===void 0?void 0:R.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((Z=this._heartbeatsCache)===null||Z===void 0?void 0:Z.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===Se||this._heartbeatsCache.heartbeats.some(we=>we.date===Se)?void 0:(this._heartbeatsCache.heartbeats.push({date:Se,agent:te}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(we=>{let J=new Date(we.date).valueOf();return Date.now()-J<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){var R;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((R=this._heartbeatsCache)===null||R===void 0?void 0:R.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let Z=wt(),{heartbeatsToSend:te,unsentEntries:Se}=function(J,je=1024){let Be=[],P=J.slice();for(let S of J){let $=Be.find(U=>U.agent===S.agent);if($){if($.dates.push(S.date),bt(Be)>je){$.dates.pop();break}}else if(Be.push({agent:S.agent,dates:[S.date]}),bt(Be)>je){Be.pop();break}P=P.slice(1)}return{heartbeatsToSend:Be,unsentEntries:P}}(this._heartbeatsCache.heartbeats),we=(0,ze.L)(JSON.stringify({version:2,heartbeats:te}));return this._heartbeatsCache.lastSentHeartbeatDate=Z,Se.length>0?(this._heartbeatsCache.heartbeats=Se,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),we}}function wt(){return new Date().toISOString().substring(0,10)}class ve{constructor(R){this.app=R,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,ze.hl)()&&(0,ze.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let R=await ce(this.app);return R?.heartbeats?R:{heartbeats:[]}}}async overwrite(R){var Z;if(await this._canUseIndexedDBPromise){let te=await this.read();return Pe(this.app,{lastSentHeartbeatDate:(Z=R.lastSentHeartbeatDate)!==null&&Z!==void 0?Z:te.lastSentHeartbeatDate,heartbeats:R.heartbeats})}}async add(R){var Z;if(await this._canUseIndexedDBPromise){let te=await this.read();return Pe(this.app,{lastSentHeartbeatDate:(Z=R.lastSentHeartbeatDate)!==null&&Z!==void 0?Z:te.lastSentHeartbeatDate,heartbeats:[...te.heartbeats,...R.heartbeats]})}}}function bt(W){return(0,ze.L)(JSON.stringify({version:2,heartbeats:W})).length}H(new it.wA("platform-logger",W=>new mn(W),"PRIVATE")),H(new it.wA("heartbeat",W=>new vt(W),"PRIVATE")),V(zt,an,""),V(zt,an,"esm2017"),V("fire-js","")},Gn.__chunk_1511=(tr,qt,De)=>{De.d(qt,{BH:()=>Je,G6:()=>gt,L:()=>ze,LL:()=>yt,P0:()=>Ee,Pz:()=>ue,Sg:()=>pn,ZR:()=>xe,aH:()=>ft,b$:()=>zt,eu:()=>ot,hl:()=>We,m9:()=>Rt,ne:()=>K,pd:()=>Dt,q4:()=>Re,ru:()=>mn,tV:()=>ie,uI:()=>Fe,vZ:()=>function V(q,Y){if(q===Y)return!0;let me=Object.keys(q),ce=Object.keys(Y);for(let Pe of me){if(!ce.includes(Pe))return!1;let Qe=q[Pe],vt=Y[Pe];if(H(Qe)&&H(vt)){if(!V(Qe,vt))return!1}else if(Qe!==vt)return!1}for(let Pe of ce)if(!me.includes(Pe))return!1;return!0},w1:()=>an,xO:()=>Ve,xb:()=>$t,z$:()=>pt,zd:()=>Yt});let re=function(V){let q=[],Y=0;for(let me=0;me<V.length;me++){let ce=V.charCodeAt(me);ce<128?q[Y++]=ce:(ce<2048?q[Y++]=ce>>6|192:((64512&ce)==55296&&me+1<V.length&&(64512&V.charCodeAt(me+1))==56320?(ce=65536+((1023&ce)<<10)+(1023&V.charCodeAt(++me)),q[Y++]=ce>>18|240,q[Y++]=ce>>12&63|128):q[Y++]=ce>>12|224,q[Y++]=ce>>6&63|128),q[Y++]=63&ce|128)}return q},fe=function(V){let q=[],Y=0,me=0;for(;Y<V.length;){let ce=V[Y++];if(ce<128)q[me++]=String.fromCharCode(ce);else if(ce>191&&ce<224){let Pe=V[Y++];q[me++]=String.fromCharCode((31&ce)<<6|63&Pe)}else if(ce>239&&ce<365){let Pe=((7&ce)<<18|(63&V[Y++])<<12|(63&V[Y++])<<6|63&V[Y++])-65536;q[me++]=String.fromCharCode(55296+(Pe>>10)),q[me++]=String.fromCharCode(56320+(1023&Pe))}else{let Pe=V[Y++],Qe=V[Y++];q[me++]=String.fromCharCode((15&ce)<<12|(63&Pe)<<6|63&Qe)}}return q.join("")},He={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(V,q){if(!Array.isArray(V))throw Error("encodeByteArray takes an array as a parameter");this.init_();let Y=q?this.byteToCharMapWebSafe_:this.byteToCharMap_,me=[];for(let ce=0;ce<V.length;ce+=3){let Pe=V[ce],Qe=ce+1<V.length,vt=Qe?V[ce+1]:0,wt=ce+2<V.length,ve=wt?V[ce+2]:0,bt=Pe>>2,W=(3&Pe)<<4|vt>>4,R=(15&vt)<<2|ve>>6,Z=63&ve;wt||(Z=64,Qe||(R=64)),me.push(Y[bt],Y[W],Y[R],Y[Z])}return me.join("")},encodeString(V,q){return this.HAS_NATIVE_SUPPORT&&!q?btoa(V):this.encodeByteArray(re(V),q)},decodeString(V,q){return this.HAS_NATIVE_SUPPORT&&!q?atob(V):fe(this.decodeStringToByteArray(V,q))},decodeStringToByteArray(V,q){this.init_();let Y=q?this.charToByteMapWebSafe_:this.charToByteMap_,me=[];for(let ce=0;ce<V.length;){let Pe=Y[V.charAt(ce++)],Qe=ce<V.length?Y[V.charAt(ce)]:0,vt=++ce<V.length?Y[V.charAt(ce)]:64,wt=++ce<V.length?Y[V.charAt(ce)]:64;if(++ce,Pe==null||Qe==null||vt==null||wt==null)throw new it;let ve=Pe<<2|Qe>>4;if(me.push(ve),vt!==64){let bt=Qe<<4&240|vt>>2;if(me.push(bt),wt!==64){let W=vt<<6&192|wt;me.push(W)}}}return me},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let V=0;V<this.ENCODED_VALS.length;V++)this.byteToCharMap_[V]=this.ENCODED_VALS.charAt(V),this.charToByteMap_[this.byteToCharMap_[V]]=V,this.byteToCharMapWebSafe_[V]=this.ENCODED_VALS_WEBSAFE.charAt(V),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[V]]=V,V>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(V)]=V,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(V)]=V)}}};class it extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let St=function(V){let q=re(V);return He.encodeByteArray(q,!0)},ze=function(V){return St(V).replace(/\./g,"")},ie=function(V){try{return He.decodeString(V,!0)}catch(q){console.error("base64Decode failed: ",q)}return null},ne=()=>function(){if(typeof Ge<"u")return Ge;if(typeof window<"u")return window;if(De.g!==void 0)return De.g;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,he=()=>{if(typeof process>"u"||process.env===void 0)return;let V=process.env.__FIREBASE_DEFAULTS__;if(V)return JSON.parse(V)},Ce=()=>{let V;if(typeof document>"u")return;try{V=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let q=V&&ie(V[1]);return q&&JSON.parse(q)},Oe=()=>{try{return ne()||he()||Ce()}catch(V){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${V}`);return}},Re=V=>{var q,Y;return(Y=(q=Oe())===null||q===void 0?void 0:q.emulatorHosts)===null||Y===void 0?void 0:Y[V]},Ee=V=>{let q=Re(V);if(!q)return;let Y=q.lastIndexOf(":");if(Y<=0||Y+1===q.length)throw Error(`Invalid host ${q} with no separate hostname and port!`);let me=parseInt(q.substring(Y+1),10);return q[0]==="["?[q.substring(1,Y-1),me]:[q.substring(0,Y),me]},ft=()=>{var V;return(V=Oe())===null||V===void 0?void 0:V.config},ue=V=>{var q;return(q=Oe())===null||q===void 0?void 0:q[`_${V}`]};class Je{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((q,Y)=>{this.resolve=q,this.reject=Y})}wrapCallback(q){return(Y,me)=>{Y?this.reject(Y):this.resolve(me),typeof q=="function"&&(this.promise.catch(()=>{}),q.length===1?q(Y):q(Y,me))}}}function pn(V,q){if(V.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let Y=q||"demo-project",me=V.iat||0,ce=V.sub||V.user_id;if(!ce)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let Pe=Object.assign({iss:`https://securetoken.google.com/${Y}`,aud:Y,iat:me,exp:me+3600,auth_time:me,sub:ce,user_id:ce,firebase:{sign_in_provider:"custom",identities:{}}},V);return[ze(JSON.stringify({alg:"none",type:"JWT"})),ze(JSON.stringify(Pe)),""].join(".")}function pt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Fe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pt())}function mn(){let V=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof V=="object"&&V.id!==void 0}function zt(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function an(){let V=pt();return V.indexOf("MSIE ")>=0||V.indexOf("Trident/")>=0}function gt(){return!function(){var V;let q=(V=Oe())===null||V===void 0?void 0:V.forceEnvironment;if(q==="node")return!0;if(q==="browser")return!1;try{return Object.prototype.toString.call(De.g.process)==="[object process]"}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function We(){try{return typeof indexedDB=="object"}catch{return!1}}function ot(){return new Promise((V,q)=>{try{let Y=!0,me="validate-browser-context-for-indexeddb-analytics-module",ce=Ge.indexedDB.open(me);ce.onsuccess=()=>{ce.result.close(),Y||Ge.indexedDB.deleteDatabase(me),V(!0)},ce.onupgradeneeded=()=>{Y=!1},ce.onerror=()=>{var Pe;q(((Pe=ce.error)===null||Pe===void 0?void 0:Pe.message)||"")}}catch(Y){q(Y)}})}class xe extends Error{constructor(q,Y,me){super(Y),this.code=q,this.customData=me,this.name="FirebaseError",Object.setPrototypeOf(this,xe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yt.prototype.create)}}class yt{constructor(q,Y,me){this.service=q,this.serviceName=Y,this.errors=me}create(q,...Y){let me=Y[0]||{},ce=`${this.service}/${q}`,Pe=this.errors[q],Qe=Pe?Pe.replace(xt,(wt,ve)=>{let bt=me[ve];return bt!=null?String(bt):`<${ve}?>`}):"Error",vt=`${this.serviceName}: ${Qe} (${ce}).`;return new xe(ce,vt,me)}}let xt=/\{\$([^}]+)}/g;function $t(V){for(let q in V)if(Object.prototype.hasOwnProperty.call(V,q))return!1;return!0}function H(V){return V!==null&&typeof V=="object"}function Ve(V){let q=[];for(let[Y,me]of Object.entries(V))Array.isArray(me)?me.forEach(ce=>{q.push(encodeURIComponent(Y)+"="+encodeURIComponent(ce))}):q.push(encodeURIComponent(Y)+"="+encodeURIComponent(me));return q.length?"&"+q.join("&"):""}function Yt(V){let q={};return V.replace(/^\?/,"").split("&").forEach(Y=>{if(Y){let[me,ce]=Y.split("=");q[decodeURIComponent(me)]=decodeURIComponent(ce)}}),q}function Dt(V){let q=V.indexOf("?");if(!q)return"";let Y=V.indexOf("#",q);return V.substring(q,Y>0?Y:void 0)}function K(V,q){let Y=new M(V,q);return Y.subscribe.bind(Y)}class M{constructor(q,Y){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=Y,this.task.then(()=>{q(this)}).catch(me=>{this.error(me)})}next(q){this.forEachObserver(Y=>{Y.next(q)})}error(q){this.forEachObserver(Y=>{Y.error(q)}),this.close(q)}complete(){this.forEachObserver(q=>{q.complete()}),this.close()}subscribe(q,Y,me){let ce;if(q===void 0&&Y===void 0&&me===void 0)throw Error("Missing Observer.");(ce=function(Qe,vt){if(typeof Qe!="object"||Qe===null)return!1;for(let wt of vt)if(wt in Qe&&typeof Qe[wt]=="function")return!0;return!1}(q,["next","error","complete"])?q:{next:q,error:Y,complete:me}).next===void 0&&(ce.next=ee),ce.error===void 0&&(ce.error=ee),ce.complete===void 0&&(ce.complete=ee);let Pe=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?ce.error(this.finalError):ce.complete()}catch{}}),this.observers.push(ce),Pe}unsubscribeOne(q){this.observers!==void 0&&this.observers[q]!==void 0&&(delete this.observers[q],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(q){if(!this.finalized)for(let Y=0;Y<this.observers.length;Y++)this.sendOne(Y,q)}sendOne(q,Y){this.task.then(()=>{if(this.observers!==void 0&&this.observers[q]!==void 0)try{Y(this.observers[q])}catch(me){typeof console<"u"&&console.error&&console.error(me)}})}close(q){this.finalized||(this.finalized=!0,q!==void 0&&(this.finalError=q),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ee(){}function Rt(V){return V&&V._delegate?V._delegate:V}},Gn);export{Tf as __getNamedExports};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2018 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2019 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2020 Google LLC.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2022 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2023 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
/**
* @license
* Copyright 2024 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
